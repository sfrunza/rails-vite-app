import{PhoneInput as e,isValidPhoneNumber as t}from"./phone-input-DV5b9ZTz.js";import"./chevron-left-zJdJqyR0.js";import{PasswordInput as n}from"./password-input-D4CvYEgI.js";import{PencilLine as r}from"./pencil-line-BUB2-8JZ.js";import{Avatar as i,AvatarFallback as a,Button as o,Form as s,FormControl as c,FormDescription as l,FormField as u,FormItem as d,FormLabel as f,FormMessage as p,Input as m,LoadingButton as h,Outlet as g,Plus as _,ScrollArea as v,ScrollBar as y,Select as ee,SelectContent as te,SelectItem as ne,SelectTrigger as re,SelectValue as ie,Sheet as b,SheetClose as ae,SheetContent as x,SheetDescription as S,SheetFooter as C,SheetHeader as oe,SheetTitle as w,Spinner as T,__toESM as E,a as se,booleanType as ce,cn as D,enumType as le,format as O,formatPhone as k,handleApiError as A,objectType as j,require_jsx_runtime as M,require_react as N,stringType as P,toast as F,useCreateEmployeeMutation as I,useForm as L,useGetEmployeeByIdQuery as R,useGetEmployeesQuery as z,useParams as B,useUpdateEmployeeMutation as V}from"./index-BpPvn16n.js";import{Badge as H}from"./badge-6y2efZus.js";import{Card as U,CardAction as W,CardContent as ue,CardDescription as de,CardHeader as fe,CardTitle as pe}from"./card-D6e0mOnd.js";import{Tabs as me,TabsList as he,TabsTrigger as ge}from"./tabs-ONBK2pzv.js";import{Switch as _e}from"./switch-TnSuzTX_.js";import{Table as ve,TableBody as ye,TableCell as G,TableHead as K,TableHeader as be,TableRow as q}from"./table-CGpTAqU8.js";import{SettingPageWrapper as xe}from"./setting-page-wrapper-B7I8Q1ot.js";var J=E(M());const Se=[`all`,`admin`,`manager`,`foreman`,`driver`,`helper`];function Ce({filter:e,handleSetFilter:t}){return(0,J.jsx)(me,{value:e,onValueChange:e=>{t(e)},children:(0,J.jsxs)(v,{className:`pb-2`,children:[(0,J.jsx)(he,{children:Se.map(e=>(0,J.jsx)(ge,{value:e,className:`capitalize`,children:e},e))}),(0,J.jsx)(y,{orientation:`horizontal`})]})})}const Y=[{label:`Admin`,value:`admin`},{label:`Manager`,value:`manager`},{label:`Foreman`,value:`foreman`},{label:`Driver`,value:`driver`},{label:`Helper`,value:`helper`}],X=j({first_name:P().min(1,{message:`First name is required.`}),last_name:P().min(1,{message:`Last name is required.`}),email_address:P().email({message:`Invalid email address.`}),phone:P().refine(e=>t(e,`US`),{message:`Invalid phone number`}),role:le(Y.map(e=>e.value)),active:ce().optional(),password:P().optional()});function we({userId:t,closeSheet:r}){let[i,{isLoading:a}]=I(),[g,{isLoading:_}]=V(),{data:v,isLoading:y}=R({id:Number(t)},{skip:!t}),b=L({mode:`onChange`,reValidateMode:`onChange`,resolver:se(X),defaultValues:{first_name:``,last_name:``,email_address:``,phone:``,role:`helper`,active:!0,password:``},values:v});function x(e){t?g({id:Number(t),data:e}).unwrap().then(()=>{F.success(`User updated.`),r()}).catch(e=>{A(e)}):i({data:e}).unwrap().then(()=>{F.success(`User created.`),r()}).catch(e=>{A(e)})}return(0,J.jsxs)(J.Fragment,{children:[(0,J.jsxs)(oe,{children:[(0,J.jsxs)(w,{children:[t?`Update`:`Add`,` user`]}),(0,J.jsxs)(S,{className:`flex flex-row items-center gap-2`,children:[(0,J.jsxs)(`span`,{children:[`Employee ID:`,v?.id??``]}),(0,J.jsxs)(`span`,{children:[`Creation Date:`,` `,v?.created_at?O(v?.created_at,`dd MMM, yyyy`):``]})]})]}),(0,J.jsx)(`div`,{className:`flex-1 overflow-y-auto p-4`,children:y&&t?(0,J.jsx)(`div`,{className:`flex justify-center items-center h-full`,children:(0,J.jsx)(T,{})}):(0,J.jsx)(s,{...b,children:(0,J.jsxs)(`form`,{onSubmit:b.handleSubmit(x),className:`space-y-6`,children:[(0,J.jsx)(u,{control:b.control,name:`first_name`,render:({field:e})=>(0,J.jsxs)(d,{children:[(0,J.jsx)(f,{children:`First name (required)`}),(0,J.jsx)(c,{children:(0,J.jsx)(m,{...e,autoComplete:`off`})}),(0,J.jsx)(p,{})]})}),(0,J.jsx)(u,{control:b.control,name:`last_name`,render:({field:e})=>(0,J.jsxs)(d,{children:[(0,J.jsx)(f,{children:`Last name (required)`}),(0,J.jsx)(c,{children:(0,J.jsx)(m,{...e,autoComplete:`off`})}),(0,J.jsx)(p,{})]})}),(0,J.jsx)(u,{control:b.control,name:`email_address`,render:({field:e})=>(0,J.jsxs)(d,{children:[(0,J.jsx)(f,{children:`Email (required)`}),(0,J.jsx)(l,{children:`Email address used to login to the system.`}),(0,J.jsx)(c,{children:(0,J.jsx)(m,{...e,autoComplete:`off`})}),(0,J.jsx)(p,{})]})}),(0,J.jsx)(u,{control:b.control,name:`phone`,render:({field:t})=>(0,J.jsxs)(d,{children:[(0,J.jsx)(f,{children:`Phone (required)`}),(0,J.jsx)(c,{children:(0,J.jsx)(e,{...t,value:k(t.value??``),handleValueChange:t.onChange})}),(0,J.jsx)(p,{})]})}),(0,J.jsx)(u,{control:b.control,name:`role`,render:({field:e})=>(0,J.jsxs)(d,{children:[(0,J.jsx)(f,{children:`Position`}),(0,J.jsxs)(ee,{...e,children:[(0,J.jsx)(c,{children:(0,J.jsx)(re,{children:(0,J.jsx)(ie,{placeholder:`Select a position`})})}),(0,J.jsx)(te,{children:Y?.map(({label:e,value:t})=>(0,J.jsx)(ne,{value:t,children:e},t))})]}),(0,J.jsx)(p,{})]})}),(0,J.jsx)(u,{control:b.control,name:`password`,render:({field:e})=>(0,J.jsxs)(d,{children:[(0,J.jsx)(f,{children:`Password`}),(0,J.jsx)(l,{children:`Required only when creating a new user.`}),(0,J.jsx)(c,{children:(0,J.jsx)(n,{...e,autoComplete:`off`})}),(0,J.jsx)(p,{})]})}),(0,J.jsx)(u,{control:b.control,name:`active`,render:({field:e})=>(0,J.jsxs)(d,{className:`flex flex-row items-center justify-between rounded-lg border p-4`,children:[(0,J.jsxs)(`div`,{className:`space-y-0.5`,children:[(0,J.jsx)(f,{className:`text-base`,children:`Employee is active`}),(0,J.jsx)(l,{children:`If the employee is active, they will be able to login to the system.`})]}),(0,J.jsx)(c,{children:(0,J.jsx)(_e,{checked:e.value??!1,onCheckedChange:e.onChange,name:e.name})})]})})]})})}),(0,J.jsxs)(C,{children:[(0,J.jsx)(ae,{asChild:!0,children:(0,J.jsx)(o,{type:`button`,variant:`outline`,className:`w-full`,children:`Cancel`})}),(0,J.jsx)(h,{type:`button`,loading:a||_,disabled:a||_,onClick:b.handleSubmit(x),className:`w-full`,children:t?`Update user`:`Add user`})]})]})}var Z=E(N());const Q=(0,Z.createContext)(void 0),Te=({children:e})=>{let[t,n]=(0,Z.useState)({props:null,open:!1}),r=e=>{n({props:e??null,open:!0})},i=()=>{n(e=>({...e,open:!1}))};return(0,J.jsxs)(Q.Provider,{value:{...t,openSheet:r,closeSheet:i},children:[e,(0,J.jsx)(Ee,{})]})},$=()=>{let e=(0,Z.useContext)(Q);if(!e)throw Error(`useSheet must be used within a SheetProvider`);return e},Ee=()=>{let{open:e,props:t,closeSheet:n}=$();return(0,J.jsx)(b,{open:e,onOpenChange:e=>!e&&n(),children:(0,J.jsx)(x,{className:`w-full sm:min-w-xl`,children:(0,J.jsx)(we,{...t,closeSheet:n})})})};function De(e,t){return`${e.charAt(0)}${t.charAt(0)}`.toUpperCase()}function Oe({users:e}){return(0,J.jsxs)(ve,{className:`min-w-[750px]`,children:[(0,J.jsx)(be,{children:(0,J.jsxs)(q,{children:[(0,J.jsx)(K,{children:`Name`}),(0,J.jsx)(K,{children:`Role`}),(0,J.jsx)(K,{children:`Phone`}),(0,J.jsx)(K,{children:`Email`}),(0,J.jsx)(K,{children:`Status`}),(0,J.jsx)(K,{className:`text-right`,children:`Actions`})]})}),(0,J.jsx)(ye,{children:e.map(e=>(0,J.jsx)(ke,{user:e},e.id))})]})}function ke({user:e}){let{openSheet:t}=$();return(0,J.jsxs)(q,{children:[(0,J.jsxs)(G,{className:`flex items-center gap-2`,children:[(0,J.jsx)(i,{children:(0,J.jsx)(a,{children:De(e.first_name,e.last_name)})}),`${e.first_name} ${e.last_name}`]}),(0,J.jsx)(G,{className:`capitalize`,children:e.role}),(0,J.jsx)(G,{children:e.phone?k(e.phone):`-`}),(0,J.jsx)(G,{children:e.email_address}),(0,J.jsx)(G,{children:(0,J.jsxs)(H,{className:D(`capitalize py-1 relative overflow-hidden bg-transparent`,e.active?`text-[#00a455]`:`text-foreground`),children:[(0,J.jsx)(`span`,{className:`${e.active?`bg-[#00a455]`:`bg-foreground/50`} absolute inset-0 opacity-15`}),e.active?`Active`:`Inactive`,(0,J.jsx)(`div`,{className:D(`size-2 rounded-full ml-1`,e.active?`bg-[#00a455]`:`bg-foreground/50`)})]})}),(0,J.jsx)(G,{className:`text-right`,children:(0,J.jsx)(o,{variant:`outline`,size:`icon`,onClick:()=>t({userId:e.id}),children:(0,J.jsx)(r,{})})})]})}function Ae(){let{openSheet:e}=$(),{data:t,isLoading:n}=z(),[r,i]=(0,Z.useState)(`all`),a=t?.filter(e=>r===`all`?e:e.role===r);function s(e){i(e)}return(0,J.jsxs)(U,{children:[(0,J.jsxs)(fe,{children:[(0,J.jsx)(pe,{children:`Employees`}),(0,J.jsx)(de,{children:`Manage your employees and their roles.`}),(0,J.jsx)(W,{children:(0,J.jsxs)(o,{onClick:()=>e(),children:[(0,J.jsx)(_,{}),`Create user`]})})]}),(0,J.jsxs)(ue,{className:`space-y-2`,children:[(0,J.jsx)(Ce,{filter:r,handleSetFilter:s}),n&&(0,J.jsx)(`div`,{className:`flex h-96 items-center justify-center`,children:(0,J.jsx)(T,{})}),a&&(0,J.jsx)(Oe,{users:a??[]})]})]})}function je(){let e=B();return e.id?(0,J.jsx)(g,{}):(0,J.jsx)(Te,{children:(0,J.jsx)(xe,{children:(0,J.jsx)(Ae,{})})})}const Me=je;export{Me as Component};