import{CSS as e,DndContext as t,GripVertical as n,KeyboardSensor as r,PointerSensor as i,SortableContext as a,arrayMove as o,closestCenter as s,restrictToParentElement as c,sortableKeyboardCoordinates as l,useSensor as u,useSensors as d,useSortable as f}from"./sortable.esm-DD4nrChD.js";import{PenLine as p}from"./pen-line-Cche-2Y9.js";import{AlertDialog as m,AlertDialogCancel as h,AlertDialogContent as ee,AlertDialogDescription as te,AlertDialogFooter as ne,AlertDialogHeader as g,AlertDialogTitle as re,AlertDialogTrigger as ie,Button as _,Card as v,CardAction as y,CardContent as ae,CardFooter as oe,CardHeader as b,CardTitle as x,Form as S,FormControl as C,FormDescription as w,FormField as T,FormItem as E,FormLabel as D,FormMessage as O,Input as k,LoadingButton as A,NumericInput as j,Outlet as se,Plus as M,Sheet as N,SheetClose as P,SheetContent as F,SheetDescription as I,SheetFooter as L,SheetHeader as R,SheetTitle as z,SheetTrigger as B,Skeleton as V,Textarea as ce,Trash2 as H,Truck as le,__toESM as U,a as W,arrayType as G,cn as K,coerce as q,createLucideIcon as ue,handleApiError as J,instanceOfType as de,numberType as fe,objectType as pe,require_jsx_runtime as me,require_react as he,stringType as Y,toast as X,useBulkUpdateEntranceTypesMutation as ge,useBulkUpdateMoveSizesMutation as _e,useCreateEntranceTypeMutation as ve,useCreateMoveSizeMutation as ye,useDeleteEntranceTypeMutation as be,useDeleteMoveSizeMutation as xe,useForm as Se,useGetEntranceTypesQuery as Z,useGetMoveSizesQuery as Ce,useParams as we,useUpdateMoveSizeMutation as Te}from"./index-OmLcTgDE.js";import{SettingPageWrapper as Ee}from"./setting-page-wrapper-DsxRRjvs.js";const De=[[`path`,{d:`M5 3v16h16`,key:`1mqmf9`}],[`path`,{d:`m5 19 6-6`,key:`jh6hbb`}],[`path`,{d:`m2 6 3-3 3 3`,key:`tkyvxa`}],[`path`,{d:`m18 16 3 3-3 3`,key:`1d4glt`}]],Oe=ue(`move-3d`,De);var Q=U(he()),$=U(me());const ke=pe({name:Y({required_error:`Name is required.`}).min(5,{message:`Name must be at least 5 characters long.`}),form_name:Y({required_error:`Form name is required.`}).min(1,{message:`Form name must be at least 1 character long.`})});function Ae(){let[e,{isLoading:t}]=ve(),[n,r]=(0,Q.useState)(!1),i=Se({mode:`onChange`,reValidateMode:`onChange`,resolver:W(ke),defaultValues:{name:``,form_name:``}});function a(t){e(t).unwrap().then(()=>{X.success(`Truck created`),i.reset(),r(!1)}).catch(e=>{J(e)})}function o(){i.reset(),r(e=>!e)}return(0,$.jsxs)(N,{open:n,onOpenChange:o,children:[(0,$.jsx)(B,{asChild:!0,children:(0,$.jsxs)(_,{children:[(0,$.jsx)(M,{}),`Create stairs`]})}),(0,$.jsxs)(F,{children:[(0,$.jsxs)(R,{children:[(0,$.jsx)(z,{children:`Add entrance type`}),(0,$.jsx)(I,{className:`sr-only`})]}),(0,$.jsx)(`div`,{className:`flex-1 overflow-y-auto p-4`,children:(0,$.jsx)(S,{...i,children:(0,$.jsxs)(`form`,{onSubmit:i.handleSubmit(a),className:`space-y-6`,children:[(0,$.jsx)(T,{control:i.control,name:`name`,render:({field:e})=>(0,$.jsxs)(E,{children:[(0,$.jsx)(D,{children:`Name (required)`}),(0,$.jsx)(w,{children:`Name of the entrance type shown on quote/contract.`}),(0,$.jsx)(C,{children:(0,$.jsx)(k,{...e,autoComplete:`off`})}),(0,$.jsx)(O,{})]})}),(0,$.jsx)(T,{control:i.control,name:`form_name`,render:({field:e})=>(0,$.jsxs)(E,{children:[(0,$.jsx)(D,{children:`Form name (required)`}),(0,$.jsx)(w,{children:`Name of the entrance type shown on the Book form.`}),(0,$.jsx)(C,{children:(0,$.jsx)(k,{...e})}),(0,$.jsx)(O,{})]})})]})})}),(0,$.jsxs)(L,{children:[(0,$.jsx)(P,{asChild:!0,children:(0,$.jsx)(_,{type:`button`,variant:`outline`,children:`Cancel`})}),(0,$.jsx)(A,{type:`button`,loading:t,disabled:t,onClick:i.handleSubmit(a),children:`Add stairs`})]})]})]})}function je({entrance:e}){let[t,n]=(0,Q.useState)(!1),[r,{isLoading:i}]=be();return(0,$.jsxs)(m,{open:t,onOpenChange:n,children:[(0,$.jsx)(ie,{asChild:!0,children:(0,$.jsx)(_,{variant:`ghost`,size:`icon`,className:`hover:text-destructive`,children:(0,$.jsx)(H,{})})}),(0,$.jsxs)(ee,{children:[(0,$.jsxs)(g,{children:[(0,$.jsx)(re,{children:`Delete entrance type?`}),(0,$.jsxs)(te,{children:[`This will delete `,(0,$.jsxs)(`b`,{children:[e.name,`.`]}),` Entrance types that have already been used cannot be deleted.`]})]}),(0,$.jsxs)(ne,{children:[(0,$.jsx)(h,{children:`Cancel`}),(0,$.jsx)(A,{type:`button`,loading:i,disabled:i,variant:`destructive`,onClick:()=>{r({id:e.id}).unwrap().then(()=>{X.success(`Stairs deleted`),n(!1)}).catch(e=>{J(e)})},children:`Delete`})]})]})]})}function Me({item:t,onChange:r}){let{attributes:i,listeners:a,setNodeRef:o,transform:s,transition:c,isDragging:l}=f({id:t.id}),u={transform:e.Transform.toString(s),transition:c,zIndex:l?1e3:`auto`,position:l?`relative`:`static`};return(0,$.jsxs)(`div`,{className:`flex items-center gap-2`,ref:o,style:u,children:[(0,$.jsx)(_,{size:`icon`,variant:`ghost`,className:`cursor-grab`,...i,...a,children:(0,$.jsx)(n,{})}),(0,$.jsxs)(`div`,{className:K(`grid auto-cols-auto grid-flow-col gap-2`,{"bg-background":l}),children:[(0,$.jsx)(k,{id:`long-name-${t.id}`,type:`text`,value:t.name,onChange:e=>{r(t.id,{name:e.target.value})}}),(0,$.jsx)(k,{id:`short-name-${t.id}`,type:`text`,value:t.form_name,onChange:e=>{r(t.id,{form_name:e.target.value})}}),(0,$.jsx)(je,{entrance:t})]})]})}function Ne({items:e,setItems:n,setOrderChanged:f}){let p=d(u(i),u(r,{coordinateGetter:l}));function m(t){let{active:r,over:i}=t;if(i&&r.id!==i.id){let t=e.findIndex(e=>e.id===r.id),a=e.findIndex(e=>e.id===i.id),s=o(e,t,a),c=s.map((e,t)=>({...e,index:t}));n(c),f(!0)}}function h(t,r){n(e.map(e=>e.id===t?{...e,...r}:e)),f(!0)}return(0,$.jsx)(t,{sensors:p,collisionDetection:s,onDragEnd:m,modifiers:[c],children:(0,$.jsx)(a,{items:e,children:(0,$.jsx)(`div`,{className:`space-y-4`,children:e.map(e=>(0,$.jsx)(Me,{item:e,onChange:h},e.id))})})})}function Pe(){let{data:e,isLoading:t,isError:n}=Z(),[r,{isLoading:i}]=ge(),[a,o]=(0,Q.useState)([]),[s,c]=(0,Q.useState)(!1);return(0,Q.useEffect)(()=>{e&&o(e)},[e]),(0,$.jsxs)(v,{className:`max-w-3xl`,children:[(0,$.jsxs)(b,{children:[(0,$.jsx)(x,{children:`Stairs`}),(0,$.jsx)(y,{children:(0,$.jsx)(Ae,{})})]}),(0,$.jsxs)(ae,{children:[n&&(0,$.jsx)(`div`,{children:(0,$.jsx)(`p`,{className:`text-muted-foreground text-center`,children:`Failed to fetch stairs`})}),t&&(0,$.jsx)(`div`,{className:`space-y-4`,children:Array.from({length:8}).map((e,t)=>(0,$.jsx)(V,{className:`h-9`},t))}),e&&(0,$.jsx)(Ne,{items:a,setItems:o,setOrderChanged:c})]}),(0,$.jsx)(oe,{className:`justify-end border-t`,children:(0,$.jsxs)(`div`,{className:K(`flex transition-opacity gap-3 duration-500`,{"invisible opacity-0":!s,"visible opacity-100":s}),children:[(0,$.jsx)(_,{type:`button`,variant:`outline`,onClick:()=>{o(e??[]),c(!1)},children:`Cancel`}),(0,$.jsx)(A,{type:`button`,disabled:i,loading:i,onClick:()=>{r({entranceTypes:a}).unwrap().then(()=>{X.success(`Changes saved`),c(!1)}).catch(e=>{J(e)})},children:`Save changes`})]})})]})}function Fe({value:e,onChange:t}){let{data:n}=Z();if(!n)return null;let r=(n,r,i)=>{let a=e.map((e,t)=>e.map((e,a)=>t===n&&a===r?i:e));t(a)};return(0,$.jsxs)(`div`,{className:`flex flex-col rounded-lg overflow-hidden border`,children:[(0,$.jsx)(`div`,{className:`bg-slate-900 text-white text-center p-1.5 font-semibold text-sm`,children:`TO STAIRS`}),(0,$.jsxs)(`div`,{className:`flex`,children:[(0,$.jsx)(`div`,{className:`bg-slate-900 text-white p-4 flex flex-col items-center justify-center w-8`,children:(0,$.jsx)(`div`,{className:`transform -rotate-90 whitespace-nowrap font-semibold text-sm`,children:`FROM STAIRS`})}),(0,$.jsxs)(`div`,{className:`bg-background p-4 flex-1`,children:[(0,$.jsxs)(`div`,{className:`grid mb-4`,style:{gridTemplateColumns:`repeat(${n.length+1}, 1fr)`},children:[(0,$.jsx)(`div`,{}),n.map((e,t)=>(0,$.jsx)(`div`,{className:`flex items-center justify-center text-muted-foreground font-medium text-sm`,children:e.name.slice(0,3)},`col-${t}`))]}),(0,$.jsx)(`div`,{className:`grid gap-2`,children:n.map((t,i)=>(0,$.jsxs)(`div`,{className:`grid gap-2 items-center`,style:{gridTemplateColumns:`repeat(${n.length+1}, 1fr)`},children:[(0,$.jsx)(`div`,{className:`text-muted-foreground text-sm font-medium text-center`,children:t.name.slice(0,3)}),n.map((t,n)=>(0,$.jsx)(j,{name:`cell-${i}-${n}`,defaultValue:e[i][n].toString(),min:2,max:20,onChange:e=>{r(i,n,Number(e))},className:`w-full p-0 text-center`},`cell-${i}-${n}`))]},`row-${i}`))})]})]})]})}const Ie=[[2,2,2,2,2,2,2],[2,2,2,2,2,2,2],[2,2,2,2,2,2,2],[2,2,2,3,2,2,2],[2,2,2,2,2,2,2],[2,2,2,2,2,2,2],[2,2,2,2,2,2,2]];function Le(e,t){let n=e.length,r=e[0].length,i=t.length,a=t[0].length,o=[];for(let t=0;t<i;t++){o[t]=[];for(let i=0;i<a;i++)t<n&&i<r?o[t][i]=e[t][i]:o[t][i]=2}return o}const Re=pe({name:Y().min(1,{message:`Name is required`}),description:Y(),dispersion:q.number().min(0,{message:`Dispersion must be greater than 0`}).max(100,{message:`Dispersion must be less than 100`}),truck_count:q.number().min(1,{message:`Truck count must be at least 1`}),volume:q.number().min(0,{message:`Volume must be greater than 0`}),weight:q.number().min(0,{message:`Weight must be greater than 0`}),crew_size_settings:G(G(fe())),image:de(File).optional()});function ze(e){let t=e.target.files&&e.target.files[0],n=t?URL.createObjectURL(t):``;return{file:t,displayUrl:n}}function Be({data:e}){let{data:t}=Z(),[n,{isLoading:r}]=ye(),[i,{isLoading:a}]=Te(),[o,{isLoading:s}]=xe(),[c,l]=(0,Q.useState)(!1),[u,d]=(0,Q.useState)(null),f=Se({resolver:W(Re),mode:`onChange`,reValidateMode:`onChange`,values:e??void 0,defaultValues:{name:``,description:``,dispersion:0,truck_count:1,volume:0,weight:0,crew_size_settings:Ie,image:void 0}});async function v(t){e?i({id:e.id,...t}).unwrap().then(()=>{X.success(`Changes successfully saved`),f.reset(),y()}).catch(e=>{J(e)}):n(t).unwrap().then(()=>{X.success(`Move size successfully added`),f.reset(),y()}).catch(e=>{J(e)})}function y(){f.reset(),l(e=>!e)}return(0,$.jsxs)(N,{open:c,onOpenChange:y,children:[(0,$.jsx)(B,{asChild:!0,children:e?(0,$.jsx)(_,{variant:`ghost`,size:`icon`,children:(0,$.jsx)(p,{})}):(0,$.jsxs)(_,{children:[(0,$.jsx)(M,{}),`Create move size`]})}),(0,$.jsxs)(F,{className:`w-full sm:max-w-lg`,children:[(0,$.jsxs)(R,{children:[(0,$.jsxs)(z,{children:[e?`Edit`:`Create`,` move size`]}),(0,$.jsx)(I,{className:`sr-only`})]}),(0,$.jsxs)(`div`,{className:`flex-1 overflow-y-auto p-4`,children:[(0,$.jsx)(S,{...f,children:(0,$.jsxs)(`form`,{onSubmit:f.handleSubmit(v),className:`space-y-6`,children:[(0,$.jsx)(T,{control:f.control,name:`image`,render:({field:{value:e,onChange:t,...n}})=>(0,$.jsxs)(E,{children:[(0,$.jsx)(D,{children:`Image`}),(0,$.jsx)(C,{children:(0,$.jsx)(k,{...n,placeholder:`Image`,type:`file`,accept:`image/png, image/jpeg`,multiple:!1,onChange:e=>{let{file:n,displayUrl:r}=ze(e);d(r),t(n)}})}),(0,$.jsx)(O,{})]})}),(0,$.jsx)(`div`,{className:`flex justify-center items-center`,children:u&&(0,$.jsx)(`div`,{className:`relative size-40 p-1 rounded-md border-2 border-dashed`,children:(0,$.jsx)(`img`,{src:u,alt:`Company logo`,className:`h-full w-full rounded-md object-contain`})})}),(0,$.jsx)(T,{control:f.control,name:`name`,render:({field:e})=>(0,$.jsxs)(E,{children:[(0,$.jsx)(D,{children:`Name`}),(0,$.jsx)(w,{children:`Name of the move size, visible to customers.`}),(0,$.jsx)(C,{children:(0,$.jsx)(k,{...e,autoComplete:`off`})}),(0,$.jsx)(O,{})]})}),(0,$.jsx)(T,{control:f.control,name:`description`,render:({field:e})=>(0,$.jsxs)(E,{children:[(0,$.jsx)(D,{children:`Description`}),(0,$.jsx)(w,{children:`Description of the move size, visible to customers.`}),(0,$.jsx)(C,{children:(0,$.jsx)(ce,{...e,rows:2,autoComplete:`off`})}),(0,$.jsx)(O,{})]})}),(0,$.jsx)(T,{control:f.control,name:`dispersion`,render:({field:e})=>(0,$.jsxs)(E,{children:[(0,$.jsx)(D,{children:`Dispersion %`}),(0,$.jsx)(w,{children:`Dispersion of the move size.`}),(0,$.jsx)(C,{children:(0,$.jsx)(j,{value:e.value.toString(),min:0,max:100,onChange:t=>{e.onChange(t)}})}),(0,$.jsx)(O,{})]})}),(0,$.jsx)(T,{control:f.control,name:`truck_count`,render:({field:e})=>(0,$.jsxs)(E,{children:[(0,$.jsx)(D,{children:`Trucks count for this size`}),(0,$.jsx)(C,{children:(0,$.jsx)(j,{value:e.value.toString(),min:1,max:10,onChange:t=>{e.onChange(t)}})}),(0,$.jsx)(O,{})]})}),(0,$.jsx)(T,{control:f.control,name:`volume`,render:({field:e})=>(0,$.jsxs)(E,{children:[(0,$.jsx)(D,{children:`Volume`}),(0,$.jsx)(C,{children:(0,$.jsx)(j,{value:e.value.toString(),min:0,max:1e5,allowDecimals:!0,onChange:t=>{e.onChange(t)}})}),(0,$.jsx)(O,{})]})}),(0,$.jsx)(T,{control:f.control,name:`weight`,render:({field:e})=>(0,$.jsxs)(E,{children:[(0,$.jsx)(D,{children:`Weight`}),(0,$.jsx)(C,{children:(0,$.jsx)(j,{value:e.value.toString(),min:0,max:1e5,allowDecimals:!0,onChange:t=>{e.onChange(t)}})}),(0,$.jsx)(O,{})]})}),(0,$.jsx)(T,{control:f.control,name:`crew_size_settings`,render:({field:e})=>(0,$.jsxs)(E,{children:[(0,$.jsx)(`p`,{className:`text-sm leading-none font-medium select-none group-data-[disabled=true]:pointer-events-none group-data-[disabled=true]:opacity-50 peer-disabled:cursor-not-allowed peer-disabled:opacity-50`,children:`Crew size settings`}),(0,$.jsx)(C,{children:(0,$.jsx)(Fe,{value:Le(e.value,Array(t?.length??0).fill(null).map(()=>Array(t?.length??0).fill(2))),onChange:e.onChange})})]})})]})}),(0,$.jsx)(`div`,{className:`mt-6`,children:e&&(0,$.jsxs)(m,{children:[(0,$.jsx)(ie,{asChild:!0,children:(0,$.jsxs)(_,{variant:`outline`,className:`hover:text-destructive text-destructive`,children:[(0,$.jsx)(H,{}),`Delete`]})}),(0,$.jsxs)(ee,{children:[(0,$.jsxs)(g,{children:[(0,$.jsx)(re,{children:`Delete move size?`}),(0,$.jsxs)(te,{children:[`This will delete `,(0,$.jsx)(`b`,{children:e.name}),`. Move sizes that have already been used cannot be deleted.`]})]}),(0,$.jsxs)(ne,{children:[(0,$.jsx)(h,{children:`Cancel`}),(0,$.jsx)(A,{type:`button`,loading:s,disabled:s,className:`mt-2 sm:mt-0`,onClick:async()=>{o({id:e?.id}).unwrap().then(()=>{X.success(`Move size deleted`),y()}).catch(e=>{J(e)})},variant:`destructive`,children:`Delete`})]})]})]})})]}),(0,$.jsxs)(L,{children:[(0,$.jsx)(P,{asChild:!0,children:(0,$.jsx)(_,{type:`button`,variant:`outline`,children:`Cancel`})}),(0,$.jsx)(A,{type:`button`,loading:r||a,disabled:r||a,onClick:f.handleSubmit(v),children:e?`Save changes`:`Add move size`})]})]})]})}function Ve({item:t}){let{attributes:r,listeners:i,setNodeRef:a,transform:o,transition:s,isDragging:c}=f({id:t.id}),l={transform:e.Transform.toString(o),transition:s,zIndex:c?1e3:`auto`,position:c?`relative`:`static`};return(0,$.jsxs)(`div`,{className:`flex items-center gap-2`,ref:a,style:l,children:[(0,$.jsx)(_,{size:`icon`,variant:`ghost`,className:`cursor-grab`,...r,...i,children:(0,$.jsx)(n,{})}),(0,$.jsx)(`div`,{className:`@container w-full`,children:(0,$.jsxs)(`div`,{className:K(`grid w-full grid-cols-[max-content_1fr_max-content] @lg:grid-cols-9 border rounded-md items-center gap-2 p-4`,{"bg-background shadow-lg":c}),children:[(0,$.jsx)(`div`,{children:(0,$.jsx)(`img`,{src:t.image_url??`https://www.thehighlands.org/sites/default/files/styles/hero/public/one-bedroom-3d.png?itok=1Y5yuPSu`,alt:t.name,className:`size-10 object-cover`})}),(0,$.jsxs)(`div`,{className:`overflow-hidden @lg:col-span-4`,children:[(0,$.jsx)(`p`,{className:`truncate font-semibold`,children:t.name}),(0,$.jsx)(`p`,{className:`truncate text-sm`,children:t.description})]}),(0,$.jsxs)(`div`,{className:`hidden @lg:flex @lg:col-span-2 gap-4`,children:[(0,$.jsxs)(`div`,{className:`items-center flex gap-2 text-muted-foreground`,children:[(0,$.jsx)(le,{className:`size-4`}),(0,$.jsx)(`p`,{className:`truncate text-sm font-medium`,children:t.truck_count??1})]}),(0,$.jsxs)(`div`,{className:`items-center flex gap-2 text-muted-foreground`,children:[(0,$.jsx)(Oe,{className:`size-4`}),(0,$.jsxs)(`p`,{className:`truncate text-sm font-medium`,children:[t.volume||100,` cbf`]})]})]}),(0,$.jsx)(`div`,{className:`flex justify-end @lg:col-span-2`,children:(0,$.jsx)(Be,{data:t})})]})})]})}function He({items:e,setItems:n,setOrderChanged:f}){let p=d(u(i),u(r,{coordinateGetter:l}));function m(t){let{active:r,over:i}=t;if(i&&r.id!==i.id){let t=e.findIndex(e=>e.id===r.id),a=e.findIndex(e=>e.id===i.id),s=o(e,t,a),c=s.map((e,t)=>({...e,index:t}));n(c),f(!0)}}return(0,$.jsx)(t,{sensors:p,collisionDetection:s,onDragEnd:m,modifiers:[c],children:(0,$.jsx)(a,{items:e,children:(0,$.jsx)(`div`,{className:`space-y-4`,children:e?.map(e=>(0,$.jsx)(Ve,{item:e},e.id))})})})}function Ue(){let{data:e,isLoading:t,isError:n}=Ce(),[r,{isLoading:i}]=_e(),[a,o]=(0,Q.useState)([]),[s,c]=(0,Q.useState)(!1);return(0,Q.useEffect)(()=>{e&&o(e)},[e]),(0,$.jsxs)(v,{className:`max-w-3xl`,children:[(0,$.jsxs)(b,{className:`flex flex-row justify-between`,children:[(0,$.jsx)(x,{children:`Move Size`}),(0,$.jsx)(Be,{})]}),(0,$.jsxs)(ae,{children:[n&&(0,$.jsx)(`div`,{children:(0,$.jsx)(`p`,{className:`text-muted-foreground text-center`,children:`Failed to fetch move sizes`})}),t&&(0,$.jsx)(`div`,{className:`space-y-4`,children:Array.from({length:5}).map((e,t)=>(0,$.jsx)(V,{className:`h-18.5 w-full`},t))}),e&&(0,$.jsx)(He,{items:a,setItems:o,setOrderChanged:c})]}),(0,$.jsx)(oe,{className:`justify-end border-t`,children:(0,$.jsxs)(`div`,{className:K(`flex transition-opacity gap-3 duration-500`,{"invisible opacity-0":!s,"visible opacity-100":s}),children:[(0,$.jsx)(_,{type:`button`,variant:`outline`,onClick:()=>{o(e??[]),c(!1)},children:`Cancel`}),(0,$.jsx)(A,{type:`button`,disabled:i,loading:i,onClick:()=>{r({moveSizes:a}).unwrap().then(()=>{X.success(`Changes saved`),c(!1)}).catch(e=>{J(e)})},children:`Save changes`})]})})]})}function We(){let e=we();return e.id?(0,$.jsx)(se,{}):(0,$.jsx)(Ee,{children:(0,$.jsxs)(`div`,{className:`space-y-4`,children:[(0,$.jsx)(Ue,{}),(0,$.jsx)(Pe,{})]})})}const Ge=We;export{Ge as Component};