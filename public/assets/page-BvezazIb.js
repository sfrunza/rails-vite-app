import{ChevronLeft as e,ChevronRight as t,PageContainer as n,ScrollArea as r,ScrollBar as i,Tabs as a,TabsList as o,TabsTrigger as s,UserRound as c,__toESM as l,buttonVariants as u,cn as d,createLucideIcon as f,format as p,formatDate as m,formatPhone as h,generatePagination as g,priceObjectToString as _,requestsApi as v,require_jsx_runtime as y,require_react as b,setFilter as x,setPage as S,statusBgColors as C,statusTextColors as w,store as T,tabOptions as E,useAppDispatch as D,useAppSelector as O,useGetMoveSizesQuery as k,useGetRequestsQuery as A,useGetServicesQuery as j,useGetStatusCountsQuery as M,useNavigate as N}from"./index-OmLcTgDE.js";import{Badge as P}from"./badge-puQm4UnR.js";import{useRequestsSubscription as F}from"./use-requests-subscription-CIb2D-0b.js";import{Table as I,TableBody as L,TableCell as R,TableHead as z,TableHeader as B,TableRow as V}from"./table-Bp_V9RDd.js";const H=[[`circle`,{cx:`12`,cy:`12`,r:`1`,key:`41hilf`}],[`circle`,{cx:`19`,cy:`12`,r:`1`,key:`1wjl8i`}],[`circle`,{cx:`5`,cy:`12`,r:`1`,key:`1pcz8c`}]],U=f(`ellipsis`,H);var W=l(b()),G=l(y());const K={"Moving & Storage":`/svg-icons/warehouse.svg`,"Overnight Truck Storage":`/svg-icons/truck.svg`};function q({requests:e}){let t=N(),[n,r]=(0,W.useState)(null),{data:i}=j(),{data:a}=k();function o(e){n===e?t(`/crm/requests/${e}`):(r(e),T.dispatch(v.endpoints.getRequestById.initiate({id:e})))}return(0,G.jsx)(`div`,{className:`min-h-[calc(100vh-200px)]`,children:(0,G.jsxs)(I,{children:[(0,G.jsx)(B,{children:(0,G.jsxs)(V,{children:[(0,G.jsx)(z,{children:`#`}),(0,G.jsx)(z,{children:`Status`}),(0,G.jsx)(z,{children:`Service`}),(0,G.jsx)(z,{children:`Move date`}),(0,G.jsx)(z,{children:`Customer, phone`}),(0,G.jsx)(z,{children:`Moving from`}),(0,G.jsx)(z,{children:`Moving to`}),(0,G.jsx)(z,{children:`Size of move`}),(0,G.jsx)(z,{children:`Crew`}),(0,G.jsx)(z,{children:`Created at`}),(0,G.jsx)(z,{children:`Updated at`}),(0,G.jsx)(z,{className:`text-right`,children:`Est. Quote`})]})}),(0,G.jsx)(L,{children:e?.map(e=>{var t,r,s;let l=i?.find(t=>t.id===e.service_id),u=a?.find(t=>t.id===e.move_size_id),f=e.customer?`${(t=e.customer)?.first_name} ${(r=e.customer)?.last_name}`:``,g=l?.name===`Moving & Storage`||l?.name===`Overnight Truck Storage`,v=e.is_moving_from_storage,y=e?.has_paired_request,b=g&&v&&y,x=g&&!v&&y;return(0,G.jsxs)(V,{className:d(`h-16 text-xs font-medium hover:cursor-pointer`,n===e.id&&`bg-muted`),onClick:()=>o(e?.id),onSelect:()=>o(e?.id),children:[(0,G.jsx)(R,{className:`text-sm font-bold`,children:e.id}),(0,G.jsx)(R,{children:(0,G.jsxs)(P,{className:d(`capitalize py-1 relative overflow-hidden bg-transparent`,w[e.status]),children:[(0,G.jsx)(`span`,{className:`${C[e.status]} absolute inset-0 opacity-15`}),e.status.replace(`_`,` `),(0,G.jsx)(`div`,{className:d(`size-2 rounded-full ml-1`,C[e.status])})]})}),(0,G.jsx)(R,{children:l?.name}),(0,G.jsxs)(R,{children:[m(e.moving_date),(0,G.jsx)(`br`,{}),(0,G.jsx)(J,{movingDate:e.moving_date})]}),(0,G.jsxs)(R,{children:[f??``,(0,G.jsx)(`br`,{}),h((s=e.customer)?.phone)]}),(0,G.jsx)(R,{children:b?(0,G.jsxs)(`div`,{className:`flex items-center gap-2`,children:[(0,G.jsx)(`img`,{src:K[l?.name??``],className:`size-6`}),`From storage`]}):(0,G.jsxs)(G.Fragment,{children:[e.origin.city,(0,G.jsx)(`br`,{}),e.origin.state,` `,e.origin.zip]})}),(0,G.jsx)(R,{className:`items-center gap-2`,children:x?(0,G.jsxs)(`div`,{className:`flex items-center gap-2`,children:[(0,G.jsx)(`img`,{src:K[l?.name??``],className:`size-6`}),`To storage`]}):(0,G.jsxs)(G.Fragment,{children:[e.destination.city,(0,G.jsx)(`br`,{}),e.destination.state,` `,e.destination.zip]})}),(0,G.jsx)(R,{children:u?.name}),(0,G.jsx)(R,{children:e.crew_size&&(0,G.jsxs)(`span`,{className:`flex items-center gap-1`,children:[(0,G.jsx)(c,{className:`size-4`}),e.crew_size]})}),(0,G.jsx)(R,{children:p(e.created_at,`P`)}),(0,G.jsx)(R,{children:p(e.updated_at,`P`)}),(0,G.jsx)(R,{className:`text-right`,children:_(e.total_price)})]},e.id)})})]})})}function J({movingDate:e}){if(!e)return null;let t=new Date;t.setHours(0,0,0,0);let n=new Date(e);n.setHours(0,0,0,0);let r=n.getTime()-t.getTime(),i=Math.ceil(r/(1e3*60*60*24));if(i<0)return null;let a;switch(i){case 0:a=`today`;break;case 1:a=`tomorrow`;break;default:a=`in ${i} days`}let o=i<2?`text-destructive`:`text-green-600`;return(0,G.jsx)(`span`,{className:o,children:a})}function Y({className:e,...t}){return(0,G.jsx)(`nav`,{role:`navigation`,"aria-label":`pagination`,"data-slot":`pagination`,className:d(`mx-auto flex w-full justify-center`,e),...t})}function X({className:e,...t}){return(0,G.jsx)(`ul`,{"data-slot":`pagination-content`,className:d(`flex flex-row items-center gap-1`,e),...t})}function Z({...e}){return(0,G.jsx)(`li`,{"data-slot":`pagination-item`,...e})}function Q({className:e,isActive:t,size:n=`icon`,...r}){return(0,G.jsx)(`a`,{"aria-current":t?`page`:void 0,"data-slot":`pagination-link`,"data-active":t,className:d(u({variant:t?`outline`:`ghost`,size:n}),e),...r})}function $({className:t,...n}){return(0,G.jsxs)(Q,{"aria-label":`Go to previous page`,size:`default`,className:d(`gap-1 px-2.5 sm:pl-2.5`,t),...n,children:[(0,G.jsx)(e,{}),(0,G.jsx)(`span`,{className:`hidden sm:block`,children:`Previous`})]})}function ee({className:e,...n}){return(0,G.jsxs)(Q,{"aria-label":`Go to next page`,size:`default`,className:d(`gap-1 px-2.5 sm:pr-2.5`,e),...n,children:[(0,G.jsx)(`span`,{className:`hidden sm:block`,children:`Next`}),(0,G.jsx)(t,{})]})}function te({className:e,...t}){return(0,G.jsxs)(`span`,{"aria-hidden":!0,"data-slot":`pagination-ellipsis`,className:d(`flex size-9 items-center justify-center`,e),...t,children:[(0,G.jsx)(U,{className:`size-4`}),(0,G.jsx)(`span`,{className:`sr-only`,children:`More pages`})]})}function ne({totalPages:e}){let t=D(),n=O(e=>e.requests.page),a=g(n,e);return(0,G.jsxs)(r,{className:`mx-auto w-full whitespace-nowrap`,children:[(0,G.jsx)(Y,{className:`py-2`,children:(0,G.jsxs)(X,{children:[(0,G.jsx)(Z,{className:`cursor-pointer`,children:(0,G.jsx)($,{onClick:e=>{e.preventDefault(),n>1&&t(S(n-1))}})}),a.map((e,r)=>e===`...`?(0,G.jsx)(Z,{children:(0,G.jsx)(te,{})},r):(0,G.jsx)(Z,{className:`cursor-pointer`,children:(0,G.jsx)(Q,{onClick:()=>{console.log(`Page`),t(S(Number(e)))},isActive:n===e,children:e})},r)),(0,G.jsx)(Z,{className:`cursor-pointer`,children:(0,G.jsx)(ee,{onClick:()=>{n<e&&t(S(n+1))}})})]})}),(0,G.jsx)(i,{orientation:`horizontal`})]})}function re(){let e=D(),{filter:t,page:c}=O(e=>e.requests),{data:l,isFetching:u}=A({filter:t,page:c}),{data:d}=M();return F(),(0,G.jsxs)(n,{className:`h-full p-4`,children:[(0,G.jsx)(a,{value:t,onValueChange:t=>{e(x(t)),e(S(1))},children:(0,G.jsxs)(r,{children:[(0,G.jsx)(o,{className:`h-12`,children:E.map(e=>(0,G.jsxs)(s,{value:e.value,className:`h-full w-[180px] space-x-2`,disabled:u&&e.value===t,children:[(0,G.jsx)(`span`,{className:w[e.value],children:e.label}),(0,G.jsx)(`span`,{className:`${C[e.value]} rounded-full px-1 text-xs font-semibold text-muted`,children:d?.[e.value]??`0`})]},e.value))}),(0,G.jsx)(i,{orientation:`horizontal`})]})}),(0,G.jsx)(q,{requests:l?.requests??[]}),l&&(0,G.jsx)(ne,{totalPages:l.pagination.total_pages})]})}const ie=re;export{ie as Component};