import{ChevronLeft as e}from"./chevron-left-zJdJqyR0.js";import{ChevronRight as t}from"./chevron-right-CRSgIC1I.js";import{UserRound as n}from"./user-round-DophWfLi.js";import{PageContainer as r,ScrollArea as i,ScrollBar as a,__toESM as o,buttonVariants as s,cn as c,createLucideIcon as l,format as u,formatDate as d,formatPhone as f,generatePagination as p,priceObjectToString as m,requestsApi as h,require_jsx_runtime as g,require_react as _,setFilter as v,setPage as y,store as b,useAppDispatch as x,useAppSelector as S,useGetMoveSizesQuery as C,useGetRequestsQuery as w,useGetServicesQuery as T,useGetStatusCountsQuery as E,useNavigate as D}from"./index-BpPvn16n.js";import{Badge as O}from"./badge-6y2efZus.js";import{Tabs as k,TabsList as A,TabsTrigger as j}from"./tabs-ONBK2pzv.js";import{statusBgColors as M,statusTextColors as N,tabOptions as P}from"./cable-BpiuPVb-.js";import{useRequestsSubscription as F}from"./use-requests-subscription-DgHA1tDe.js";import{Table as I,TableBody as L,TableCell as R,TableHead as z,TableHeader as B,TableRow as V}from"./table-CGpTAqU8.js";const H=[[`circle`,{cx:`12`,cy:`12`,r:`1`,key:`41hilf`}],[`circle`,{cx:`19`,cy:`12`,r:`1`,key:`1wjl8i`}],[`circle`,{cx:`5`,cy:`12`,r:`1`,key:`1pcz8c`}]],U=l(`ellipsis`,H);var W=o(_()),G=o(g());const K={"Moving & Storage":`/svg-icons/warehouse.svg`,"Overnight Truck Storage":`/svg-icons/truck.svg`};function q({requests:e}){let t=D(),[r,i]=(0,W.useState)(null),{data:a}=T(),{data:o}=C();function s(e){r===e?t(`/crm/requests/${e}`):(i(e),b.dispatch(h.endpoints.getRequestById.initiate({id:e})))}return(0,G.jsx)(`div`,{className:`min-h-[calc(100vh-200px)]`,children:(0,G.jsxs)(I,{className:`min-w-[1850px]`,children:[(0,G.jsx)(B,{children:(0,G.jsxs)(V,{children:[(0,G.jsx)(z,{children:`#`}),(0,G.jsx)(z,{children:`Status`}),(0,G.jsx)(z,{children:`Service`}),(0,G.jsx)(z,{children:`Move date`}),(0,G.jsx)(z,{children:`Customer, phone`}),(0,G.jsx)(z,{children:`Moving from`}),(0,G.jsx)(z,{children:`Moving to`}),(0,G.jsx)(z,{children:`Size of move`}),(0,G.jsx)(z,{children:`Crew`}),(0,G.jsx)(z,{children:`Created at`}),(0,G.jsx)(z,{children:`Updated at`}),(0,G.jsx)(z,{className:`text-right`,children:`Est. Quote`})]})}),(0,G.jsx)(L,{children:e?.map(e=>{var t,i,l;let p=a?.find(t=>t.id===e.service_id),h=o?.find(t=>t.id===e.move_size_id),g=e.customer?`${(t=e.customer)?.first_name} ${(i=e.customer)?.last_name}`:``,_=p?.name===`Moving & Storage`||p?.name===`Overnight Truck Storage`,v=e.is_moving_from_storage,y=e?.has_paired_request,b=_&&v&&y,x=_&&!v&&y;return(0,G.jsxs)(V,{className:c(`h-16 text-xs font-medium hover:cursor-pointer`,r===e.id&&`bg-muted`),onClick:()=>s(e?.id),onSelect:()=>s(e?.id),children:[(0,G.jsx)(R,{className:`text-sm font-bold`,children:e.id}),(0,G.jsx)(R,{children:(0,G.jsxs)(O,{className:c(`capitalize py-1 relative overflow-hidden bg-transparent`,N[e.status]),children:[(0,G.jsx)(`span`,{className:`${M[e.status]} absolute inset-0 opacity-15`}),e.status.replace(`_`,` `),(0,G.jsx)(`div`,{className:c(`size-2 rounded-full ml-1`,M[e.status])})]})}),(0,G.jsx)(R,{children:p?.name}),(0,G.jsxs)(R,{children:[d(e.moving_date),(0,G.jsx)(`br`,{}),(0,G.jsx)(J,{movingDate:e.moving_date})]}),(0,G.jsxs)(R,{children:[g??``,(0,G.jsx)(`br`,{}),f((l=e.customer)?.phone)]}),(0,G.jsx)(R,{children:b?(0,G.jsxs)(`div`,{className:`flex items-center gap-2`,children:[(0,G.jsx)(`img`,{src:K[p?.name??``],className:`size-6`}),`From storage`]}):(0,G.jsxs)(G.Fragment,{children:[e.origin.city,(0,G.jsx)(`br`,{}),e.origin.state,` `,e.origin.zip]})}),(0,G.jsx)(R,{className:`items-center gap-2`,children:x?(0,G.jsxs)(`div`,{className:`flex items-center gap-2`,children:[(0,G.jsx)(`img`,{src:K[p?.name??``],className:`size-6`}),`To storage`]}):(0,G.jsxs)(G.Fragment,{children:[e.destination.city,(0,G.jsx)(`br`,{}),e.destination.state,` `,e.destination.zip]})}),(0,G.jsx)(R,{children:h?.name}),(0,G.jsx)(R,{children:e.crew_size&&(0,G.jsxs)(`span`,{className:`flex items-center gap-1`,children:[(0,G.jsx)(n,{className:`size-4`}),e.crew_size]})}),(0,G.jsx)(R,{children:u(e.created_at,`P`)}),(0,G.jsx)(R,{children:u(e.updated_at,`P`)}),(0,G.jsx)(R,{className:`text-right`,children:m(e.total_price)})]},e.id)})})]})})}function J({movingDate:e}){if(!e)return null;let t=new Date;t.setHours(0,0,0,0);let n=new Date(e);n.setHours(0,0,0,0);let r=n.getTime()-t.getTime(),i=Math.ceil(r/(1e3*60*60*24));if(i<0)return null;let a;switch(i){case 0:a=`today`;break;case 1:a=`tomorrow`;break;default:a=`in ${i} days`}let o=i<2?`text-destructive`:`text-green-600`;return(0,G.jsx)(`span`,{className:o,children:a})}function Y({className:e,...t}){return(0,G.jsx)(`nav`,{role:`navigation`,"aria-label":`pagination`,"data-slot":`pagination`,className:c(`mx-auto flex w-full justify-center`,e),...t})}function X({className:e,...t}){return(0,G.jsx)(`ul`,{"data-slot":`pagination-content`,className:c(`flex flex-row items-center gap-1`,e),...t})}function Z({...e}){return(0,G.jsx)(`li`,{"data-slot":`pagination-item`,...e})}function Q({className:e,isActive:t,size:n=`icon`,...r}){return(0,G.jsx)(`a`,{"aria-current":t?`page`:void 0,"data-slot":`pagination-link`,"data-active":t,className:c(s({variant:t?`outline`:`ghost`,size:n}),e),...r})}function $({className:t,...n}){return(0,G.jsxs)(Q,{"aria-label":`Go to previous page`,size:`default`,className:c(`gap-1 px-2.5 sm:pl-2.5`,t),...n,children:[(0,G.jsx)(e,{}),(0,G.jsx)(`span`,{className:`hidden sm:block`,children:`Previous`})]})}function ee({className:e,...n}){return(0,G.jsxs)(Q,{"aria-label":`Go to next page`,size:`default`,className:c(`gap-1 px-2.5 sm:pr-2.5`,e),...n,children:[(0,G.jsx)(`span`,{className:`hidden sm:block`,children:`Next`}),(0,G.jsx)(t,{})]})}function te({className:e,...t}){return(0,G.jsxs)(`span`,{"aria-hidden":!0,"data-slot":`pagination-ellipsis`,className:c(`flex size-9 items-center justify-center`,e),...t,children:[(0,G.jsx)(U,{className:`size-4`}),(0,G.jsx)(`span`,{className:`sr-only`,children:`More pages`})]})}function ne({totalPages:e}){let t=x(),n=S(e=>e.requests.page),r=p(n,e);return(0,G.jsxs)(i,{className:`mx-auto w-full whitespace-nowrap`,children:[(0,G.jsx)(Y,{className:`py-2`,children:(0,G.jsxs)(X,{children:[(0,G.jsx)(Z,{className:`cursor-pointer`,children:(0,G.jsx)($,{onClick:e=>{e.preventDefault(),n>1&&t(y(n-1))}})}),r.map((e,r)=>e===`...`?(0,G.jsx)(Z,{children:(0,G.jsx)(te,{})},r):(0,G.jsx)(Z,{className:`cursor-pointer`,children:(0,G.jsx)(Q,{onClick:()=>{console.log(`Page`),t(y(Number(e)))},isActive:n===e,children:e})},r)),(0,G.jsx)(Z,{className:`cursor-pointer`,children:(0,G.jsx)(ee,{onClick:()=>{n<e&&t(y(n+1))}})})]})}),(0,G.jsx)(a,{orientation:`horizontal`})]})}function re(){let e=x(),{filter:t,page:n}=S(e=>e.requests),{data:o}=E(),{data:s,isFetching:l}=w({filter:t,page:n});return F(),(0,G.jsxs)(r,{className:`h-full p-4`,children:[(0,G.jsx)(k,{value:t,onValueChange:t=>{e(v(t)),e(y(1))},children:(0,G.jsxs)(i,{children:[(0,G.jsx)(A,{className:`h-12`,children:P.map(e=>(0,G.jsxs)(j,{value:e.value,className:c(`h-full w-[180px] space-x-2`,`data-[state=active]:${N[e.value]}`,N[e.value]),disabled:l&&e.value===t,children:[(0,G.jsx)(`span`,{children:e.label}),(0,G.jsx)(`span`,{className:`${M[e.value]} rounded-full px-1 text-xs font-semibold text-muted`,children:o?.[e.value]??`0`})]},e.value))}),(0,G.jsx)(a,{orientation:`horizontal`})]})}),(0,G.jsx)(q,{requests:s?.requests??[]}),s&&(0,G.jsx)(ne,{totalPages:s.total_pages})]})}const ie=re;export{ie as Component};