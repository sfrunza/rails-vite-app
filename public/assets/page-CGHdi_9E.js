import{r as m,i as b,j as e,B as x,L as g,t as j,h as p,g as v,k as y,S as D,l as N,m as w,n as F,o as A,p as I,q as k,s as T,v as E,w as M}from"./index-vAGt-f52.js";import{C as L,a as P,b as _,f as O,d as q,e as z}from"./card-CWI6snem.js";import{S as B}from"./skeleton-D752WA-Z.js";import{S as G}from"./setting-page-wrapper-CyrpOe_k.js";import{A as H,a as K,T as U,b as V,c as R,d as Q,e as W,f as J,g as X,u as Y,C as Z,G as $,h as ee,i as f,D as se,r as ae,j as ne,S as re,k as te,s as ie,K as oe,P as ce,l as le}from"./alert-dialog-Ce1JlXF6.js";import{S as de}from"./switch-CrTJokne.js";import{u as he,F as ue,a as me,b as xe,c as ge,d as je,e as pe,f as fe,s as ve,o as Se,g as Ce}from"./zod-C_KwkjaP.js";import{I as be}from"./input-CFKrCl28.js";import"./label-BU8_j3lX.js";function ye({service:s}){const[n,i]=m.useState(!1),[l,{isLoading:r}]=b();return e.jsxs(H,{open:n,onOpenChange:i,children:[e.jsx(K,{asChild:!0,children:e.jsx(x,{variant:"ghost",size:"icon",className:"hover:text-destructive",children:e.jsx(U,{})})}),e.jsxs(V,{children:[e.jsxs(R,{children:[e.jsx(Q,{children:"Delete moving service?"}),e.jsxs(W,{children:["This will delete ",e.jsxs("b",{children:[s.name,"."]})," Services that have already been used cannot be deleted."]})]}),e.jsxs(J,{children:[e.jsx(X,{children:"Cancel"}),e.jsx(g,{type:"button",loading:r,disabled:r,variant:"destructive",onClick:()=>{l({id:s.id}).unwrap().then(()=>{j.success("Moving service deleted"),i(!1)}).catch(o=>{p(o)})},children:"Delete"})]})]})]})}function De({id:s,item:n,onEnabledChange:i}){const{attributes:l,listeners:r,setNodeRef:o,transform:a,transition:c,isDragging:t}=Y({id:s}),d={transform:Z.Transform.toString(a),transition:c,zIndex:t?1e3:"auto",position:t?"relative":"static"};return e.jsxs("div",{ref:o,style:d,className:v("grid grid-cols-[max-content_1fr_max-content_max-content] border rounded-md items-center gap-2 p-2",{"bg-background shadow-lg":t}),children:[e.jsx(x,{size:"icon",variant:"ghost",className:"flex min-w-6 cursor-grab",...l,...r,children:e.jsx($,{})}),e.jsx("div",{className:"overflow-hidden",children:e.jsx("p",{className:"truncate text-sm font-medium",children:n.name})}),e.jsx(de,{checked:n.enabled,onCheckedChange:h=>{i(n.id,h)}}),n.is_default?e.jsx("div",{className:"size-9"}):e.jsx(ye,{service:n})]})}function Ne({items:s,setItems:n,setOrderChanged:i}){const l=ee(f(ce),f(oe,{coordinateGetter:ie}));function r(a){const{active:c,over:t}=a;if(t&&c.id!==t.id){const d=s.findIndex(u=>u.id===c.id),h=s.findIndex(u=>u.id===t.id),S=te(s,d,h).map((u,C)=>({...u,index:C}));n(S),i(!0)}}function o(a,c){n(s.map(t=>t.id===a?{...t,enabled:c}:t)),i(!0)}return e.jsx(se,{sensors:l,collisionDetection:ne,onDragEnd:r,modifiers:[ae],children:e.jsx(re,{items:s,children:e.jsx("div",{className:"space-y-2",children:s.map(a=>e.jsx(De,{id:a.id,item:a,onEnabledChange:o},a.id))})})})}const we=Se({name:Ce({required_error:"Name is required."}).min(5,{message:"Name must be at least 5 characters long."})});function Fe(){const[s,{isLoading:n}]=y(),[i,l]=m.useState(!1),r=he({mode:"onChange",reValidateMode:"onChange",resolver:ve(we),defaultValues:{name:""}});function o(a){s(a).unwrap().then(()=>{j.success("Service created"),l(!1),r.reset()}).catch(c=>{p(c)})}return e.jsxs(D,{open:i,onOpenChange:l,children:[e.jsx(N,{asChild:!0,children:e.jsxs(x,{children:[e.jsx(le,{}),"Create service"]})}),e.jsxs(w,{children:[e.jsxs(F,{children:[e.jsx(A,{children:"Add moving service"}),e.jsx(I,{className:"sr-only"})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4",children:e.jsx(ue,{...r,children:e.jsx("form",{onSubmit:r.handleSubmit(o),className:"space-y-6",children:e.jsx(me,{control:r.control,name:"name",render:({field:a})=>e.jsxs(xe,{children:[e.jsx(ge,{children:"Name (required)"}),e.jsx(je,{children:"Name of the moving service, visible to customers."}),e.jsx(pe,{children:e.jsx(be,{...a,autoComplete:"off"})}),e.jsx(fe,{})]})})})})}),e.jsxs(k,{children:[e.jsx(T,{asChild:!0,children:e.jsx(x,{type:"button",variant:"outline",className:"w-full",children:"Cancel"})}),e.jsx(g,{type:"button",loading:n,disabled:n,onClick:r.handleSubmit(o),className:"w-full",children:"Add service"})]})]})]})}function Ae(){const{data:s,isLoading:n,isError:i}=E(),[l,{isLoading:r}]=M(),[o,a]=m.useState([]),[c,t]=m.useState(!1);return m.useEffect(()=>{s&&a(s)},[s]),e.jsx(G,{children:e.jsxs(L,{className:"max-w-xl",children:[e.jsxs(P,{children:[e.jsx(_,{children:"Moving Services"}),e.jsx(O,{children:e.jsx(Fe,{})})]}),e.jsxs(q,{children:[i&&e.jsx("div",{children:e.jsx("p",{className:"text-muted-foreground text-center",children:"Failed to fetch services"})}),n&&e.jsx("div",{className:"space-y-2",children:Array.from({length:5}).map((d,h)=>e.jsx(B,{className:"h-13.5 w-full"},h))}),s&&e.jsx(Ne,{items:o,setItems:a,setOrderChanged:t})]}),e.jsx(z,{className:"justify-end border-t",children:e.jsxs("div",{className:v("flex transition-opacity gap-3 duration-500",{"invisible opacity-0":!c,"visible opacity-100":c}),children:[e.jsx(x,{type:"button",variant:"outline",onClick:()=>{a(s??[]),t(!1)},children:"Cancel"}),e.jsx(g,{type:"button",disabled:r,loading:r,onClick:()=>{l({services:o}).unwrap().then(()=>{j.success("Changes saved"),t(!1)}).catch(d=>{p(d)})},children:"Save changes"})]})})]})})}const ze=Ae;export{ze as Component};
