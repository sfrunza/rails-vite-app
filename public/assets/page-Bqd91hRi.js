import{w as L,r as p,j as e,S as P,k as z,B as f,l as B,m as M,n as O,o as q,p as G,q as V,L as S,t as v,h as C,x as H,g as A,y as K,z as b,A as U}from"./index-BrQi1v-c.js";import{C as R,a as Q,b as W,f as $,d as J}from"./card-Cim6kUnN.js";import{S as X}from"./setting-page-wrapper-lwIfDS-L.js";import{u as Y,F as Z,a as N,b as y,c as D,d as ee,e as E,f as se,s as re,o as ae,h as te,g as ne}from"./zod-CKf-_hsS.js";import{I}from"./input-B52D2lzl.js";import{N as F}from"./numeric-input-CE3LjWwX.js";import{P as ie}from"./plus-DlXTtDVQ.js";import{S as oe,a as le}from"./scroll-area-Dlxjw5UU.js";import{A as ce,a as de,T as xe,b as me,c as he,d as ue,e as je,f as pe,g as fe,u as ge,C as Se,G as ve,h as Ce,i as w,D as be,r as Ne,j as ye,S as De,s as Ee,K as we,P as Ae,k as Ie}from"./alert-dialog-DDQSTuhp.js";import{S as Fe}from"./switch-BF-SWcQn.js";import{S as ke}from"./skeleton-CQuYJPyZ.js";import"./label-CbHfFtVG.js";import"./index-CT2Pw8Do.js";const Te=ae({name:ne({required_error:"Name is required."}).min(1,{message:"Name must be at least 1 character long."}),price:te.number().min(0)});function _e(){const[a,{isLoading:r}]=L(),[t,c]=p.useState(!1),s=Y({mode:"onChange",reValidateMode:"onChange",resolver:re(Te),defaultValues:{name:"",price:0}});function i(o){a(o).unwrap().then(()=>{v.success("Service created"),c(!1),s.reset()}).catch(l=>{C(l)})}return e.jsxs(P,{open:t,onOpenChange:c,children:[e.jsx(z,{asChild:!0,children:e.jsxs(f,{children:[e.jsx(ie,{}),"Create service"]})}),e.jsxs(B,{children:[e.jsxs(M,{children:[e.jsx(O,{children:"Add extra service"}),e.jsx(q,{className:"sr-only"})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4",children:e.jsx(Z,{...s,children:e.jsxs("form",{onSubmit:s.handleSubmit(i),className:"space-y-6",children:[e.jsx(N,{control:s.control,name:"name",render:({field:o})=>e.jsxs(y,{children:[e.jsx(D,{children:"Name (required)"}),e.jsx(ee,{children:"Name of the extra service, visible to customers."}),e.jsx(E,{children:e.jsx(I,{...o,autoComplete:"off"})}),e.jsx(se,{})]})}),e.jsx(N,{control:s.control,name:"price",render:({field:o})=>e.jsxs(y,{children:[e.jsx(D,{children:"Price"}),e.jsx(E,{children:e.jsx(F,{value:(o.value/100).toString(),min:0,max:1e4,step:.01,allowDecimals:!0,onChange:l=>{o.onChange(Number(l)*100)}})})]})})]})})}),e.jsxs(G,{children:[e.jsx(V,{asChild:!0,children:e.jsx(f,{type:"button",variant:"outline",className:"w-full",children:"Cancel"})}),e.jsx(S,{type:"button",loading:r,disabled:r,onClick:s.handleSubmit(i),className:"w-full",children:"Add service"})]})]})]})}function Le({extraService:a}){const[r,t]=p.useState(!1),[c,{isLoading:s}]=H();return e.jsxs(ce,{open:r,onOpenChange:t,children:[e.jsx(de,{asChild:!0,children:e.jsx(f,{variant:"outline",size:"icon",className:"hover:text-destructive",children:e.jsx(xe,{})})}),e.jsxs(me,{children:[e.jsxs(he,{children:[e.jsx(ue,{children:"Delete extra service?"}),e.jsxs(je,{children:["This will delete ",e.jsxs("b",{children:[a.name,"."]})]})]}),e.jsxs(pe,{children:[e.jsx(fe,{children:"Cancel"}),e.jsx(S,{type:"button",loading:s,disabled:s,variant:"destructive",onClick:()=>{c({id:a.id}).unwrap().then(()=>{v.success("Extra service deleted"),t(!1)}).catch(i=>{C(i)})},children:"Delete"})]})]})]})}function Pe({id:a,item:r,onChange:t}){const{attributes:c,listeners:s,setNodeRef:i,transform:o,transition:l,isDragging:m}=ge({id:a}),g={transform:Se.Transform.toString(o),transition:l,zIndex:m?1e3:"auto",position:m?"relative":"static"};return e.jsxs("div",{ref:i,style:g,className:A("grid grid-cols-[max-content_3fr_1fr_1fr_1fr] items-center gap-4 p-2",{"bg-background shadow-lg":m}),children:[e.jsx(f,{size:"icon",variant:"ghost",className:"flex min-w-6 cursor-grab",...c,...s,children:e.jsx(ve,{})}),e.jsx(I,{name:r.name,value:r.name,onChange:d=>{const n=d.target.value;t(r.id,{name:n})}}),e.jsx(F,{defaultValue:(r.price/100).toString(),min:0,max:1e4,step:.01,allowDecimals:!0,onChange:d=>{t(r.id,{price:Number(d)*100})}}),e.jsx(Fe,{checked:r.enabled,onCheckedChange:d=>{t(r.id,{enabled:d})}}),e.jsx("div",{className:"flex justify-end",children:e.jsx(Le,{extraService:r})})]})}function ze({extraServices:a,isLoading:r}){const[t,{isLoading:c}]=K(),[s,i]=p.useState([]),[o,l]=p.useState(!1),m=Ce(w(Ae),w(we,{coordinateGetter:Ee}));p.useEffect(()=>{a&&i(a)},[a]);function g(n){const{active:x,over:h}=n;if(h&&x.id!==h.id){const u=s.findIndex(j=>j.id===x.id),k=s.findIndex(j=>j.id===h.id),T=Ie(s,u,k).map((j,_)=>({...j,index:_}));i(T),l(!0)}}function d(n,x){i(h=>h.map(u=>u.id===n?{...u,...x}:u)),l(!0)}return e.jsxs("div",{className:"flex flex-col gap-6",children:[e.jsxs(oe,{className:"w-full",children:[e.jsxs("div",{className:"mb-4 grid grid-cols-[max-content_3fr_1fr_1fr_1fr] items-center gap-4 text-sm font-medium text-muted-foreground",children:[e.jsx("p",{className:"size-9"}),e.jsx("p",{children:"Service name"}),e.jsx("p",{children:"Service cost, $"}),e.jsx("p",{children:"Enable"}),e.jsx("p",{})]}),e.jsx(b,{}),r&&e.jsx("div",{className:"space-y-2 pt-4",children:Array.from({length:5}).map((n,x)=>e.jsx(ke,{className:"h-13 w-full"},x))}),e.jsx(be,{sensors:m,collisionDetection:ye,onDragEnd:g,modifiers:[Ne],children:e.jsx(De,{items:s,children:e.jsx("div",{className:"pt-4 min-w-[700px] space-y-2",children:s.map(n=>e.jsx(Pe,{id:n.id,item:n,onChange:d},n.id))})})}),e.jsx(le,{orientation:"horizontal"})]}),e.jsx(b,{}),e.jsxs("div",{className:A("flex transition-opacity gap-3 duration-500 justify-end",{"invisible opacity-0":!o,"visible opacity-100":o}),children:[e.jsx(f,{type:"button",variant:"outline",onClick:()=>{i(a),l(!1)},children:"Cancel"}),e.jsx(S,{type:"button",disabled:c,loading:c,onClick:()=>{t({extra_services:s}).unwrap().then(()=>{v.success("Changes saved"),l(!1)}).catch(n=>{C(n)})},children:"Save changes"})]})]})}function Be(){const{data:a,isLoading:r,isError:t}=U();return e.jsx(X,{children:e.jsxs(R,{className:"max-w-4xl",children:[e.jsxs(Q,{children:[e.jsx(W,{children:"Extra Services"}),e.jsx($,{children:e.jsx(_e,{})})]}),e.jsxs(J,{children:[t&&e.jsx("div",{children:e.jsx("p",{className:"text-muted-foreground text-center",children:"Failed to fetch services"})}),e.jsx(ze,{extraServices:a??[],isLoading:r})]})]})})}const Ye=Be;export{Ye as Component};
