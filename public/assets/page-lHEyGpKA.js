import{CSS as e,DndContext as t,GripVertical as n,KeyboardSensor as r,PointerSensor as i,SortableContext as a,arrayMove as o,closestCenter as s,restrictToParentElement as c,sortableKeyboardCoordinates as l,useSensor as u,useSensors as ee,useSortable as d}from"./sortable.esm-DD4nrChD.js";import{PenLine as f}from"./pen-line-Cche-2Y9.js";import{AlertDialog as p,AlertDialogCancel as te,AlertDialogContent as m,AlertDialogDescription as h,AlertDialogFooter as g,AlertDialogHeader as _,AlertDialogTitle as v,AlertDialogTrigger as y,Button as b,Card as x,CardAction as ne,CardContent as re,CardFooter as ie,CardHeader as ae,CardTitle as oe,Form as se,FormControl as S,FormDescription as C,FormField as w,FormItem as T,FormLabel as E,FormMessage as D,Input as O,LoadingButton as k,NumericInput as A,Plus as j,Sheet as M,SheetClose as N,SheetContent as P,SheetDescription as F,SheetFooter as I,SheetHeader as L,SheetTitle as R,SheetTrigger as z,Skeleton as B,Textarea as V,Trash2 as H,__toESM as U,a as W,cn as G,coerce as K,handleApiError as q,objectType as ce,require_jsx_runtime as le,require_react as ue,stringType as J,toast as Y,useBulkUpdatePackingsMutation as de,useCreatePackingMutation as fe,useDeletePackingMutation as pe,useForm as me,useGetPackingsQuery as he,useUpdatePackingMutation as ge}from"./index-OmLcTgDE.js";import{SettingPageWrapper as X}from"./setting-page-wrapper-DsxRRjvs.js";var Z=U(ue()),Q=U(le());const _e=ce({name:J().min(1,{message:`Name is required.`}),description:J().optional(),labor_increase:K.number().min(0).max(100)});function $({data:e}){let[t,{isLoading:n}]=fe(),[r,{isLoading:i}]=ge(),[a,o]=(0,Z.useState)(!1),s=!!e,c=me({mode:`onChange`,reValidateMode:`onChange`,resolver:W(_e),values:e??void 0,defaultValues:{name:``,description:``,labor_increase:0}});async function l(n){let i=s?await r({id:e.id,...n}):await t(n);if(`error`in i){let e=i.error;if(e.status===422){let t=e.data;for(let[e,n]of Object.entries(t))Array.isArray(n)&&c.setError(e,{type:`server`,message:n.join(`, `)})}return}Y.success(`Packing ${s?`updated`:`added`}`),o(!1)}function u(){c.reset(),o(e=>!e)}return(0,Q.jsxs)(M,{open:a,onOpenChange:u,children:[(0,Q.jsx)(z,{asChild:!0,children:s?(0,Q.jsx)(b,{variant:`ghost`,size:`icon`,children:(0,Q.jsx)(f,{})}):(0,Q.jsxs)(b,{children:[(0,Q.jsx)(j,{}),`Create packing`]})}),(0,Q.jsxs)(P,{children:[(0,Q.jsxs)(L,{children:[(0,Q.jsxs)(R,{children:[s?`Update`:`Add`,` packing service`]}),(0,Q.jsx)(F,{className:`sr-only`})]}),(0,Q.jsx)(`div`,{className:`flex-1 overflow-y-auto p-4`,children:(0,Q.jsx)(se,{...c,children:(0,Q.jsxs)(`form`,{onSubmit:c.handleSubmit(l),className:`space-y-6`,children:[(0,Q.jsx)(w,{control:c.control,name:`name`,render:({field:e})=>(0,Q.jsxs)(T,{children:[(0,Q.jsx)(E,{children:`Name (required)`}),(0,Q.jsx)(C,{children:`Name of the packing service, visible to customers.`}),(0,Q.jsx)(S,{children:(0,Q.jsx)(O,{...e,autoComplete:`off`})}),(0,Q.jsx)(D,{})]})}),(0,Q.jsx)(w,{control:c.control,name:`description`,render:({field:e})=>(0,Q.jsxs)(T,{children:[(0,Q.jsx)(E,{children:`Description`}),(0,Q.jsx)(C,{children:`Appears on the customer portal, and in quotes.`}),(0,Q.jsx)(S,{children:(0,Q.jsx)(V,{...e,rows:3})})]})}),(0,Q.jsx)(w,{control:c.control,name:`labor_increase`,render:({field:e})=>(0,Q.jsxs)(T,{children:[(0,Q.jsx)(E,{children:`Labor increse (%)`}),(0,Q.jsx)(S,{children:(0,Q.jsx)(A,{value:e.value.toString(),min:0,max:100,onChange:t=>{e.onChange(t)}})}),(0,Q.jsx)(D,{})]})})]})})}),(0,Q.jsxs)(I,{children:[(0,Q.jsx)(N,{asChild:!0,children:(0,Q.jsx)(b,{type:`button`,variant:`outline`,children:`Cancel`})}),(0,Q.jsx)(k,{type:`button`,loading:n||i,disabled:n||i,onClick:c.handleSubmit(l),children:`${s?`Update`:`Add`} packing`})]})]})]})}function ve({packing:e}){let[t,n]=(0,Z.useState)(!1),[r,{isLoading:i}]=pe();return(0,Q.jsxs)(p,{open:t,onOpenChange:n,children:[(0,Q.jsx)(y,{asChild:!0,children:(0,Q.jsx)(b,{variant:`ghost`,size:`icon`,className:`hover:text-destructive`,children:(0,Q.jsx)(H,{})})}),(0,Q.jsxs)(m,{children:[(0,Q.jsxs)(_,{children:[(0,Q.jsx)(v,{children:`Delete packing?`}),(0,Q.jsxs)(h,{children:[`This will delete `,(0,Q.jsxs)(`b`,{children:[e.name,`.`]}),(0,Q.jsx)(`br`,{}),`Packing services that have already been used cannot be deleted.`]})]}),(0,Q.jsxs)(g,{children:[(0,Q.jsx)(te,{children:`Cancel`}),(0,Q.jsx)(k,{type:`button`,loading:i,disabled:i,variant:`destructive`,onClick:()=>{r({id:e.id}).unwrap().then(()=>{Y.success(`Packing deleted`),n(!1)}).catch(e=>{q(e)})},children:`Delete`})]})]})]})}function ye({item:t}){let r=t.is_default,{attributes:i,listeners:a,setNodeRef:o,transform:s,transition:c,isDragging:l}=d({id:t.id}),u={transform:e.Transform.toString(s),transition:c,zIndex:l?1e3:`auto`,position:l?`relative`:`static`};return(0,Q.jsxs)(`div`,{ref:r?null:o,style:u,className:G(`grid grid-cols-[1fr_auto_auto] border rounded-md p-2`,{"bg-background shadow-lg":l}),children:[(0,Q.jsxs)(`div`,{className:`flex items-center gap-2`,children:[(0,Q.jsx)(b,{size:`icon`,variant:`ghost`,className:`cursor-grab`,disabled:r,...r?{}:i,...r?{}:a,children:(0,Q.jsx)(n,{})}),(0,Q.jsx)(`div`,{className:`overflow-hidden`,children:(0,Q.jsx)(`p`,{className:`truncate text-sm font-medium`,children:t.name})})]}),(0,Q.jsx)($,{data:t}),r?(0,Q.jsx)(b,{variant:`ghost`,disabled:!0,size:`icon`,children:(0,Q.jsx)(`span`,{className:`sr-only`,children:`Default`})}):null,!r&&(0,Q.jsx)(ve,{packing:t})]})}function be({items:e,setItems:n,setOrderChanged:d}){let f=ee(u(i),u(r,{coordinateGetter:l}));function p(t){let{active:r,over:i}=t;if(i&&r.id!==i.id){let t=e.findIndex(e=>e.id===r.id),a=e.findIndex(e=>e.id===i.id),s=o(e,t,a).map((e,t)=>({...e,index:t}));n(s),d(!0)}}return(0,Q.jsx)(t,{sensors:f,collisionDetection:s,onDragEnd:p,modifiers:[c],children:(0,Q.jsx)(a,{items:e,children:(0,Q.jsx)(`div`,{className:`space-y-2`,children:e.map(e=>(0,Q.jsx)(ye,{item:e},e.id))})})})}function xe(){let{data:e,isLoading:t,isError:n}=he(),[r,{isLoading:i}]=de(),[a,o]=(0,Z.useState)([]),[s,c]=(0,Z.useState)(!1);return(0,Z.useEffect)(()=>{e&&o(e)},[e]),(0,Q.jsx)(X,{children:(0,Q.jsxs)(x,{className:`max-w-2xl`,children:[(0,Q.jsxs)(ae,{children:[(0,Q.jsx)(oe,{children:`Packing Services`}),(0,Q.jsx)(ne,{children:(0,Q.jsx)($,{})})]}),(0,Q.jsxs)(re,{children:[n&&(0,Q.jsx)(`div`,{children:(0,Q.jsx)(`p`,{className:`text-muted-foreground text-center`,children:`Failed to fetch packings`})}),t&&(0,Q.jsx)(`div`,{className:`space-y-2`,children:Array.from({length:3}).map((e,t)=>(0,Q.jsx)(B,{className:`h-17.5 w-full`},t))}),e&&(0,Q.jsx)(be,{items:a,setItems:o,setOrderChanged:c})]}),(0,Q.jsx)(ie,{className:`justify-end border-t`,children:(0,Q.jsxs)(`div`,{className:G(`flex transition-opacity duration-500 gap-3`,{"invisible opacity-0":!s,"visible opacity-100":s}),children:[(0,Q.jsx)(b,{type:`button`,variant:`outline`,onClick:()=>{o(e??[]),c(!1)},children:`Cancel`}),(0,Q.jsx)(k,{type:`button`,disabled:i,loading:i,onClick:()=>{r({packings:a}).unwrap().then(()=>{c(!1),Y.success(`Changes saved`)}).catch(e=>{q(e)})},children:`Save changes`})]})})]})})}const Se=xe;export{Se as Component};