import"./chevron-left-zJdJqyR0.js";import{CSS as e,DndContext as t,GripVertical as n,KeyboardSensor as r,PointerSensor as i,SortableContext as a,arrayMove as o,closestCenter as s,restrictToParentElement as c,sortableKeyboardCoordinates as l,useSensor as u,useSensors as d,useSortable as f}from"./sortable.esm-hJ0lGxBr.js";import{AlertDialog as p,AlertDialogCancel as m,AlertDialogContent as h,AlertDialogDescription as ee,AlertDialogFooter as g,AlertDialogHeader as _,AlertDialogTitle as v,AlertDialogTrigger as y,Trash2 as b}from"./alert-dialog-BMKsEFef.js";import{Button as x,Form as te,FormControl as ne,FormDescription as S,FormField as C,FormItem as w,FormLabel as T,FormMessage as E,Input as D,LoadingButton as O,Plus as k,Sheet as A,SheetClose as j,SheetContent as M,SheetDescription as N,SheetFooter as P,SheetHeader as F,SheetTitle as I,SheetTrigger as L,Skeleton as R,__toESM as z,a as B,cn as V,handleApiError as H,objectType as U,require_jsx_runtime as W,require_react as G,stringType as re,toast as K,useBulkUpdateServicesMutation as q,useCreateServiceMutation as J,useDeleteServiceMutation as Y,useForm as X,useGetServicesQuery as ie}from"./index-BpPvn16n.js";import{Card as ae,CardAction as oe,CardContent as se,CardFooter as ce,CardHeader as le,CardTitle as ue}from"./card-D6e0mOnd.js";import{Switch as de}from"./switch-TnSuzTX_.js";import{SettingPageWrapper as fe}from"./setting-page-wrapper-B7I8Q1ot.js";var Z=z(G()),Q=z(W());function pe({service:e}){let[t,n]=(0,Z.useState)(!1),[r,{isLoading:i}]=Y();return(0,Q.jsxs)(p,{open:t,onOpenChange:n,children:[(0,Q.jsx)(y,{asChild:!0,children:(0,Q.jsx)(x,{variant:`ghost`,size:`icon`,className:`hover:text-destructive`,children:(0,Q.jsx)(b,{})})}),(0,Q.jsxs)(h,{children:[(0,Q.jsxs)(_,{children:[(0,Q.jsx)(v,{children:`Delete moving service?`}),(0,Q.jsxs)(ee,{children:[`This will delete `,(0,Q.jsxs)(`b`,{children:[e.name,`.`]}),` Services that have already been used cannot be deleted.`]})]}),(0,Q.jsxs)(g,{children:[(0,Q.jsx)(m,{children:`Cancel`}),(0,Q.jsx)(O,{type:`button`,loading:i,disabled:i,variant:`destructive`,onClick:()=>{r({id:e.id}).unwrap().then(()=>{K.success(`Moving service deleted`),n(!1)}).catch(e=>{H(e)})},children:`Delete`})]})]})]})}function $({id:t,item:r,onEnabledChange:i}){let{attributes:a,listeners:o,setNodeRef:s,transform:c,transition:l,isDragging:u}=f({id:t}),d={transform:e.Transform.toString(c),transition:l,zIndex:u?1e3:`auto`,position:u?`relative`:`static`};return(0,Q.jsxs)(`div`,{ref:s,style:d,className:V(`grid grid-cols-[max-content_1fr_max-content_max-content] border rounded-md items-center gap-2 p-2`,{"bg-background shadow-lg":u}),children:[(0,Q.jsx)(x,{size:`icon`,variant:`ghost`,className:`flex min-w-6 cursor-grab`,...a,...o,children:(0,Q.jsx)(n,{})}),(0,Q.jsx)(`div`,{className:`overflow-hidden`,children:(0,Q.jsx)(`p`,{className:`truncate text-sm font-medium`,children:r.name})}),(0,Q.jsx)(de,{checked:r.enabled,onCheckedChange:e=>{i(r.id,e)}}),r.is_default?(0,Q.jsx)(`div`,{className:`size-9`}):(0,Q.jsx)(pe,{service:r})]})}function me({items:e,setItems:n,setOrderChanged:f}){let p=d(u(i),u(r,{coordinateGetter:l}));function m(t){let{active:r,over:i}=t;if(i&&r.id!==i.id){let t=e.findIndex(e=>e.id===r.id),a=e.findIndex(e=>e.id===i.id),s=o(e,t,a),c=s.map((e,t)=>({...e,index:t}));n(c),f(!0)}}function h(t,r){n(e.map(e=>e.id===t?{...e,enabled:r}:e)),f(!0)}return(0,Q.jsx)(t,{sensors:p,collisionDetection:s,onDragEnd:m,modifiers:[c],children:(0,Q.jsx)(a,{items:e,children:(0,Q.jsx)(`div`,{className:`space-y-2`,children:e.map(e=>(0,Q.jsx)($,{id:e.id,item:e,onEnabledChange:h},e.id))})})})}const he=U({name:re({required_error:`Name is required.`}).min(5,{message:`Name must be at least 5 characters long.`})});function ge(){let[e,{isLoading:t}]=J(),[n,r]=(0,Z.useState)(!1),i=X({mode:`onChange`,reValidateMode:`onChange`,resolver:B(he),defaultValues:{name:``}});function a(t){e(t).unwrap().then(()=>{K.success(`Service created`),r(!1),i.reset()}).catch(e=>{H(e)})}function o(){i.reset(),r(e=>!e)}return(0,Q.jsxs)(A,{open:n,onOpenChange:o,children:[(0,Q.jsx)(L,{asChild:!0,children:(0,Q.jsxs)(x,{children:[(0,Q.jsx)(k,{}),`Create service`]})}),(0,Q.jsxs)(M,{children:[(0,Q.jsxs)(F,{children:[(0,Q.jsx)(I,{children:`Add moving service`}),(0,Q.jsx)(N,{className:`sr-only`})]}),(0,Q.jsx)(`div`,{className:`flex-1 overflow-y-auto p-4`,children:(0,Q.jsx)(te,{...i,children:(0,Q.jsx)(`form`,{onSubmit:i.handleSubmit(a),className:`space-y-6`,children:(0,Q.jsx)(C,{control:i.control,name:`name`,render:({field:e})=>(0,Q.jsxs)(w,{children:[(0,Q.jsx)(T,{children:`Name (required)`}),(0,Q.jsx)(S,{children:`Name of the moving service, visible to customers.`}),(0,Q.jsx)(ne,{children:(0,Q.jsx)(D,{...e,autoComplete:`off`})}),(0,Q.jsx)(E,{})]})})})})}),(0,Q.jsxs)(P,{children:[(0,Q.jsx)(j,{asChild:!0,children:(0,Q.jsx)(x,{type:`button`,variant:`outline`,className:`w-full`,children:`Cancel`})}),(0,Q.jsx)(O,{type:`button`,loading:t,disabled:t,onClick:i.handleSubmit(a),className:`w-full`,children:`Add service`})]})]})]})}function _e(){let{data:e,isLoading:t,isError:n}=ie(),[r,{isLoading:i}]=q(),[a,o]=(0,Z.useState)([]),[s,c]=(0,Z.useState)(!1);return(0,Z.useEffect)(()=>{e&&o(e)},[e]),(0,Q.jsx)(fe,{children:(0,Q.jsxs)(ae,{className:`max-w-xl`,children:[(0,Q.jsxs)(le,{children:[(0,Q.jsx)(ue,{children:`Moving Services`}),(0,Q.jsx)(oe,{children:(0,Q.jsx)(ge,{})})]}),(0,Q.jsxs)(se,{children:[n&&(0,Q.jsx)(`div`,{children:(0,Q.jsx)(`p`,{className:`text-muted-foreground text-center`,children:`Failed to fetch services`})}),t&&(0,Q.jsx)(`div`,{className:`space-y-2`,children:Array.from({length:5}).map((e,t)=>(0,Q.jsx)(R,{className:`h-13.5 w-full`},t))}),e&&(0,Q.jsx)(me,{items:a,setItems:o,setOrderChanged:c})]}),(0,Q.jsx)(ce,{className:`justify-end border-t`,children:(0,Q.jsxs)(`div`,{className:V(`flex transition-opacity gap-3 duration-500`,{"invisible opacity-0":!s,"visible opacity-100":s}),children:[(0,Q.jsx)(x,{type:`button`,variant:`outline`,onClick:()=>{o(e??[]),c(!1)},children:`Cancel`}),(0,Q.jsx)(O,{type:`button`,disabled:i,loading:i,onClick:()=>{r({services:a}).unwrap().then(()=>{K.success(`Changes saved`),c(!1)}).catch(e=>{H(e)})},children:`Save changes`})]})})]})})}const ve=_e;export{ve as Component};