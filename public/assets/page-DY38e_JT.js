import{r as x,i as b,j as e,B as m,L as j,t as g,h as p,g as f,k as y,S as D,l as N,m as w,n as F,o as A,p as I,q as k,s as T,v as E,w as M}from"./index-LIwVw57E.js";import{C as L,a as P,b as _,e as q,d as O,f as z}from"./card-fA9T2TmR.js";import{S as B}from"./skeleton-Dv2j4Awu.js";import{S as G,a as H}from"./switch-DbW6hBRZ.js";import{A as K,a as U,T as V,b as R,c as Q,d as W,e as J,f as X,g as Y,u as Z,C as $,G as ee,h as se,i as v,D as ae,r as ne,j as re,S as te,k as ie,s as oe,K as ce,P as le,l as de,m as he,F as ue,n as xe,o as me,p as je,q as ge,t as pe,v as ve,w as fe,x as Se,y as Ce}from"./zod-DeSQqOrt.js";import{I as be}from"./input-9Q9Ttv5E.js";import"./label-BvTTDt91.js";function ye({service:s}){const[n,i]=x.useState(!1),[l,{isLoading:r}]=b();return e.jsxs(K,{open:n,onOpenChange:i,children:[e.jsx(U,{asChild:!0,children:e.jsx(m,{variant:"ghost",size:"icon",className:"hover:text-destructive",children:e.jsx(V,{})})}),e.jsxs(R,{children:[e.jsxs(Q,{children:[e.jsx(W,{children:"Delete moving service?"}),e.jsxs(J,{children:["This will delete ",e.jsxs("b",{children:[s.name,"."]})," Services that have already been used cannot be deleted."]})]}),e.jsxs(X,{children:[e.jsx(Y,{children:"Cancel"}),e.jsx(j,{type:"button",loading:r,disabled:r,variant:"destructive",onClick:()=>{l({id:s.id}).unwrap().then(()=>{g.success("Moving service deleted"),i(!1)}).catch(o=>{p(o)})},children:"Delete"})]})]})]})}function De({id:s,item:n,onEnabledChange:i}){const{attributes:l,listeners:r,setNodeRef:o,transform:a,transition:c,isDragging:t}=Z({id:s}),d={transform:$.Transform.toString(a),transition:c,zIndex:t?1e3:"auto",position:t?"relative":"static"};return e.jsxs("div",{ref:o,style:d,className:f("grid grid-cols-[max-content_1fr_max-content_max-content] border rounded-md items-center gap-2 p-2",{"bg-background shadow-lg":t}),children:[e.jsx(m,{size:"icon",variant:"ghost",className:"flex min-w-6 cursor-grab",...l,...r,children:e.jsx(ee,{})}),e.jsx("div",{className:"overflow-hidden",children:e.jsx("p",{className:"truncate text-sm font-medium",children:n.name})}),e.jsx(G,{checked:n.enabled,onCheckedChange:h=>{i(n.id,h)}}),n.is_default?e.jsx("div",{className:"size-9"}):e.jsx(ye,{service:n})]})}function Ne({items:s,setItems:n,setOrderChanged:i}){const l=se(v(le),v(ce,{coordinateGetter:oe}));function r(a){const{active:c,over:t}=a;if(t&&c.id!==t.id){const d=s.findIndex(u=>u.id===c.id),h=s.findIndex(u=>u.id===t.id),S=ie(s,d,h).map((u,C)=>({...u,index:C}));n(S),i(!0)}}function o(a,c){n(s.map(t=>t.id===a?{...t,enabled:c}:t)),i(!0)}return e.jsx(ae,{sensors:l,collisionDetection:re,onDragEnd:r,modifiers:[ne],children:e.jsx(te,{items:s,children:e.jsx("div",{className:"space-y-2",children:s.map(a=>e.jsx(De,{id:a.id,item:a,onEnabledChange:o},a.id))})})})}const we=Se({name:Ce({required_error:"Name is required."}).min(5,{message:"Name must be at least 5 characters long."})});function Fe(){const[s,{isLoading:n}]=y(),[i,l]=x.useState(!1),r=de({mode:"onChange",reValidateMode:"onChange",resolver:fe(we),defaultValues:{name:""}});function o(a){s(a).unwrap().then(()=>{g.success("Service created"),l(!1),r.reset()}).catch(c=>{p(c)})}return e.jsxs(D,{open:i,onOpenChange:l,children:[e.jsx(N,{asChild:!0,children:e.jsxs(m,{children:[e.jsx(he,{}),"Create service"]})}),e.jsxs(w,{children:[e.jsxs(F,{children:[e.jsx(A,{children:"Add moving service"}),e.jsx(I,{className:"sr-only"})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4",children:e.jsx(ue,{...r,children:e.jsx("form",{onSubmit:r.handleSubmit(o),className:"space-y-6",children:e.jsx(xe,{control:r.control,name:"name",render:({field:a})=>e.jsxs(me,{children:[e.jsx(je,{children:"Name (required)"}),e.jsx(ge,{children:"Name of the moving service, visible to customers."}),e.jsx(pe,{children:e.jsx(be,{...a,autoComplete:"off"})}),e.jsx(ve,{})]})})})})}),e.jsxs(k,{children:[e.jsx(T,{asChild:!0,children:e.jsx(m,{type:"button",variant:"outline",className:"w-full",children:"Cancel"})}),e.jsx(j,{type:"button",loading:n,disabled:n,onClick:r.handleSubmit(o),className:"w-full",children:"Add service"})]})]})]})}function Ae(){const{data:s,isLoading:n,isError:i}=E(),[l,{isLoading:r}]=M(),[o,a]=x.useState([]),[c,t]=x.useState(!1);return x.useEffect(()=>{s&&a(s)},[s]),e.jsx(H,{children:e.jsxs(L,{className:"max-w-xl",children:[e.jsxs(P,{children:[e.jsx(_,{children:"Moving Services"}),e.jsx(q,{children:e.jsx(Fe,{})})]}),e.jsxs(O,{children:[i&&e.jsx("div",{children:e.jsx("p",{className:"text-muted-foreground text-center",children:"Failed to fetch services"})}),n&&e.jsx("div",{className:"space-y-2",children:Array.from({length:5}).map((d,h)=>e.jsx(B,{className:"h-13.5 w-full"},h))}),s&&e.jsx(Ne,{items:o,setItems:a,setOrderChanged:t})]}),e.jsx(z,{className:"justify-end border-t",children:e.jsxs("div",{className:f("flex transition-opacity gap-3 duration-500",{"invisible opacity-0":!c,"visible opacity-100":c}),children:[e.jsx(m,{type:"button",variant:"outline",onClick:()=>{a(s??[]),t(!1)},children:"Cancel"}),e.jsx(j,{type:"button",disabled:r,loading:r,onClick:()=>{l({services:o}).unwrap().then(()=>{g.success("Changes saved"),t(!1)}).catch(d=>{p(d)})},children:"Save changes"})]})})]})})}const qe=Ae;export{qe as Component};
