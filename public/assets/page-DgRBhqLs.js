import{D as I,E as L,r as m,j as e,S as M,l as _,B as x,m as O,n as U,o as z,p as G,q,s as B,L as C,t as v,F as H,h as A,g as F,G as K,H as V}from"./index-C_aFZ-sI.js";import{C as R,a as $,b as Q,f as W,d as J,e as X}from"./card-C7HsgJYj.js";import{S as Y}from"./skeleton-C1C9ZeBW.js";import{S as Z}from"./setting-page-wrapper-DuQItZLx.js";import{u as ee,F as se,a as p,b as j,c as f,d as k,e as b,f as y,s as ae,o as ne,h as re,g as D}from"./zod-D7z4GATd.js";import{I as P}from"./input-BR6PJhv_.js";import{T as te}from"./textarea-CQ4AmKEE.js";import{P as ie}from"./pen-line-8cTg32Ag.js";import{P as oe}from"./plus-CFsWEjeL.js";import{A as ce,a as le,T as de,b as ue,c as he,d as xe,e as me,f as ge,g as pe,u as je,C as fe,G as be,h as Ce,i as N,D as ve,r as Se,j as ke,S as ye,s as De,K as Pe,P as Ne,k as Ae}from"./alert-dialog-AabGfu8X.js";import"./label-BuvHemho.js";const Fe=ne({name:D().min(1,{message:"Name is required."}),description:D().optional(),labor_increase:re.number().min(0).max(100)});function w({data:s}){const[r,{isLoading:c}]=I(),[d,{isLoading:i}]=L(),[t,l]=m.useState(!1),a=!!s,n=ee({mode:"onChange",reValidateMode:"onChange",resolver:ae(Fe),defaultValues:{name:"",description:"",labor_increase:0}});m.useEffect(()=>{s&&n.reset(s)},[s]);async function h(o){const u=a?await d({id:s.id,...o}):await r(o);if("error"in u){const g=u.error;if(g.status===422){const T=g.data;for(const[E,S]of Object.entries(T))Array.isArray(S)&&n.setError(E,{type:"server",message:S.join(", ")})}return}v.success(`Packing ${a?"updated":"added"}`),l(!1)}return e.jsxs(M,{open:t,onOpenChange:l,children:[e.jsx(_,{asChild:!0,children:a?e.jsx(x,{variant:"outline",size:"icon",children:e.jsx(ie,{})}):e.jsxs(x,{children:[e.jsx(oe,{}),"Create packing"]})}),e.jsxs(O,{children:[e.jsxs(U,{children:[e.jsxs(z,{children:[a?"Update":"Add"," packing service"]}),e.jsx(G,{className:"sr-only"})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4",children:e.jsx(se,{...n,children:e.jsxs("form",{onSubmit:n.handleSubmit(h),className:"space-y-6",children:[e.jsx(p,{control:n.control,name:"name",render:({field:o})=>e.jsxs(j,{children:[e.jsx(f,{children:"Name (required)"}),e.jsx(k,{children:"Name of the packing service, visible to customers."}),e.jsx(b,{children:e.jsx(P,{...o,autoComplete:"off"})}),e.jsx(y,{})]})}),e.jsx(p,{control:n.control,name:"description",render:({field:o})=>e.jsxs(j,{children:[e.jsx(f,{children:"Description"}),e.jsx(k,{children:"Appears on the customer portal, and in quotes."}),e.jsx(b,{children:e.jsx(te,{...o,rows:3})})]})}),e.jsx(p,{control:n.control,name:"labor_increase",render:({field:o})=>e.jsxs(j,{children:[e.jsx(f,{children:"Labor increse (%)"}),e.jsx(b,{children:e.jsx(P,{...o,type:"number",pattern:"[0-9]+",inputMode:"numeric"})}),e.jsx(y,{})]})})]})})}),e.jsxs(q,{children:[e.jsx(B,{asChild:!0,children:e.jsx(x,{type:"button",variant:"outline",className:"w-full",children:"Cancel"})}),e.jsx(C,{type:"button",loading:c||i,disabled:c||i,onClick:n.handleSubmit(h),className:"w-full",children:`${a?"Update":"Add"} packing`})]})]})]})}function we({packing:s}){const[r,c]=m.useState(!1),[d,{isLoading:i}]=H();return e.jsxs(ce,{open:r,onOpenChange:c,children:[e.jsx(le,{asChild:!0,children:e.jsx(x,{variant:"outline",size:"icon",className:"hover:text-destructive",children:e.jsx(de,{})})}),e.jsxs(ue,{children:[e.jsxs(he,{children:[e.jsx(xe,{children:"Delete packing?"}),e.jsxs(me,{children:["This will delete ",e.jsxs("b",{children:[s.name,"."]}),e.jsx("br",{}),"Packing services that have already been used cannot be deleted."]})]}),e.jsxs(ge,{children:[e.jsx(pe,{children:"Cancel"}),e.jsx(C,{type:"button",loading:i,disabled:i,variant:"destructive",onClick:()=>{d({id:s.id}).unwrap().then(()=>{v.success("Packing deleted"),c(!1)}).catch(t=>{A(t)})},children:"Delete"})]})]})]})}function Te({item:s}){const r=s.is_default,{attributes:c,listeners:d,setNodeRef:i,transform:t,transition:l,isDragging:a}=je({id:s.id}),n={transform:fe.Transform.toString(t),transition:l,zIndex:a?1e3:"auto",position:a?"relative":"static"};return e.jsxs("div",{ref:r?null:i,style:n,className:F("grid grid-cols-[max-content_1fr_auto_auto] border rounded-md items-center gap-2 p-4",{"bg-background shadow-lg":a}),children:[e.jsx(x,{size:"icon",variant:"ghost",className:"flex min-w-6 cursor-grab",disabled:r,...r?{}:c,...r?{}:d,children:e.jsx(be,{})}),e.jsx("div",{className:"overflow-hidden",children:e.jsx("p",{className:"truncate text-sm font-medium",children:s.name})}),e.jsx(w,{data:s}),r?e.jsx(x,{variant:"ghost",disabled:!0,size:"icon",children:e.jsx("span",{className:"sr-only",children:"Default"})}):null,!r&&e.jsx(we,{packing:s})]})}function Ee({items:s,setItems:r,setOrderChanged:c}){const d=Ce(N(Ne),N(Pe,{coordinateGetter:De}));function i(t){const{active:l,over:a}=t;if(a&&l.id!==a.id){const n=s.findIndex(u=>u.id===l.id),h=s.findIndex(u=>u.id===a.id),o=Ae(s,n,h).map((u,g)=>({...u,index:g}));r(o),c(!0)}}return e.jsx(ve,{sensors:d,collisionDetection:ke,onDragEnd:i,modifiers:[Se],children:e.jsx(ye,{items:s,children:e.jsx("div",{className:"space-y-2",children:s.map(t=>e.jsx(Te,{item:t},t.id))})})})}function Ie(){const{data:s,isLoading:r,isError:c}=K(),[d,{isLoading:i}]=V(),[t,l]=m.useState([]),[a,n]=m.useState(!1);return m.useEffect(()=>{s&&l(s)},[s]),e.jsx(Z,{children:e.jsxs(R,{className:"max-w-2xl",children:[e.jsxs($,{children:[e.jsx(Q,{children:"Packing Services"}),e.jsx(W,{children:e.jsx(w,{})})]}),e.jsxs(J,{children:[c&&e.jsx("div",{children:e.jsx("p",{className:"text-muted-foreground text-center",children:"Failed to fetch packings"})}),r&&e.jsx("div",{className:"space-y-2",children:Array.from({length:3}).map((h,o)=>e.jsx(Y,{className:"h-17.5 w-full"},o))}),s&&e.jsx(Ee,{items:t,setItems:l,setOrderChanged:n})]}),e.jsx(X,{className:"justify-end border-t",children:e.jsxs("div",{className:F("flex transition-opacity duration-500 gap-3",{"invisible opacity-0":!a,"visible opacity-100":a}),children:[e.jsx(x,{type:"button",variant:"outline",onClick:()=>{l(s??[]),n(!1)},children:"Cancel"}),e.jsx(C,{type:"button",disabled:i,loading:i,onClick:()=>{d({packings:t}).unwrap().then(()=>{n(!1),v.success("Changes saved")}).catch(h=>{A(h)})},children:"Save changes"})]})})]})})}const Ve=Ie;export{Ve as Component};
