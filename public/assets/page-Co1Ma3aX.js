import{j as e,g as y,D as _,E as O,r as h,S as U,l as z,B as m,m as B,n as G,o as q,p as H,q as K,s as V,L as D,t as P,F as R,h as I,G as $,H as Q,A as W}from"./index-Dm7BQT7l.js";import{C as J,a as X,b as Y,f as Z,d as ee}from"./card-V1I8AuRO.js";import{S as se}from"./setting-page-wrapper-DigH3shI.js";import{u as ae,F as ne,a as v,b as C,c as k,d as w,e as S,f as N,s as re,o as ie,h as te,g as A}from"./zod-C9OWJPuT.js";import{I as F}from"./input-DQgfCGN5.js";import{P as oe}from"./pencil-mKu3sq-8.js";import{P as le}from"./plus-BsPJKiy_.js";import{A as ce,a as de,T as ue,b as xe,c as me,d as he,e as ge,f as pe,g as fe,u as je,C as be,G as ve,h as Ce,i as E,D as ke,r as Se,j as ye,S as De,s as Pe,K as we,P as Ne,k as Ae}from"./alert-dialog-DLnJPL4m.js";import{S as Fe}from"./skeleton-Cmd4G45R.js";import"./label-DlqQ0M1t.js";function Ee({className:s,...a}){return e.jsx("textarea",{"data-slot":"textarea",className:y("border-input placeholder:text-muted-foreground focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 flex field-sizing-content min-h-16 w-full rounded-md border bg-transparent px-3 py-2 text-base shadow-xs transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",s),...a})}const Ie=ie({name:A().min(1,{message:"Name is required."}),description:A().optional(),labor_increase:te.number().min(0).max(100)});function T({data:s}){const[a,{isLoading:c}]=_(),[u,{isLoading:t}]=O(),[r,d]=h.useState(!1),i=!!s,n=ae({mode:"onChange",reValidateMode:"onChange",resolver:re(Ie),defaultValues:{name:"",description:"",labor_increase:0}});h.useEffect(()=>{s&&n.reset(s)},[s]);async function f(o){const l=i?await u({id:s.id,...o}):await a(o);if("error"in l){const x=l.error;if(x.status===422){const g=x.data;for(const[b,j]of Object.entries(g))Array.isArray(j)&&n.setError(b,{type:"server",message:j.join(", ")})}return}P.success(`Packing ${i?"updated":"added"}`),d(!1)}return e.jsxs(U,{open:r,onOpenChange:d,children:[e.jsx(z,{asChild:!0,children:i?e.jsx(m,{variant:"outline",size:"icon",children:e.jsx(oe,{})}):e.jsxs(m,{children:[e.jsx(le,{}),"Create packing"]})}),e.jsxs(B,{children:[e.jsxs(G,{children:[e.jsxs(q,{children:[i?"Update":"Add"," packing service"]}),e.jsx(H,{className:"sr-only"})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4",children:e.jsx(ne,{...n,children:e.jsxs("form",{onSubmit:n.handleSubmit(f),className:"space-y-6",children:[e.jsx(v,{control:n.control,name:"name",render:({field:o})=>e.jsxs(C,{children:[e.jsx(k,{children:"Name (required)"}),e.jsx(w,{children:"Name of the packing service, visible to customers."}),e.jsx(S,{children:e.jsx(F,{...o,autoComplete:"off"})}),e.jsx(N,{})]})}),e.jsx(v,{control:n.control,name:"description",render:({field:o})=>e.jsxs(C,{children:[e.jsx(k,{children:"Description"}),e.jsx(w,{children:"Appears on the customer portal, and in quotes."}),e.jsx(S,{children:e.jsx(Ee,{...o,rows:3})})]})}),e.jsx(v,{control:n.control,name:"labor_increase",render:({field:o})=>e.jsxs(C,{children:[e.jsx(k,{children:"Labor increse (%)"}),e.jsx(S,{children:e.jsx(F,{...o,type:"number",pattern:"[0-9]+",inputMode:"numeric"})}),e.jsx(N,{})]})})]})})}),e.jsxs(K,{children:[e.jsx(V,{asChild:!0,children:e.jsx(m,{type:"button",variant:"outline",className:"w-full",children:"Cancel"})}),e.jsx(D,{type:"button",loading:c||t,disabled:c||t,onClick:n.handleSubmit(f),className:"w-full",children:`${i?"Update":"Add"} packing`})]})]})]})}function Te({packing:s}){const[a,c]=h.useState(!1),[u,{isLoading:t}]=R();return e.jsxs(ce,{open:a,onOpenChange:c,children:[e.jsx(de,{asChild:!0,children:e.jsx(m,{variant:"outline",size:"icon",className:"hover:text-destructive",children:e.jsx(ue,{})})}),e.jsxs(xe,{children:[e.jsxs(me,{children:[e.jsx(he,{children:"Delete packing?"}),e.jsxs(ge,{children:["This will delete ",e.jsxs("b",{children:[s.name,"."]}),e.jsx("br",{}),"Packing services that have already been used cannot be deleted."]})]}),e.jsxs(pe,{children:[e.jsx(fe,{children:"Cancel"}),e.jsx(D,{type:"button",loading:t,disabled:t,variant:"destructive",onClick:()=>{u({id:s.id}).unwrap().then(()=>{P.success("Packing deleted"),c(!1)}).catch(r=>{I(r)})},children:"Delete"})]})]})]})}function Le({item:s}){const a=s.is_default,{attributes:c,listeners:u,setNodeRef:t,transform:r,transition:d,isDragging:i}=je({id:s.id}),n={transform:be.Transform.toString(r),transition:d,zIndex:i?1e3:"auto",position:i?"relative":"static"};return e.jsxs("div",{ref:a?null:t,style:n,className:y("grid grid-cols-[max-content_1fr_auto_auto] border rounded-md items-center gap-2 p-4",{"bg-background shadow-lg":i}),children:[e.jsx(m,{size:"icon",variant:"ghost",className:"flex min-w-6 cursor-grab",disabled:a,...a?{}:c,...a?{}:u,children:e.jsx(ve,{})}),e.jsx("div",{className:"overflow-hidden",children:e.jsx("p",{className:"truncate text-sm font-medium",children:s.name})}),e.jsx(T,{data:s}),a?e.jsx(m,{variant:"ghost",disabled:!0,size:"icon",children:e.jsx("span",{className:"sr-only",children:"Default"})}):null,!a&&e.jsx(Te,{packing:s})]})}function Me(){const{data:s,isLoading:a,isError:c}=$(),[u,{isLoading:t}]=Q(),[r,d]=h.useState([]),[i,n]=h.useState(!1),f=Ce(E(Ne),E(we,{coordinateGetter:Pe}));h.useEffect(()=>{s&&d(s)},[s]);function o(l){const{active:x,over:g}=l;if(g&&x.id!==g.id){const b=r.findIndex(p=>p.id===x.id),j=r.findIndex(p=>p.id===g.id),L=Ae(r,b,j).map((p,M)=>({...p,index:M}));d(L),n(!0)}}return c?e.jsx("div",{className:"flex w-full items-center justify-center text-muted-foreground",children:e.jsx("p",{children:"Failed to fetch packings"})}):e.jsxs("div",{className:"flex flex-col gap-6",children:[a&&e.jsx("div",{className:"space-y-2",children:Array.from({length:3}).map((l,x)=>e.jsx(Fe,{className:"h-17.5 w-full"},x))}),s&&e.jsx(ke,{sensors:f,collisionDetection:ye,onDragEnd:o,modifiers:[Se],children:e.jsx(De,{items:r,children:e.jsx("div",{className:"space-y-2",children:r.map(l=>e.jsx(Le,{item:l},l.id))})})}),e.jsx(W,{}),e.jsx("div",{className:y("flex transition-opacity duration-500 sm:justify-end",{"invisible opacity-0":!i,"visible opacity-100":i}),children:e.jsxs("div",{className:"flex min-h-9 w-full gap-3 sm:w-auto",children:[e.jsx(m,{type:"button",variant:"outline",className:"w-full sm:w-auto",onClick:()=>{d(s),n(!1)},children:"Cancel"}),e.jsx(D,{type:"button",className:"w-full sm:w-auto",disabled:t,loading:t,onClick:()=>{u({packings:r}).unwrap().then(()=>{n(!1),P.success("Changes saved")}).catch(l=>{I(l)})},children:"Save changes"})]})})]})}function _e(){return e.jsx(se,{children:e.jsxs(J,{className:"max-w-2xl",children:[e.jsxs(X,{children:[e.jsx(Y,{children:"Packing Services"}),e.jsx(Z,{children:e.jsx(T,{})})]}),e.jsx(ee,{children:e.jsx(Me,{})})]})})}const $e=_e;export{$e as Component};
