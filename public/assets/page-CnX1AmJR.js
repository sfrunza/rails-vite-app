import{N as De,b1 as ze,r as v,j as e,S as U,k as O,B as C,l as P,m as $,n as q,o as R,p as V,q as B,L as D,t as N,h as S,b2 as Me,g as F,b3 as A,b4 as ke,b5 as Ee,b6 as _e,b7 as Ie,T as Fe,b8 as Ae,b9 as Le,aC as Ue,aD as Oe}from"./index-BrQi1v-c.js";import{S as Pe}from"./setting-page-wrapper-lwIfDS-L.js";import{C as G,a as H,b as K,f as $e,d as W,e as Q}from"./card-Cim6kUnN.js";import{S as X}from"./skeleton-CQuYJPyZ.js";import{u as Y,F as J,a as g,b as p,c as b,d as k,e as f,f as y,s as Z,o as ee,g as _,k as qe,l as L,h as E,n as Re}from"./zod-CKf-_hsS.js";import{I as z}from"./input-B52D2lzl.js";import{P as se}from"./plus-DlXTtDVQ.js";import{A as ne,a as te,T as Ve,b as ae,c as re,d as ie,e as oe,f as le,g as ce,u as de,C as me,G as ue,h as he,i as I,D as xe,r as je,j as ge,S as pe,s as fe,K as ve,P as be,k as ye}from"./alert-dialog-DDQSTuhp.js";import{N as M}from"./numeric-input-CE3LjWwX.js";import{T as Be}from"./textarea-Co9YEACg.js";import{P as Ge}from"./pen-line-OgDnHBxE.js";import"./label-CbHfFtVG.js";/**
 * @license lucide-react v0.513.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const He=[["path",{d:"M5 3v16h16",key:"1mqmf9"}],["path",{d:"m5 19 6-6",key:"jh6hbb"}],["path",{d:"m2 6 3-3 3 3",key:"tkyvxa"}],["path",{d:"m18 16 3 3-3 3",key:"1d4glt"}]],Ke=De("move-3d",He),We=ee({name:_({required_error:"Name is required."}).min(5,{message:"Name must be at least 5 characters long."}),form_name:_({required_error:"Form name is required."}).min(1,{message:"Form name must be at least 1 character long."})});function Qe(){const[s,{isLoading:r}]=ze(),[l,d]=v.useState(!1),i=Y({mode:"onChange",reValidateMode:"onChange",resolver:Z(We),defaultValues:{name:"",form_name:""}});function a(t){s(t).unwrap().then(()=>{N.success("Truck created"),i.reset(),d(!1)}).catch(n=>{S(n)})}return e.jsxs(U,{open:l,onOpenChange:d,children:[e.jsx(O,{asChild:!0,children:e.jsxs(C,{children:[e.jsx(se,{}),"Create stairs"]})}),e.jsxs(P,{children:[e.jsxs($,{children:[e.jsx(q,{children:"Add entrance type"}),e.jsx(R,{className:"sr-only"})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4",children:e.jsx(J,{...i,children:e.jsxs("form",{onSubmit:i.handleSubmit(a),className:"space-y-6",children:[e.jsx(g,{control:i.control,name:"name",render:({field:t})=>e.jsxs(p,{children:[e.jsx(b,{children:"Name (required)"}),e.jsx(k,{children:"Name of the entrance type shown on quote/contract."}),e.jsx(f,{children:e.jsx(z,{...t,autoComplete:"off"})}),e.jsx(y,{})]})}),e.jsx(g,{control:i.control,name:"form_name",render:({field:t})=>e.jsxs(p,{children:[e.jsx(b,{children:"Form name (required)"}),e.jsx(k,{children:"Name of the entrance type shown on the Book form."}),e.jsx(f,{children:e.jsx(z,{...t})}),e.jsx(y,{})]})})]})})}),e.jsxs(V,{children:[e.jsx(B,{asChild:!0,children:e.jsx(C,{type:"button",variant:"outline",children:"Cancel"})}),e.jsx(D,{type:"button",loading:r,disabled:r,onClick:i.handleSubmit(a),children:"Add stairs"})]})]})]})}function Xe({entrance:s}){const[r,l]=v.useState(!1),[d,{isLoading:i}]=Me();return e.jsxs(ne,{open:r,onOpenChange:l,children:[e.jsx(te,{asChild:!0,children:e.jsx(C,{variant:"outline",size:"icon",className:"hover:text-destructive",children:e.jsx(Ve,{})})}),e.jsxs(ae,{children:[e.jsxs(re,{children:[e.jsx(ie,{children:"Delete entrance type?"}),e.jsxs(oe,{children:["This will delete ",e.jsxs("b",{children:[s.name,"."]})," Entrance types that have already been used cannot be deleted."]})]}),e.jsxs(le,{children:[e.jsx(ce,{children:"Cancel"}),e.jsx(D,{type:"button",loading:i,disabled:i,variant:"destructive",onClick:()=>{d({id:s.id}).unwrap().then(()=>{N.success("Stairs deleted"),l(!1)}).catch(a=>{S(a)})},children:"Delete"})]})]})]})}function Ye({item:s,onChange:r}){const{attributes:l,listeners:d,setNodeRef:i,transform:a,transition:t,isDragging:n}=de({id:s.id}),o={transform:me.Transform.toString(a),transition:t,zIndex:n?1e3:"auto",position:n?"relative":"static"};return e.jsxs("div",{className:"flex items-center gap-2",ref:i,style:o,children:[e.jsx(ue,{className:"size-5 min-w-5 cursor-grab text-muted-foreground",...l,...d}),e.jsxs("div",{className:F("grid auto-cols-auto grid-flow-col gap-2",{"bg-background":n}),children:[e.jsx(z,{id:`long-name-${s.id}`,type:"text",value:s.name,onChange:u=>{r(s.id,{name:u.target.value})}}),e.jsx(z,{id:`short-name-${s.id}`,type:"text",value:s.form_name,onChange:u=>{r(s.id,{form_name:u.target.value})}}),e.jsx(Xe,{entrance:s})]})]})}function Je({items:s,setItems:r,setOrderChanged:l}){const d=he(I(be),I(ve,{coordinateGetter:fe}));function i(t){const{active:n,over:o}=t;if(o&&n.id!==o.id){const u=s.findIndex(j=>j.id===n.id),x=s.findIndex(j=>j.id===o.id),m=ye(s,u,x).map((j,T)=>({...j,index:T}));r(m),l(!0)}}function a(t,n){r(s.map(o=>o.id===t?{...o,...n}:o)),l(!0)}return e.jsx(xe,{sensors:d,collisionDetection:ge,onDragEnd:i,modifiers:[je],children:e.jsx(pe,{items:s,children:e.jsx("div",{className:"space-y-4",children:s.map(t=>e.jsx(Ye,{item:t,onChange:a},t.id))})})})}function Ze(){const{data:s,isLoading:r,isError:l}=A(),[d,{isLoading:i}]=ke(),[a,t]=v.useState([]),[n,o]=v.useState(!1);return v.useEffect(()=>{s&&t(s)},[s]),e.jsxs(G,{className:"max-w-3xl",children:[e.jsxs(H,{children:[e.jsx(K,{children:"Stairs"}),e.jsx($e,{children:e.jsx(Qe,{})})]}),e.jsxs(W,{children:[l&&e.jsx("div",{children:e.jsx("p",{className:"text-muted-foreground text-center",children:"Failed to fetch stairs"})}),r&&e.jsx("div",{className:"space-y-4",children:Array.from({length:8}).map((u,x)=>e.jsx(X,{className:"h-9"},x))}),s&&e.jsx(Je,{items:a,setItems:t,setOrderChanged:o})]}),e.jsx(Q,{className:"justify-end border-t",children:e.jsxs("div",{className:F("flex transition-opacity gap-3 duration-500",{"invisible opacity-0":!n,"visible opacity-100":n}),children:[e.jsx(C,{type:"button",variant:"outline",onClick:()=>{t(s??[]),o(!1)},children:"Cancel"}),e.jsx(D,{type:"button",disabled:i,loading:i,onClick:()=>{d({entranceTypes:a}).unwrap().then(()=>{N.success("Changes saved"),o(!1)}).catch(u=>{S(u)})},children:"Save changes"})]})})]})}function es({value:s,onChange:r}){const{data:l}=A();if(!l)return null;const d=(i,a,t)=>{const n=s.map((o,u)=>o.map((x,w)=>u===i&&w===a?t:x));r(n)};return e.jsxs("div",{className:"flex flex-col rounded-lg overflow-hidden border",children:[e.jsx("div",{className:"bg-slate-900 text-white text-center p-1.5 font-semibold text-sm",children:"TO STAIRS"}),e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"bg-slate-900 text-white p-4 flex flex-col items-center justify-center w-8",children:e.jsx("div",{className:"transform -rotate-90 whitespace-nowrap font-semibold text-sm",children:"FROM STAIRS"})}),e.jsxs("div",{className:"bg-background p-4 flex-1",children:[e.jsxs("div",{className:"grid mb-4",style:{gridTemplateColumns:`repeat(${l.length+1}, 1fr)`},children:[e.jsx("div",{}),l.map((i,a)=>e.jsx("div",{className:"flex items-center justify-center text-muted-foreground font-medium text-sm",children:i.name.slice(0,3)},`col-${a}`))]}),e.jsx("div",{className:"grid gap-2",children:l.map((i,a)=>e.jsxs("div",{className:"grid gap-2 items-center",style:{gridTemplateColumns:`repeat(${l.length+1}, 1fr)`},children:[e.jsx("div",{className:"text-muted-foreground text-sm font-medium text-center",children:i.name.slice(0,3)}),l.map((t,n)=>e.jsx(M,{name:`cell-${a}-${n}`,defaultValue:s[a][n].toString(),min:2,max:20,onChange:o=>{d(a,n,Number(o))},className:"w-full p-0 text-center"},`cell-${a}-${n}`))]},`row-${a}`))})]})]})]})}const ss=[[2,2,2,2,2,2,2],[2,2,2,2,2,2,2],[2,2,2,2,2,2,2],[2,2,2,3,2,2,2],[2,2,2,2,2,2,2],[2,2,2,2,2,2,2],[2,2,2,2,2,2,2]];function ns(s,r){const l=s.length,d=s[0].length,i=r.length,a=r[0].length,t=[];for(let n=0;n<i;n++){t[n]=[];for(let o=0;o<a;o++)n<l&&o<d?t[n][o]=s[n][o]:t[n][o]=2}return t}const ts=ee({name:_().min(1,{message:"Name is required"}),description:_(),dispersion:E.number().min(0,{message:"Dispersion must be greater than 0"}).max(100,{message:"Dispersion must be less than 100"}),truck_count:E.number().min(1,{message:"Truck count must be at least 1"}),volume:E.number().min(0,{message:"Volume must be greater than 0"}),weight:E.number().min(0,{message:"Weight must be greater than 0"}),crew_size_settings:L(L(Re())),image:qe(File).optional()});function as(s){const r=s.target.files&&s.target.files[0],l=r?URL.createObjectURL(r):"";return{file:r,displayUrl:l}}function Ce({data:s}){const{data:r}=A(),[l,{isLoading:d}]=Ee(),[i,{isLoading:a}]=_e(),[t,{isLoading:n}]=Ie(),[o,u]=v.useState(!1),[x,w]=v.useState(null),m=Y({resolver:Z(ts),mode:"onChange",reValidateMode:"onChange",values:s??void 0,defaultValues:{name:"",description:"",dispersion:0,truck_count:1,volume:0,weight:0,crew_size_settings:ss,image:void 0}});async function j(c){s?i({id:s.id,...c}).unwrap().then(()=>{N.success("Changes successfully saved"),m.reset(),T()}).catch(h=>{S(h)}):l(c).unwrap().then(()=>{N.success("Move size successfully added"),m.reset(),T()}).catch(h=>{S(h)})}function T(){m.reset(),u(c=>!c)}return e.jsxs(U,{open:o,onOpenChange:T,children:[e.jsx(O,{asChild:!0,children:s?e.jsx(C,{variant:"outline",size:"icon",children:e.jsx(Ge,{})}):e.jsxs(C,{children:[e.jsx(se,{}),"Create move size"]})}),e.jsxs(P,{className:"w-full sm:max-w-lg",children:[e.jsxs($,{children:[e.jsxs(q,{children:[s?"Edit":"Create"," move size"]}),e.jsx(R,{className:"sr-only"})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4",children:e.jsx(J,{...m,children:e.jsxs("form",{onSubmit:m.handleSubmit(j),className:"space-y-6",children:[e.jsx(g,{control:m.control,name:"image",render:({field:{value:c,onChange:h,...Ne}})=>e.jsxs(p,{children:[e.jsx(b,{children:"Image"}),e.jsx(f,{children:e.jsx(z,{...Ne,placeholder:"Image",type:"file",accept:"image/png, image/jpeg",multiple:!1,onChange:Se=>{const{file:we,displayUrl:Te}=as(Se);w(Te),h(we)}})}),e.jsx(y,{})]})}),e.jsx("div",{className:"flex justify-center items-center",children:x&&e.jsx("div",{className:"relative size-40 p-1 rounded-md border-2 border-dashed",children:e.jsx("img",{src:x,alt:"Company logo",className:"h-full w-full rounded-md object-contain"})})}),e.jsx(g,{control:m.control,name:"name",render:({field:c})=>e.jsxs(p,{children:[e.jsx(b,{children:"Name"}),e.jsx(k,{children:"Name of the move size, visible to customers."}),e.jsx(f,{children:e.jsx(z,{...c,autoComplete:"off"})}),e.jsx(y,{})]})}),e.jsx(g,{control:m.control,name:"description",render:({field:c})=>e.jsxs(p,{children:[e.jsx(b,{children:"Description"}),e.jsx(k,{children:"Description of the move size, visible to customers."}),e.jsx(f,{children:e.jsx(Be,{...c,rows:2,autoComplete:"off"})}),e.jsx(y,{})]})}),e.jsx(g,{control:m.control,name:"dispersion",render:({field:c})=>e.jsxs(p,{children:[e.jsx(b,{children:"Dispersion %"}),e.jsx(k,{children:"Dispersion of the move size."}),e.jsx(f,{children:e.jsx(M,{value:c.value.toString(),min:0,max:100,onChange:h=>{c.onChange(h)}})}),e.jsx(y,{})]})}),e.jsx(g,{control:m.control,name:"truck_count",render:({field:c})=>e.jsxs(p,{children:[e.jsx(b,{children:"Trucks count for this size"}),e.jsx(f,{children:e.jsx(M,{value:c.value.toString(),min:1,max:10,onChange:h=>{c.onChange(h)}})}),e.jsx(y,{})]})}),e.jsx(g,{control:m.control,name:"volume",render:({field:c})=>e.jsxs(p,{children:[e.jsx(b,{children:"Volume"}),e.jsx(f,{children:e.jsx(M,{value:c.value.toString(),min:0,max:1e5,allowDecimals:!0,onChange:h=>{c.onChange(h)}})}),e.jsx(y,{})]})}),e.jsx(g,{control:m.control,name:"weight",render:({field:c})=>e.jsxs(p,{children:[e.jsx(b,{children:"Weight"}),e.jsx(f,{children:e.jsx(M,{value:c.value.toString(),min:0,max:1e5,allowDecimals:!0,onChange:h=>{c.onChange(h)}})}),e.jsx(y,{})]})}),e.jsx(g,{control:m.control,name:"crew_size_settings",render:({field:c})=>e.jsxs(p,{children:[e.jsx("p",{className:"text-sm leading-none font-medium select-none group-data-[disabled=true]:pointer-events-none group-data-[disabled=true]:opacity-50 peer-disabled:cursor-not-allowed peer-disabled:opacity-50",children:"Crew size settings"}),e.jsx(f,{children:e.jsx(es,{value:ns(c.value,Array((r==null?void 0:r.length)??0).fill(null).map(()=>Array((r==null?void 0:r.length)??0).fill(2))),onChange:c.onChange})})]})})]})})}),e.jsxs(V,{children:[e.jsx("div",{children:s&&e.jsxs(ne,{children:[e.jsx(te,{asChild:!0,children:e.jsx(C,{variant:"outline",className:"mt-2 sm:mt-0 w-full text-destructive hover:text-destructive hover:bg-destructive/10",children:"Delete"})}),e.jsxs(ae,{children:[e.jsxs(re,{children:[e.jsx(ie,{children:"Delete move size?"}),e.jsxs(oe,{children:["This will delete ",e.jsx("b",{children:s.name}),". Move sizes that have already been used cannot be deleted."]})]}),e.jsxs(le,{children:[e.jsx(ce,{children:"Cancel"}),e.jsx(D,{type:"button",loading:n,disabled:n,className:"mt-2 sm:mt-0",onClick:async()=>{t({id:s==null?void 0:s.id}).unwrap().then(()=>{N.success("Move size deleted"),T()}).catch(c=>{S(c)})},variant:"destructive",children:"Delete"})]})]})]})}),e.jsx(B,{asChild:!0,children:e.jsx(C,{type:"button",variant:"outline",children:"Cancel"})}),e.jsx(D,{type:"button",loading:d||a,disabled:d||a,onClick:m.handleSubmit(j),children:s?"Save changes":"Add move size"})]})]})]})}function rs({item:s}){const{attributes:r,listeners:l,setNodeRef:d,transform:i,transition:a,isDragging:t}=de({id:s.id}),n={transform:me.Transform.toString(i),transition:a,zIndex:t?1e3:"auto",position:t?"relative":"static"};return e.jsxs("div",{className:"flex items-center gap-2",ref:d,style:n,children:[e.jsx(ue,{className:"size-5 min-w-5 cursor-grab text-muted-foreground",...r,...l}),e.jsx("div",{className:"@container w-full",children:e.jsxs("div",{className:F("grid w-full grid-cols-[max-content_1fr_max-content] @lg:grid-cols-9 border rounded-md items-center gap-4 p-4",{"bg-background shadow-lg":t}),children:[e.jsx("div",{children:e.jsx("img",{src:s.image_url??"https://www.thehighlands.org/sites/default/files/styles/hero/public/one-bedroom-3d.png?itok=1Y5yuPSu",alt:s.name,className:"size-10 object-cover"})}),e.jsxs("div",{className:"overflow-hidden @lg:col-span-4",children:[e.jsx("p",{className:"truncate font-semibold",children:s.name}),e.jsx("p",{className:"truncate text-sm",children:s.description})]}),e.jsxs("div",{className:"hidden @lg:flex @lg:col-span-2 gap-4",children:[e.jsxs("div",{className:"items-center flex gap-2 text-muted-foreground",children:[e.jsx(Fe,{className:"size-4"}),e.jsx("p",{className:"truncate text-sm font-medium",children:s.truck_count??1})]}),e.jsxs("div",{className:"items-center flex gap-2 text-muted-foreground",children:[e.jsx(Ke,{className:"size-4"}),e.jsxs("p",{className:"truncate text-sm font-medium",children:[s.volume||100," cbf"]})]})]}),e.jsx("div",{className:"flex justify-end @lg:col-span-2",children:e.jsx(Ce,{data:s})})]})})]})}function is({items:s,setItems:r,setOrderChanged:l}){const d=he(I(be),I(ve,{coordinateGetter:fe}));function i(a){const{active:t,over:n}=a;if(n&&t.id!==n.id){const o=s.findIndex(m=>m.id===t.id),u=s.findIndex(m=>m.id===n.id),w=ye(s,o,u).map((m,j)=>({...m,index:j}));r(w),l(!0)}}return e.jsx(xe,{sensors:d,collisionDetection:ge,onDragEnd:i,modifiers:[je],children:e.jsx(pe,{items:s,children:e.jsx("div",{className:"space-y-4",children:s==null?void 0:s.map(a=>e.jsx(rs,{item:a},a.id))})})})}function os(){const{data:s,isLoading:r,isError:l}=Ae(),[d,{isLoading:i}]=Le(),[a,t]=v.useState([]),[n,o]=v.useState(!1);return v.useEffect(()=>{s&&t(s)},[s]),e.jsxs(G,{className:"max-w-3xl",children:[e.jsxs(H,{className:"flex flex-row justify-between",children:[e.jsx(K,{children:"Move Size"}),e.jsx(Ce,{})]}),e.jsxs(W,{children:[l&&e.jsx("div",{children:e.jsx("p",{className:"text-muted-foreground text-center",children:"Failed to fetch move sizes"})}),r&&e.jsx("div",{className:"space-y-4",children:Array.from({length:5}).map((u,x)=>e.jsx(X,{className:"h-18.5 w-full"},x))}),s&&e.jsx(is,{items:a,setItems:t,setOrderChanged:o})]}),e.jsx(Q,{className:"justify-end border-t",children:e.jsxs("div",{className:F("flex transition-opacity gap-3 duration-500",{"invisible opacity-0":!n,"visible opacity-100":n}),children:[e.jsx(C,{type:"button",variant:"outline",onClick:()=>{t(s??[]),o(!1)},children:"Cancel"}),e.jsx(D,{type:"button",disabled:i,loading:i,onClick:()=>{d({moveSizes:a}).unwrap().then(()=>{N.success("Changes saved"),o(!1)}).catch(u=>{S(u)})},children:"Save changes"})]})})]})}function ls(){return Ue().id?e.jsx(Oe,{}):e.jsx(Pe,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsx(os,{}),e.jsx(Ze,{})]})})}const ys=ls;export{ys as Component};
