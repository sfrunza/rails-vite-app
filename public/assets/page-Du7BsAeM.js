import"./chevron-left-zJdJqyR0.js";import{CSS as e,DndContext as t,GripVertical as n,KeyboardSensor as r,PointerSensor as i,SortableContext as a,arrayMove as o,closestCenter as s,restrictToParentElement as c,sortableKeyboardCoordinates as l,useSensor as u,useSensors as d,useSortable as f}from"./sortable.esm-hJ0lGxBr.js";import{PenLine as p}from"./pen-line-ChCzM0Ic.js";import{AlertDialog as m,AlertDialogCancel as ee,AlertDialogContent as h,AlertDialogDescription as te,AlertDialogFooter as ne,AlertDialogHeader as re,AlertDialogTitle as ie,AlertDialogTrigger as g,Trash2 as _}from"./alert-dialog-BMKsEFef.js";import{Button as v,Form as y,FormControl as b,FormDescription as x,FormField as S,FormItem as C,FormLabel as w,FormMessage as T,Input as E,LoadingButton as D,Plus as O,Sheet as k,SheetClose as A,SheetContent as j,SheetDescription as M,SheetFooter as N,SheetHeader as P,SheetTitle as F,SheetTrigger as I,Skeleton as L,__toESM as R,a as z,cn as B,coerce as V,handleApiError as H,objectType as U,require_jsx_runtime as W,require_react as G,stringType as K,toast as q,useBulkUpdatePackingsMutation as J,useCreatePackingMutation as Y,useDeletePackingMutation as ae,useForm as oe,useGetPackingsQuery as se,useUpdatePackingMutation as ce}from"./index-BpPvn16n.js";import{Card as le,CardAction as ue,CardContent as de,CardFooter as fe,CardHeader as pe,CardTitle as me}from"./card-D6e0mOnd.js";import{Textarea as he}from"./textarea-B6XE6fIs.js";import{SettingPageWrapper as ge}from"./setting-page-wrapper-B7I8Q1ot.js";import{NumericInput as X}from"./numeric-input-pQ8PfA2f.js";var Z=R(G()),Q=R(W());const _e=U({name:K().min(1,{message:`Name is required.`}),description:K().optional(),labor_increase:V.number().min(0).max(100)});function $({data:e}){let[t,{isLoading:n}]=Y(),[r,{isLoading:i}]=ce(),[a,o]=(0,Z.useState)(!1),s=!!e,c=oe({mode:`onChange`,reValidateMode:`onChange`,resolver:z(_e),values:e??void 0,defaultValues:{name:``,description:``,labor_increase:0}});async function l(n){let i=s?await r({id:e.id,...n}):await t(n);if(`error`in i){let e=i.error;if(e.status===422){let t=e.data;for(let[e,n]of Object.entries(t))Array.isArray(n)&&c.setError(e,{type:`server`,message:n.join(`, `)})}return}q.success(`Packing ${s?`updated`:`added`}`),o(!1)}function u(){c.reset(),o(e=>!e)}return(0,Q.jsxs)(k,{open:a,onOpenChange:u,children:[(0,Q.jsx)(I,{asChild:!0,children:s?(0,Q.jsx)(v,{variant:`outline`,size:`icon`,children:(0,Q.jsx)(p,{})}):(0,Q.jsxs)(v,{children:[(0,Q.jsx)(O,{}),`Create packing`]})}),(0,Q.jsxs)(j,{children:[(0,Q.jsxs)(P,{children:[(0,Q.jsxs)(F,{children:[s?`Update`:`Add`,` packing service`]}),(0,Q.jsx)(M,{className:`sr-only`})]}),(0,Q.jsx)(`div`,{className:`flex-1 overflow-y-auto p-4`,children:(0,Q.jsx)(y,{...c,children:(0,Q.jsxs)(`form`,{onSubmit:c.handleSubmit(l),className:`space-y-6`,children:[(0,Q.jsx)(S,{control:c.control,name:`name`,render:({field:e})=>(0,Q.jsxs)(C,{children:[(0,Q.jsx)(w,{children:`Name (required)`}),(0,Q.jsx)(x,{children:`Name of the packing service, visible to customers.`}),(0,Q.jsx)(b,{children:(0,Q.jsx)(E,{...e,autoComplete:`off`})}),(0,Q.jsx)(T,{})]})}),(0,Q.jsx)(S,{control:c.control,name:`description`,render:({field:e})=>(0,Q.jsxs)(C,{children:[(0,Q.jsx)(w,{children:`Description`}),(0,Q.jsx)(x,{children:`Appears on the customer portal, and in quotes.`}),(0,Q.jsx)(b,{children:(0,Q.jsx)(he,{...e,rows:3})})]})}),(0,Q.jsx)(S,{control:c.control,name:`labor_increase`,render:({field:e})=>(0,Q.jsxs)(C,{children:[(0,Q.jsx)(w,{children:`Labor increse (%)`}),(0,Q.jsx)(b,{children:(0,Q.jsx)(X,{value:e.value.toString(),min:0,max:100,onChange:t=>{e.onChange(t)}})}),(0,Q.jsx)(T,{})]})})]})})}),(0,Q.jsxs)(N,{children:[(0,Q.jsx)(A,{asChild:!0,children:(0,Q.jsx)(v,{type:`button`,variant:`outline`,children:`Cancel`})}),(0,Q.jsx)(D,{type:`button`,loading:n||i,disabled:n||i,onClick:c.handleSubmit(l),children:`${s?`Update`:`Add`} packing`})]})]})]})}function ve({packing:e}){let[t,n]=(0,Z.useState)(!1),[r,{isLoading:i}]=ae();return(0,Q.jsxs)(m,{open:t,onOpenChange:n,children:[(0,Q.jsx)(g,{asChild:!0,children:(0,Q.jsx)(v,{variant:`outline`,size:`icon`,className:`hover:text-destructive`,children:(0,Q.jsx)(_,{})})}),(0,Q.jsxs)(h,{children:[(0,Q.jsxs)(re,{children:[(0,Q.jsx)(ie,{children:`Delete packing?`}),(0,Q.jsxs)(te,{children:[`This will delete `,(0,Q.jsxs)(`b`,{children:[e.name,`.`]}),(0,Q.jsx)(`br`,{}),`Packing services that have already been used cannot be deleted.`]})]}),(0,Q.jsxs)(ne,{children:[(0,Q.jsx)(ee,{children:`Cancel`}),(0,Q.jsx)(D,{type:`button`,loading:i,disabled:i,variant:`destructive`,onClick:()=>{r({id:e.id}).unwrap().then(()=>{q.success(`Packing deleted`),n(!1)}).catch(e=>{H(e)})},children:`Delete`})]})]})]})}function ye({item:t}){let r=t.is_default,{attributes:i,listeners:a,setNodeRef:o,transform:s,transition:c,isDragging:l}=f({id:t.id}),u={transform:e.Transform.toString(s),transition:c,zIndex:l?1e3:`auto`,position:l?`relative`:`static`};return(0,Q.jsxs)(`div`,{ref:r?null:o,style:u,className:B(`grid grid-cols-[max-content_1fr_auto_auto] border rounded-md items-center gap-2 p-4`,{"bg-background shadow-lg":l}),children:[(0,Q.jsx)(v,{size:`icon`,variant:`ghost`,className:`flex min-w-6 cursor-grab`,disabled:r,...r?{}:i,...r?{}:a,children:(0,Q.jsx)(n,{})}),(0,Q.jsx)(`div`,{className:`overflow-hidden`,children:(0,Q.jsx)(`p`,{className:`truncate text-sm font-medium`,children:t.name})}),(0,Q.jsx)($,{data:t}),r?(0,Q.jsx)(v,{variant:`ghost`,disabled:!0,size:`icon`,children:(0,Q.jsx)(`span`,{className:`sr-only`,children:`Default`})}):null,!r&&(0,Q.jsx)(ve,{packing:t})]})}function be({items:e,setItems:n,setOrderChanged:f}){let p=d(u(i),u(r,{coordinateGetter:l}));function m(t){let{active:r,over:i}=t;if(i&&r.id!==i.id){let t=e.findIndex(e=>e.id===r.id),a=e.findIndex(e=>e.id===i.id),s=o(e,t,a).map((e,t)=>({...e,index:t}));n(s),f(!0)}}return(0,Q.jsx)(t,{sensors:p,collisionDetection:s,onDragEnd:m,modifiers:[c],children:(0,Q.jsx)(a,{items:e,children:(0,Q.jsx)(`div`,{className:`space-y-2`,children:e.map(e=>(0,Q.jsx)(ye,{item:e},e.id))})})})}function xe(){let{data:e,isLoading:t,isError:n}=se(),[r,{isLoading:i}]=J(),[a,o]=(0,Z.useState)([]),[s,c]=(0,Z.useState)(!1);return(0,Z.useEffect)(()=>{e&&o(e)},[e]),(0,Q.jsx)(ge,{children:(0,Q.jsxs)(le,{className:`max-w-2xl`,children:[(0,Q.jsxs)(pe,{children:[(0,Q.jsx)(me,{children:`Packing Services`}),(0,Q.jsx)(ue,{children:(0,Q.jsx)($,{})})]}),(0,Q.jsxs)(de,{children:[n&&(0,Q.jsx)(`div`,{children:(0,Q.jsx)(`p`,{className:`text-muted-foreground text-center`,children:`Failed to fetch packings`})}),t&&(0,Q.jsx)(`div`,{className:`space-y-2`,children:Array.from({length:3}).map((e,t)=>(0,Q.jsx)(L,{className:`h-17.5 w-full`},t))}),e&&(0,Q.jsx)(be,{items:a,setItems:o,setOrderChanged:c})]}),(0,Q.jsx)(fe,{className:`justify-end border-t`,children:(0,Q.jsxs)(`div`,{className:B(`flex transition-opacity duration-500 gap-3`,{"invisible opacity-0":!s,"visible opacity-100":s}),children:[(0,Q.jsx)(v,{type:`button`,variant:`outline`,onClick:()=>{o(e??[]),c(!1)},children:`Cancel`}),(0,Q.jsx)(D,{type:`button`,disabled:i,loading:i,onClick:()=>{r({packings:a}).unwrap().then(()=>{c(!1),q.success(`Changes saved`)}).catch(e=>{H(e)})},children:`Save changes`})]})})]})})}const Se=xe;export{Se as Component};