import{r as u,f as b,j as e,B as x,L as g,t as j,h as p,g as v,i as y,S as D,k as N,l as w,m as F,n as A,o as I,p as k,q as T,s as E,v as M}from"./index-Cj1aizr1.js";import{C as L,a as P,b as _,f as O,d as q,e as z}from"./card-DbZ9XtYA.js";import{S as B}from"./skeleton--NcqKXF8.js";import{S as G}from"./setting-page-wrapper-qE5NUTXL.js";import{A as H,a as K,T as U,b as V,c as R,d as Q,e as W,f as J,g as X,u as Y,C as Z,G as $,h as ee,i as f,D as se,r as ae,j as re,S as ne,k as te,s as ie,K as oe,P as ce}from"./alert-dialog-qzuq5uB0.js";import{S as le}from"./switch-DFqHTdH9.js";import{u as de,F as he,a as me,b as ue,c as xe,d as ge,e as je,f as pe,s as fe,o as ve,g as Se}from"./zod-D8Kr9309.js";import{I as Ce}from"./input-dtjFCb6t.js";import{P as be}from"./plus-5VBlmZlM.js";import"./index-BMLLlnnD.js";import"./label-DBLbUNnz.js";function ye({service:s}){const[r,i]=u.useState(!1),[l,{isLoading:n}]=b();return e.jsxs(H,{open:r,onOpenChange:i,children:[e.jsx(K,{asChild:!0,children:e.jsx(x,{variant:"ghost",size:"icon",className:"hover:text-destructive",children:e.jsx(U,{})})}),e.jsxs(V,{children:[e.jsxs(R,{children:[e.jsx(Q,{children:"Delete moving service?"}),e.jsxs(W,{children:["This will delete ",e.jsxs("b",{children:[s.name,"."]})," Services that have already been used cannot be deleted."]})]}),e.jsxs(J,{children:[e.jsx(X,{children:"Cancel"}),e.jsx(g,{type:"button",loading:n,disabled:n,variant:"destructive",onClick:()=>{l({id:s.id}).unwrap().then(()=>{j.success("Moving service deleted"),i(!1)}).catch(o=>{p(o)})},children:"Delete"})]})]})]})}function De({id:s,item:r,onEnabledChange:i}){const{attributes:l,listeners:n,setNodeRef:o,transform:a,transition:c,isDragging:t}=Y({id:s}),d={transform:Z.Transform.toString(a),transition:c,zIndex:t?1e3:"auto",position:t?"relative":"static"};return e.jsxs("div",{ref:o,style:d,className:v("grid grid-cols-[max-content_1fr_max-content_max-content] border rounded-md items-center gap-2 p-2",{"bg-background shadow-lg":t}),children:[e.jsx(x,{size:"icon",variant:"ghost",className:"flex min-w-6 cursor-grab",...l,...n,children:e.jsx($,{})}),e.jsx("div",{className:"overflow-hidden",children:e.jsx("p",{className:"truncate text-sm font-medium",children:r.name})}),e.jsx(le,{checked:r.enabled,onCheckedChange:h=>{i(r.id,h)}}),r.is_default?e.jsx("div",{className:"size-9"}):e.jsx(ye,{service:r})]})}function Ne({items:s,setItems:r,setOrderChanged:i}){const l=ee(f(ce),f(oe,{coordinateGetter:ie}));function n(a){const{active:c,over:t}=a;if(t&&c.id!==t.id){const d=s.findIndex(m=>m.id===c.id),h=s.findIndex(m=>m.id===t.id),S=te(s,d,h).map((m,C)=>({...m,index:C}));r(S),i(!0)}}function o(a,c){r(s.map(t=>t.id===a?{...t,enabled:c}:t)),i(!0)}return e.jsx(se,{sensors:l,collisionDetection:re,onDragEnd:n,modifiers:[ae],children:e.jsx(ne,{items:s,children:e.jsx("div",{className:"space-y-2",children:s.map(a=>e.jsx(De,{id:a.id,item:a,onEnabledChange:o},a.id))})})})}const we=ve({name:Se({required_error:"Name is required."}).min(5,{message:"Name must be at least 5 characters long."})});function Fe(){const[s,{isLoading:r}]=y(),[i,l]=u.useState(!1),n=de({mode:"onChange",reValidateMode:"onChange",resolver:fe(we),defaultValues:{name:""}});function o(a){s(a).unwrap().then(()=>{j.success("Service created"),l(!1),n.reset()}).catch(c=>{p(c)})}return e.jsxs(D,{open:i,onOpenChange:l,children:[e.jsx(N,{asChild:!0,children:e.jsxs(x,{children:[e.jsx(be,{}),"Create service"]})}),e.jsxs(w,{children:[e.jsxs(F,{children:[e.jsx(A,{children:"Add moving service"}),e.jsx(I,{className:"sr-only"})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4",children:e.jsx(he,{...n,children:e.jsx("form",{onSubmit:n.handleSubmit(o),className:"space-y-6",children:e.jsx(me,{control:n.control,name:"name",render:({field:a})=>e.jsxs(ue,{children:[e.jsx(xe,{children:"Name (required)"}),e.jsx(ge,{children:"Name of the moving service, visible to customers."}),e.jsx(je,{children:e.jsx(Ce,{...a,autoComplete:"off"})}),e.jsx(pe,{})]})})})})}),e.jsxs(k,{children:[e.jsx(T,{asChild:!0,children:e.jsx(x,{type:"button",variant:"outline",className:"w-full",children:"Cancel"})}),e.jsx(g,{type:"button",loading:r,disabled:r,onClick:n.handleSubmit(o),className:"w-full",children:"Add service"})]})]})]})}function Ae(){const{data:s,isLoading:r,isError:i}=E(),[l,{isLoading:n}]=M(),[o,a]=u.useState([]),[c,t]=u.useState(!1);return u.useEffect(()=>{s&&a(s)},[s]),e.jsx(G,{children:e.jsxs(L,{className:"max-w-xl",children:[e.jsxs(P,{children:[e.jsx(_,{children:"Moving Services"}),e.jsx(O,{children:e.jsx(Fe,{})})]}),e.jsxs(q,{children:[i&&e.jsx("div",{children:e.jsx("p",{className:"text-muted-foreground text-center",children:"Failed to fetch services"})}),r&&e.jsx("div",{className:"space-y-2",children:Array.from({length:5}).map((d,h)=>e.jsx(B,{className:"h-13.5 w-full"},h))}),s&&e.jsx(Ne,{items:o,setItems:a,setOrderChanged:t})]}),e.jsx(z,{className:"justify-end border-t",children:e.jsxs("div",{className:v("flex transition-opacity gap-3 duration-500",{"invisible opacity-0":!c,"visible opacity-100":c}),children:[e.jsx(x,{type:"button",variant:"outline",onClick:()=>{a(s??[]),t(!1)},children:"Cancel"}),e.jsx(g,{type:"button",disabled:n,loading:n,onClick:()=>{l({services:o}).unwrap().then(()=>{j.success("Changes saved"),t(!1)}).catch(d=>{p(d)})},children:"Save changes"})]})})]})})}const Ge=Ae;export{Ge as Component};
