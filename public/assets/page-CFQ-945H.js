import{PencilLine as e}from"./pencil-line-DiX4p47G.js";import{Avatar as t,AvatarFallback as n,Button as r,Card as i,CardAction as a,CardContent as o,CardDescription as s,CardHeader as c,CardTitle as l,Form as u,FormControl as d,FormDescription as f,FormField as p,FormItem as m,FormLabel as h,FormMessage as g,Input as _,LoadingButton as v,Outlet as y,PasswordInput as ee,PhoneInput as te,Plus as ne,ScrollArea as re,ScrollBar as ie,Select as b,SelectContent as ae,SelectItem as x,SelectTrigger as S,SelectValue as C,Sheet as w,SheetClose as T,SheetContent as oe,SheetDescription as se,SheetFooter as ce,SheetHeader as le,SheetTitle as E,Spinner as D,Switch as O,Tabs as k,TabsList as A,TabsTrigger as j,__toESM as M,a as N,booleanType as P,cn as F,enumType as I,format as L,formatPhone as R,handleApiError as z,isValidPhoneNumber as B,objectType as V,require_jsx_runtime as H,require_react as U,stringType as W,toast as G,useCreateEmployeeMutation as ue,useForm as de,useGetEmployeeByIdQuery as fe,useGetEmployeesQuery as pe,useParams as me,useUpdateEmployeeMutation as he}from"./index-OmLcTgDE.js";import{Badge as ge}from"./badge-puQm4UnR.js";import{Table as _e,TableBody as ve,TableCell as K,TableHead as q,TableHeader as ye,TableRow as J}from"./table-Bp_V9RDd.js";import{SettingPageWrapper as be}from"./setting-page-wrapper-DsxRRjvs.js";var Y=M(H());const xe=[`all`,`admin`,`manager`,`foreman`,`driver`,`helper`];function Se({filter:e,handleSetFilter:t}){return(0,Y.jsx)(k,{value:e,onValueChange:e=>{t(e)},children:(0,Y.jsxs)(re,{className:`pb-2`,children:[(0,Y.jsx)(A,{children:xe.map(e=>(0,Y.jsx)(j,{value:e,className:`capitalize`,children:e},e))}),(0,Y.jsx)(ie,{orientation:`horizontal`})]})})}const X=[{label:`Admin`,value:`admin`},{label:`Manager`,value:`manager`},{label:`Foreman`,value:`foreman`},{label:`Driver`,value:`driver`},{label:`Helper`,value:`helper`}],Ce=V({first_name:W().min(1,{message:`First name is required.`}),last_name:W().min(1,{message:`Last name is required.`}),email_address:W().email({message:`Invalid email address.`}),phone:W().refine(e=>B(e,`US`),{message:`Invalid phone number`}),role:I(X.map(e=>e.value)),active:P().optional(),password:W().optional()});function we({userId:e,closeSheet:t}){let[n,{isLoading:i}]=ue(),[a,{isLoading:o}]=he(),{data:s,isLoading:c}=fe({id:Number(e)},{skip:!e}),l=de({mode:`onChange`,reValidateMode:`onChange`,resolver:N(Ce),defaultValues:{first_name:``,last_name:``,email_address:``,phone:``,role:`helper`,active:!0,password:``},values:s});function y(r){e?a({id:Number(e),data:r}).unwrap().then(()=>{G.success(`User updated.`),t()}).catch(e=>{z(e)}):n({data:r}).unwrap().then(()=>{G.success(`User created.`),t()}).catch(e=>{z(e)})}return(0,Y.jsxs)(Y.Fragment,{children:[(0,Y.jsxs)(le,{children:[(0,Y.jsxs)(E,{children:[e?`Update`:`Add`,` user`]}),(0,Y.jsxs)(se,{className:`flex flex-row items-center gap-2`,children:[(0,Y.jsxs)(`span`,{children:[`Employee ID:`,s?.id??``]}),(0,Y.jsxs)(`span`,{children:[`Creation Date:`,` `,s?.created_at?L(s?.created_at,`dd MMM, yyyy`):``]})]})]}),(0,Y.jsx)(`div`,{className:`flex-1 overflow-y-auto p-4`,children:c&&e?(0,Y.jsx)(`div`,{className:`flex justify-center items-center h-full`,children:(0,Y.jsx)(D,{})}):(0,Y.jsx)(u,{...l,children:(0,Y.jsxs)(`form`,{onSubmit:l.handleSubmit(y),className:`space-y-6`,children:[(0,Y.jsx)(p,{control:l.control,name:`first_name`,render:({field:e})=>(0,Y.jsxs)(m,{children:[(0,Y.jsx)(h,{children:`First name (required)`}),(0,Y.jsx)(d,{children:(0,Y.jsx)(_,{...e,autoComplete:`off`})}),(0,Y.jsx)(g,{})]})}),(0,Y.jsx)(p,{control:l.control,name:`last_name`,render:({field:e})=>(0,Y.jsxs)(m,{children:[(0,Y.jsx)(h,{children:`Last name (required)`}),(0,Y.jsx)(d,{children:(0,Y.jsx)(_,{...e,autoComplete:`off`})}),(0,Y.jsx)(g,{})]})}),(0,Y.jsx)(p,{control:l.control,name:`email_address`,render:({field:e})=>(0,Y.jsxs)(m,{children:[(0,Y.jsx)(h,{children:`Email (required)`}),(0,Y.jsx)(f,{children:`Email address used to login to the system.`}),(0,Y.jsx)(d,{children:(0,Y.jsx)(_,{...e,autoComplete:`off`})}),(0,Y.jsx)(g,{})]})}),(0,Y.jsx)(p,{control:l.control,name:`phone`,render:({field:e})=>(0,Y.jsxs)(m,{children:[(0,Y.jsx)(h,{children:`Phone (required)`}),(0,Y.jsx)(d,{children:(0,Y.jsx)(te,{...e,value:R(e.value??``),handleValueChange:e.onChange})}),(0,Y.jsx)(g,{})]})}),(0,Y.jsx)(p,{control:l.control,name:`role`,render:({field:e})=>(0,Y.jsxs)(m,{children:[(0,Y.jsx)(h,{children:`Position`}),(0,Y.jsxs)(b,{...e,children:[(0,Y.jsx)(d,{children:(0,Y.jsx)(S,{children:(0,Y.jsx)(C,{placeholder:`Select a position`})})}),(0,Y.jsx)(ae,{children:X?.map(({label:e,value:t})=>(0,Y.jsx)(x,{value:t,children:e},t))})]}),(0,Y.jsx)(g,{})]})}),(0,Y.jsx)(p,{control:l.control,name:`password`,render:({field:e})=>(0,Y.jsxs)(m,{children:[(0,Y.jsx)(h,{children:`Password`}),(0,Y.jsx)(f,{children:`Required only when creating a new user.`}),(0,Y.jsx)(d,{children:(0,Y.jsx)(ee,{...e,autoComplete:`off`})}),(0,Y.jsx)(g,{})]})}),(0,Y.jsx)(p,{control:l.control,name:`active`,render:({field:e})=>(0,Y.jsxs)(m,{className:`flex flex-row items-center justify-between rounded-lg border p-4`,children:[(0,Y.jsxs)(`div`,{className:`space-y-0.5`,children:[(0,Y.jsx)(h,{className:`text-base`,children:`Employee is active`}),(0,Y.jsx)(f,{children:`If the employee is active, they will be able to login to the system.`})]}),(0,Y.jsx)(d,{children:(0,Y.jsx)(O,{checked:e.value??!1,onCheckedChange:e.onChange,name:e.name})})]})})]})})}),(0,Y.jsxs)(ce,{children:[(0,Y.jsx)(T,{asChild:!0,children:(0,Y.jsx)(r,{type:`button`,variant:`outline`,className:`w-full`,children:`Cancel`})}),(0,Y.jsx)(v,{type:`button`,loading:i||o,disabled:i||o,onClick:l.handleSubmit(y),className:`w-full`,children:e?`Update user`:`Add user`})]})]})}var Z=M(U());const Q=(0,Z.createContext)(void 0),Te=({children:e})=>{let[t,n]=(0,Z.useState)({props:null,open:!1}),r=e=>{n({props:e??null,open:!0})},i=()=>{n(e=>({...e,open:!1}))};return(0,Y.jsxs)(Q.Provider,{value:{...t,openSheet:r,closeSheet:i},children:[e,(0,Y.jsx)(Ee,{})]})},$=()=>{let e=(0,Z.useContext)(Q);if(!e)throw Error(`useSheet must be used within a SheetProvider`);return e},Ee=()=>{let{open:e,props:t,closeSheet:n}=$();return(0,Y.jsx)(w,{open:e,onOpenChange:e=>!e&&n(),children:(0,Y.jsx)(oe,{className:`w-full sm:min-w-xl`,children:(0,Y.jsx)(we,{...t,closeSheet:n})})})};function De(e,t){return`${e.charAt(0)}${t.charAt(0)}`.toUpperCase()}function Oe({users:e}){return(0,Y.jsxs)(_e,{className:`min-w-[750px]`,children:[(0,Y.jsx)(ye,{children:(0,Y.jsxs)(J,{children:[(0,Y.jsx)(q,{children:`Name`}),(0,Y.jsx)(q,{children:`Phone`}),(0,Y.jsx)(q,{children:`Email`}),(0,Y.jsx)(q,{children:`Role`}),(0,Y.jsx)(q,{children:`Status`}),(0,Y.jsx)(q,{className:`text-right`,children:`Actions`})]})}),(0,Y.jsx)(ve,{children:e.map(e=>(0,Y.jsx)(ke,{user:e},e.id))})]})}function ke({user:i}){let{openSheet:a}=$();return(0,Y.jsxs)(J,{children:[(0,Y.jsxs)(K,{className:`flex items-center gap-2`,children:[(0,Y.jsx)(t,{children:(0,Y.jsx)(n,{children:De(i.first_name,i.last_name)})}),`${i.first_name} ${i.last_name}`]}),(0,Y.jsx)(K,{children:i.phone?R(i.phone):`-`}),(0,Y.jsx)(K,{children:i.email_address}),(0,Y.jsx)(K,{className:`capitalize`,children:i.role}),(0,Y.jsx)(K,{children:(0,Y.jsxs)(ge,{className:F(`capitalize py-1 relative overflow-hidden bg-transparent`,i.active?`text-[#00a455]`:`text-foreground`),children:[(0,Y.jsx)(`span`,{className:`${i.active?`bg-[#00a455]`:`bg-foreground/50`} absolute inset-0 opacity-15`}),i.active?`Active`:`Inactive`,(0,Y.jsx)(`div`,{className:F(`size-2 rounded-full ml-1`,i.active?`bg-[#00a455]`:`bg-foreground/50`)})]})}),(0,Y.jsx)(K,{className:`text-right`,children:(0,Y.jsx)(r,{variant:`ghost`,size:`icon`,onClick:()=>a({userId:i.id}),children:(0,Y.jsx)(e,{})})})]})}function Ae(){let{openSheet:e}=$(),{data:t,isLoading:n}=pe(),[u,d]=(0,Z.useState)(`all`),f=t?.filter(e=>u===`all`?e:e.role===u);function p(e){d(e)}return(0,Y.jsxs)(i,{children:[(0,Y.jsxs)(c,{children:[(0,Y.jsx)(l,{children:`Employees`}),(0,Y.jsx)(s,{children:`Manage your employees and their roles.`}),(0,Y.jsx)(a,{children:(0,Y.jsxs)(r,{onClick:()=>e(),children:[(0,Y.jsx)(ne,{}),`Create user`]})})]}),(0,Y.jsxs)(o,{className:`space-y-2`,children:[(0,Y.jsx)(Se,{filter:u,handleSetFilter:p}),n&&(0,Y.jsx)(`div`,{className:`flex h-96 items-center justify-center`,children:(0,Y.jsx)(D,{})}),f&&(0,Y.jsx)(Oe,{users:f??[]})]})]})}function je(){let e=me();return e.id?(0,Y.jsx)(y,{}):(0,Y.jsx)(Te,{children:(0,Y.jsx)(be,{children:(0,Y.jsx)(Ae,{})})})}const Me=je;export{Me as Component};