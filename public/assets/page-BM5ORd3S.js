import{f as Te,aF as Me,r as j,j as e,S as O,l as P,B as y,m as U,n as $,o as q,p as R,q as G,s as B,L as T,t as S,h as w,aG as De,g as I,aH as F,aI as _e,aJ as ke,aK as Ee,aL as Ie,T as Fe,aM as Ae,aN as Le,aO as Oe,aP as Pe}from"./index-C_aFZ-sI.js";import{S as Ue}from"./setting-page-wrapper-DuQItZLx.js";import{C as V,a as H,b as K,f as $e,d as W,e as Q}from"./card-C7HsgJYj.js";import{S as J}from"./skeleton-C1C9ZeBW.js";import{u as X,F as Y,a as g,b as f,c as b,d as D,e as v,f as C,s as Z,o as ee,g as k,i as qe,j as A,h as _,n as Re}from"./zod-D7z4GATd.js";import{I as x}from"./input-BR6PJhv_.js";import{P as se}from"./plus-CFsWEjeL.js";import{A as ne,a as te,T as Ge,b as re,c as ae,d as ie,e as oe,f as le,g as ce,u as de,C as me,G as ue,h as he,i as E,D as xe,r as je,j as pe,S as ge,s as fe,K as ve,P as be,k as ye}from"./alert-dialog-AabGfu8X.js";import{T as Be}from"./textarea-CQ4AmKEE.js";import{P as Ve}from"./pen-line-8cTg32Ag.js";import"./label-BuvHemho.js";/**
 * @license lucide-react v0.513.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const He=[["path",{d:"M5 3v16h16",key:"1mqmf9"}],["path",{d:"m5 19 6-6",key:"jh6hbb"}],["path",{d:"m2 6 3-3 3 3",key:"tkyvxa"}],["path",{d:"m18 16 3 3-3 3",key:"1d4glt"}]],Ke=Te("move-3d",He),We=ee({name:k({required_error:"Name is required."}).min(5,{message:"Name must be at least 5 characters long."}),form_name:k({required_error:"Form name is required."}).min(1,{message:"Form name must be at least 1 character long."})});function Qe(){const[s,{isLoading:a}]=Me(),[l,c]=j.useState(!1),i=X({mode:"onChange",reValidateMode:"onChange",resolver:Z(We),defaultValues:{name:"",form_name:""}});function r(t){s(t).unwrap().then(()=>{S.success("Truck created"),i.reset(),c(!1)}).catch(n=>{w(n)})}return e.jsxs(O,{open:l,onOpenChange:c,children:[e.jsx(P,{asChild:!0,children:e.jsxs(y,{children:[e.jsx(se,{}),"Create stairs"]})}),e.jsxs(U,{children:[e.jsxs($,{children:[e.jsx(q,{children:"Add entrance type"}),e.jsx(R,{className:"sr-only"})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4",children:e.jsx(Y,{...i,children:e.jsxs("form",{onSubmit:i.handleSubmit(r),className:"space-y-6",children:[e.jsx(g,{control:i.control,name:"name",render:({field:t})=>e.jsxs(f,{children:[e.jsx(b,{children:"Name (required)"}),e.jsx(D,{children:"Name of the entrance type shown on quote/contract."}),e.jsx(v,{children:e.jsx(x,{...t,autoComplete:"off"})}),e.jsx(C,{})]})}),e.jsx(g,{control:i.control,name:"form_name",render:({field:t})=>e.jsxs(f,{children:[e.jsx(b,{children:"Form name (required)"}),e.jsx(D,{children:"Name of the entrance type shown on the Book form."}),e.jsx(v,{children:e.jsx(x,{...t})}),e.jsx(C,{})]})})]})})}),e.jsxs(G,{children:[e.jsx(B,{asChild:!0,children:e.jsx(y,{type:"button",variant:"outline",children:"Cancel"})}),e.jsx(T,{type:"button",loading:a,disabled:a,onClick:i.handleSubmit(r),children:"Add stairs"})]})]})]})}function Je({entrance:s}){const[a,l]=j.useState(!1),[c,{isLoading:i}]=De();return e.jsxs(ne,{open:a,onOpenChange:l,children:[e.jsx(te,{asChild:!0,children:e.jsx(y,{variant:"outline",size:"icon",className:"hover:text-destructive",children:e.jsx(Ge,{})})}),e.jsxs(re,{children:[e.jsxs(ae,{children:[e.jsx(ie,{children:"Delete entrance type?"}),e.jsxs(oe,{children:["This will delete ",e.jsxs("b",{children:[s.name,"."]})," Entrance types that have already been used cannot be deleted."]})]}),e.jsxs(le,{children:[e.jsx(ce,{children:"Cancel"}),e.jsx(T,{type:"button",loading:i,disabled:i,variant:"destructive",onClick:()=>{c({id:s.id}).unwrap().then(()=>{S.success("Stairs deleted"),l(!1)}).catch(r=>{w(r)})},children:"Delete"})]})]})]})}function Xe({item:s,onChange:a}){const{attributes:l,listeners:c,setNodeRef:i,transform:r,transition:t,isDragging:n}=de({id:s.id}),o={transform:me.Transform.toString(r),transition:t,zIndex:n?1e3:"auto",position:n?"relative":"static"};return e.jsxs("div",{className:"flex items-center gap-2",ref:i,style:o,children:[e.jsx(ue,{className:"size-5 min-w-5 cursor-grab text-muted-foreground",...l,...c}),e.jsxs("div",{className:I("grid auto-cols-auto grid-flow-col gap-2",{"bg-background":n}),children:[e.jsx(x,{id:`long-name-${s.id}`,type:"text",value:s.name,onChange:u=>{a(s.id,{name:u.target.value})}}),e.jsx(x,{id:`short-name-${s.id}`,type:"text",value:s.form_name,onChange:u=>{a(s.id,{form_name:u.target.value})}}),e.jsx(Je,{entrance:s})]})]})}function Ye({items:s,setItems:a,setOrderChanged:l}){const c=he(E(be),E(ve,{coordinateGetter:fe}));function i(t){const{active:n,over:o}=t;if(o&&n.id!==o.id){const u=s.findIndex(p=>p.id===n.id),h=s.findIndex(p=>p.id===o.id),d=ye(s,u,h).map((p,z)=>({...p,index:z}));a(d),l(!0)}}function r(t,n){a(s.map(o=>o.id===t?{...o,...n}:o)),l(!0)}return e.jsx(xe,{sensors:c,collisionDetection:pe,onDragEnd:i,modifiers:[je],children:e.jsx(ge,{items:s,children:e.jsx("div",{className:"space-y-4",children:s.map(t=>e.jsx(Xe,{item:t,onChange:r},t.id))})})})}function Ze(){const{data:s,isLoading:a,isError:l}=F(),[c,{isLoading:i}]=_e(),[r,t]=j.useState([]),[n,o]=j.useState(!1);return j.useEffect(()=>{s&&t(s)},[s]),e.jsxs(V,{className:"max-w-3xl",children:[e.jsxs(H,{children:[e.jsx(K,{children:"Stairs"}),e.jsx($e,{children:e.jsx(Qe,{})})]}),e.jsxs(W,{children:[l&&e.jsx("div",{children:e.jsx("p",{className:"text-muted-foreground text-center",children:"Failed to fetch stairs"})}),a&&e.jsx("div",{className:"space-y-4",children:Array.from({length:8}).map((u,h)=>e.jsx(J,{className:"h-9"},h))}),s&&e.jsx(Ye,{items:r,setItems:t,setOrderChanged:o})]}),e.jsx(Q,{className:"justify-end border-t",children:e.jsxs("div",{className:I("flex transition-opacity gap-3 duration-500",{"invisible opacity-0":!n,"visible opacity-100":n}),children:[e.jsx(y,{type:"button",variant:"outline",onClick:()=>{t(s??[]),o(!1)},children:"Cancel"}),e.jsx(T,{type:"button",disabled:i,loading:i,onClick:()=>{c({entranceTypes:r}).unwrap().then(()=>{S.success("Changes saved"),o(!1)}).catch(u=>{w(u)})},children:"Save changes"})]})})]})}function es({value:s,onChange:a}){const{data:l}=F();if(!l)return null;const c=(i,r,t)=>{const n=s.map((o,u)=>o.map((h,N)=>u===i&&N===r?t:h));a(n)};return e.jsxs("div",{className:"flex flex-col rounded-lg overflow-hidden border",children:[e.jsx("div",{className:"bg-slate-900 text-white text-center p-1.5 font-semibold text-sm",children:"TO STAIRS"}),e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"bg-slate-900 text-white p-4 flex flex-col items-center justify-center w-8",children:e.jsx("div",{className:"transform -rotate-90 whitespace-nowrap font-semibold text-sm",children:"FROM STAIRS"})}),e.jsxs("div",{className:"bg-background p-4 flex-1",children:[e.jsxs("div",{className:"grid mb-4",style:{gridTemplateColumns:`repeat(${l.length+1}, 1fr)`},children:[e.jsx("div",{}),l.map((i,r)=>e.jsx("div",{className:"flex items-center justify-center text-muted-foreground font-medium text-sm",children:i.name.slice(0,3)},`col-${r}`))]}),e.jsx("div",{className:"grid gap-2",children:l.map((i,r)=>e.jsxs("div",{className:"grid gap-2 items-center",style:{gridTemplateColumns:`repeat(${l.length+1}, 1fr)`},children:[e.jsx("div",{className:"text-muted-foreground text-sm font-medium text-center",children:i.name.slice(0,3)}),l.map((t,n)=>e.jsx(x,{name:`cell-${r}-${n}`,type:"number",className:"w-full p-0 text-center",inputMode:"numeric",value:s[r][n],onChange:o=>c(r,n,Number(o.target.value))},`cell-${r}-${n}`))]},`row-${r}`))})]})]})]})}const L=[[2,2,2,2,2,2,2],[2,2,2,2,2,2,2],[2,2,2,2,2,2,2],[2,2,2,3,2,2,2],[2,2,2,2,2,2,2],[2,2,2,2,2,2,2],[2,2,2,2,2,2,2]];function ss(s,a){const l=s.length,c=s[0].length,i=a.length,r=a[0].length,t=[];for(let n=0;n<i;n++){t[n]=[];for(let o=0;o<r;o++)n<l&&o<c?t[n][o]=s[n][o]:t[n][o]=2}return t}const ns=ee({name:k().min(1,{message:"Name is required"}),description:k(),dispersion:_.number().min(0,{message:"Dispersion must be greater than 0"}),truck_count:_.number().min(0,{message:"Truck count must be greater than 0"}),volume:_.number().min(0,{message:"Volume must be greater than 0"}),weight:_.number().min(0,{message:"Weight must be greater than 0"}),crew_size_settings:A(A(Re())),image:qe(File).optional()});function ts(s){const a=s.target.files&&s.target.files[0],l=a?URL.createObjectURL(a):"";return{file:a,displayUrl:l}}function Ce({data:s}){const{data:a}=F(),[l,{isLoading:c}]=ke(),[i,{isLoading:r}]=Ee(),[t,{isLoading:n}]=Ie(),[o,u]=j.useState(!1),[h,N]=j.useState(null),d=X({resolver:Z(ns),defaultValues:{name:"",description:"",dispersion:0,truck_count:1,volume:0,weight:0,crew_size_settings:L,image:void 0}});j.useEffect(()=>{s&&(d.reset({name:s.name,description:s.description,dispersion:s.dispersion,truck_count:s.truck_count,volume:s.volume,weight:s.weight,crew_size_settings:s.crew_size_settings.length>0?s.crew_size_settings:L}),N(s.image_url))},[s]);async function p(m){s?i({id:s.id,...m}).unwrap().then(()=>{S.success("Changes successfully saved"),d.reset(),z()}).catch(M=>{w(M)}):l(m).unwrap().then(()=>{S.success("Move size successfully added"),d.reset(),z()}).catch(M=>{w(M)})}function z(){d.reset(),u(m=>!m)}return e.jsxs(O,{open:o,onOpenChange:z,children:[e.jsx(P,{asChild:!0,children:s?e.jsx(y,{variant:"outline",size:"icon",children:e.jsx(Ve,{})}):e.jsxs(y,{children:[e.jsx(se,{}),"Create move size"]})}),e.jsxs(U,{className:"w-full sm:max-w-lg",children:[e.jsxs($,{children:[e.jsxs(q,{children:[s?"Edit":"Create"," move size"]}),e.jsx(R,{className:"sr-only"})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4",children:e.jsx(Y,{...d,children:e.jsxs("form",{onSubmit:d.handleSubmit(p),className:"space-y-6",children:[e.jsx(g,{control:d.control,name:"image",render:({field:{value:m,onChange:M,...Ne}})=>e.jsxs(f,{children:[e.jsx(b,{children:"Image"}),e.jsx(v,{children:e.jsx(x,{...Ne,placeholder:"Image",type:"file",accept:"image/png, image/jpeg",multiple:!1,onChange:Se=>{const{file:we,displayUrl:ze}=ts(Se);N(ze),M(we)}})}),e.jsx(C,{})]})}),e.jsx("div",{className:"flex justify-center items-center",children:h&&e.jsx("div",{className:"relative size-40 p-1 rounded-md border-2 border-dashed",children:e.jsx("img",{src:h,alt:"Company logo",className:"h-full w-full rounded-md object-contain"})})}),e.jsx(g,{control:d.control,name:"name",render:({field:m})=>e.jsxs(f,{children:[e.jsx(b,{children:"Name"}),e.jsx(D,{children:"Name of the move size, visible to customers."}),e.jsx(v,{children:e.jsx(x,{...m,autoComplete:"off"})}),e.jsx(C,{})]})}),e.jsx(g,{control:d.control,name:"description",render:({field:m})=>e.jsxs(f,{children:[e.jsx(b,{children:"Description"}),e.jsx(D,{children:"Description of the move size, visible to customers."}),e.jsx(v,{children:e.jsx(Be,{...m,rows:2,autoComplete:"off"})}),e.jsx(C,{})]})}),e.jsx(g,{control:d.control,name:"dispersion",render:({field:m})=>e.jsxs(f,{children:[e.jsx(b,{children:"Dispersion %"}),e.jsx(D,{children:"Dispersion of the move size, visible to customers."}),e.jsx(v,{children:e.jsx(x,{type:"number",pattern:"[0-9]+",inputMode:"numeric",...m})}),e.jsx(C,{})]})}),e.jsx(g,{control:d.control,name:"truck_count",render:({field:m})=>e.jsxs(f,{children:[e.jsx(b,{children:"Trucks count for this size"}),e.jsx(v,{children:e.jsx(x,{type:"number",pattern:"[0-9]+",inputMode:"numeric",...m})})]})}),e.jsx(g,{control:d.control,name:"volume",render:({field:m})=>e.jsxs(f,{children:[e.jsx(b,{children:"Volume"}),e.jsx(v,{children:e.jsx(x,{...m})}),e.jsx(C,{})]})}),e.jsx(g,{control:d.control,name:"weight",render:({field:m})=>e.jsxs(f,{children:[e.jsx(b,{children:"Weight"}),e.jsx(v,{children:e.jsx(x,{...m})}),e.jsx(C,{})]})}),e.jsx(g,{control:d.control,name:"crew_size_settings",render:({field:m})=>e.jsxs(f,{children:[e.jsx("p",{className:"text-sm leading-none font-medium select-none group-data-[disabled=true]:pointer-events-none group-data-[disabled=true]:opacity-50 peer-disabled:cursor-not-allowed peer-disabled:opacity-50",children:"Crew size settings"}),e.jsx(v,{children:e.jsx(es,{value:ss(m.value,Array((a==null?void 0:a.length)??0).fill(null).map(()=>Array((a==null?void 0:a.length)??0).fill(2))),onChange:m.onChange})})]})})]})})}),e.jsxs(G,{children:[e.jsx("div",{children:s&&e.jsxs(ne,{children:[e.jsx(te,{asChild:!0,children:e.jsx(y,{variant:"outline",className:"mt-2 sm:mt-0 w-full text-destructive hover:text-destructive hover:bg-destructive/10",children:"Delete"})}),e.jsxs(re,{children:[e.jsxs(ae,{children:[e.jsx(ie,{children:"Delete move size?"}),e.jsxs(oe,{children:["This will delete ",e.jsx("b",{children:s.name}),". Move sizes that have already been used cannot be deleted."]})]}),e.jsxs(le,{children:[e.jsx(ce,{children:"Cancel"}),e.jsx(T,{type:"button",loading:n,disabled:n,className:"mt-2 sm:mt-0",onClick:async()=>{t({id:s==null?void 0:s.id}).unwrap().then(()=>{S.success("Move size deleted"),z()}).catch(m=>{w(m)})},variant:"destructive",children:"Delete"})]})]})]})}),e.jsx(B,{asChild:!0,children:e.jsx(y,{type:"button",variant:"outline",className:"w-full",children:"Cancel"})}),e.jsx(T,{type:"button",loading:c||r,disabled:c||r,onClick:d.handleSubmit(p),className:"w-full",children:s?"Save changes":"Add move size"})]})]})]})}function rs({item:s}){const{attributes:a,listeners:l,setNodeRef:c,transform:i,transition:r,isDragging:t}=de({id:s.id}),n={transform:me.Transform.toString(i),transition:r,zIndex:t?1e3:"auto",position:t?"relative":"static"};return e.jsxs("div",{className:"flex items-center gap-2",ref:c,style:n,children:[e.jsx(ue,{className:"size-5 min-w-5 cursor-grab text-muted-foreground",...a,...l}),e.jsx("div",{className:"@container w-full",children:e.jsxs("div",{className:I("grid w-full grid-cols-[max-content_1fr_max-content] @lg:grid-cols-9 border rounded-md items-center gap-4 p-4",{"bg-background shadow-lg":t}),children:[e.jsx("div",{children:e.jsx("img",{src:s.image_url??"https://www.thehighlands.org/sites/default/files/styles/hero/public/one-bedroom-3d.png?itok=1Y5yuPSu",alt:s.name,className:"size-10 object-cover"})}),e.jsxs("div",{className:"overflow-hidden @lg:col-span-4",children:[e.jsx("p",{className:"truncate font-semibold",children:s.name}),e.jsx("p",{className:"truncate text-sm",children:s.description})]}),e.jsxs("div",{className:"hidden @lg:flex @lg:col-span-2 gap-4",children:[e.jsxs("div",{className:"items-center flex gap-2 text-muted-foreground",children:[e.jsx(Fe,{className:"size-4"}),e.jsx("p",{className:"truncate text-sm font-medium",children:s.truck_count??1})]}),e.jsxs("div",{className:"items-center flex gap-2 text-muted-foreground",children:[e.jsx(Ke,{className:"size-4"}),e.jsxs("p",{className:"truncate text-sm font-medium",children:[s.volume||100," cbf"]})]})]}),e.jsx("div",{className:"flex justify-end @lg:col-span-2",children:e.jsx(Ce,{data:s})})]})})]})}function as({items:s,setItems:a,setOrderChanged:l}){const c=he(E(be),E(ve,{coordinateGetter:fe}));function i(r){const{active:t,over:n}=r;if(n&&t.id!==n.id){const o=s.findIndex(d=>d.id===t.id),u=s.findIndex(d=>d.id===n.id),N=ye(s,o,u).map((d,p)=>({...d,index:p}));a(N),l(!0)}}return e.jsx(xe,{sensors:c,collisionDetection:pe,onDragEnd:i,modifiers:[je],children:e.jsx(ge,{items:s,children:e.jsx("div",{className:"space-y-4",children:s==null?void 0:s.map(r=>e.jsx(rs,{item:r},r.id))})})})}function is(){const{data:s,isLoading:a,isError:l}=Ae(),[c,{isLoading:i}]=Le(),[r,t]=j.useState([]),[n,o]=j.useState(!1);return j.useEffect(()=>{s&&t(s)},[s]),e.jsxs(V,{className:"max-w-3xl",children:[e.jsxs(H,{className:"flex flex-row justify-between",children:[e.jsx(K,{children:"Move Size"}),e.jsx(Ce,{})]}),e.jsxs(W,{children:[l&&e.jsx("div",{children:e.jsx("p",{className:"text-muted-foreground text-center",children:"Failed to fetch move sizes"})}),a&&e.jsx("div",{className:"space-y-4",children:Array.from({length:5}).map((u,h)=>e.jsx(J,{className:"h-18.5 w-full"},h))}),s&&e.jsx(as,{items:r,setItems:t,setOrderChanged:o})]}),e.jsx(Q,{className:"justify-end border-t",children:e.jsxs("div",{className:I("flex transition-opacity gap-3 duration-500",{"invisible opacity-0":!n,"visible opacity-100":n}),children:[e.jsx(y,{type:"button",variant:"outline",onClick:()=>{t(s??[]),o(!1)},children:"Cancel"}),e.jsx(T,{type:"button",disabled:i,loading:i,onClick:()=>{c({moveSizes:r}).unwrap().then(()=>{S.success("Changes saved"),o(!1)}).catch(u=>{w(u)})},children:"Save changes"})]})})]})}function os(){return Oe().id?e.jsx(Pe,{}):e.jsx(Ue,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsx(is,{}),e.jsx(Ze,{})]})})}const vs=os;export{vs as Component};
