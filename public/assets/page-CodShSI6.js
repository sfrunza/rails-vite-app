import{PhoneInput as e,isValidPhoneNumber as t}from"./phone-input-DV5b9ZTz.js";import{Calendar as n,CalendarWithRates as r}from"./calendar-with-rates-BXHlt0pW.js";import{CalendarDays as i,Mail as a,MapPin as o}from"./map-pin-CcsOFVMM.js";import{ChevronLeft as s}from"./chevron-left-zJdJqyR0.js";import{ChevronRight as c}from"./chevron-right-CRSgIC1I.js";import{PasswordInput as l}from"./password-input-D4CvYEgI.js";import{AddressItem as u,Printer as d}from"./address-item-VCRc9DBb.js";import{AlertDialog as f,AlertDialogCancel as p,AlertDialogContent as ee,AlertDialogDescription as m,AlertDialogFooter as te,AlertDialogHeader as ne,AlertDialogTitle as h,Trash2 as re}from"./alert-dialog-BMKsEFef.js";import{UserRound as g}from"./user-round-DophWfLi.js";import{Anchor as _,Arrow as ie,Button as v,Check as y,ChevronDown as b,ChevronsUpDown as ae,Combination_default as oe,Command as se,CommandEmpty as ce,CommandGroup as le,CommandInput as ue,CommandItem as de,CommandList as fe,Content$1 as pe,DismissableLayer as me,FocusScope as he,Form as ge,FormControl as x,FormDescription as _e,FormField as S,FormItem as C,FormLabel as w,FormMessage as ve,Input as T,Label as E,Link as ye,LoadingButton as D,PageContainer as be,Plus as xe,Portal$1 as Se,Presence as Ce,Primitive as we,RadioGroup as Te,RadioGroupItem as Ee,Root2 as De,ScrollArea as Oe,ScrollBar as ke,Select as Ae,SelectContent as je,SelectItem as Me,SelectTrigger as Ne,SelectValue as Pe,Separator as O,Spinner as Fe,Tooltip as k,TooltipContent as A,TooltipProvider as Ie,TooltipTrigger as Le,X as Re,__toESM as ze,a as Be,api as Ve,buttonVariants as He,clearRequest as Ue,cn as j,composeEventHandlers as We,convertMinutesToHoursAndMinutes as Ge,createContextScope as Ke,createLucideIcon as M,createPopperScope as qe,createSlot as Je,debounce as Ye,format as N,formatCentsToDollars as Xe,formatCentsToDollarsString as Ze,formatDate as Qe,formatPhone as $e,handleApiError as et,hideOthers as tt,objectType as nt,priceObjectToString as rt,requestsApi as it,require_jsx_runtime as at,require_react as ot,selectHasChanges as st,setRequest as ct,stringType as P,timeObjectToString as lt,timeWindowToString as ut,toast as F,updateField as I,updateStopField as dt,useAppDispatch as L,useAppSelector as R,useCloneRequestMutation as ft,useComposedRefs as pt,useControllableState as mt,useCreateCustomerMutation as ht,useCreateRequestMutation as gt,useFocusGuards as _t,useForm as vt,useGetEntranceTypesQuery as yt,useGetMoveSizesQuery as bt,useGetPackingsQuery as xt,useGetRequestByIdQuery as St,useGetServicesQuery as Ct,useGetTrucksQuery as wt,useId as Tt,useModal as Et,useNavigate as Dt,usePairRequestMutation as Ot,useParams as kt,useUnpairRequestsMutation as At,useUpdateCustomerMutation as jt,useUpdateRequestMutation as Mt}from"./index-BpPvn16n.js";import{Card as z,CardContent as B,CardDescription as Nt,CardFooter as Pt,CardHeader as V,CardTitle as H}from"./card-D6e0mOnd.js";import{Tabs as Ft,TabsContent as U,TabsList as It,TabsTrigger as W}from"./tabs-ONBK2pzv.js";import{TIME_OPTIONS as Lt,TIME_OPTIONS_WITH_MERIDIEM as G,cable_default as Rt,statusBgColors as zt,statusOptions as Bt}from"./cable-BpiuPVb-.js";import{Switch as Vt}from"./switch-TnSuzTX_.js";import{Textarea as Ht}from"./textarea-B6XE6fIs.js";const Ut=[[`path`,{d:`M2 16V4a2 2 0 0 1 2-2h11`,key:`spzkk5`}],[`path`,{d:`M22 18H11a2 2 0 1 0 0 4h10.5a.5.5 0 0 0 .5-.5v-15a.5.5 0 0 0-.5-.5H11a2 2 0 0 0-2 2v12`,key:`1wz07i`}],[`path`,{d:`M5 14H4a2 2 0 1 0 0 4h1`,key:`16gqf9`}]],Wt=M(`book-copy`,Ut),Gt=[[`path`,{d:`M17 21v-2a1 1 0 0 1-1-1v-1a2 2 0 0 1 2-2h2a2 2 0 0 1 2 2v1a1 1 0 0 1-1 1`,key:`10bnsj`}],[`path`,{d:`M19 15V6.5a1 1 0 0 0-7 0v11a1 1 0 0 1-7 0V9`,key:`1eqmu1`}],[`path`,{d:`M21 21v-2h-4`,key:`14zm7j`}],[`path`,{d:`M3 5h4V3`,key:`z442eg`}],[`path`,{d:`M7 5a1 1 0 0 1 1 1v1a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V6a1 1 0 0 1 1-1V3`,key:`ebdjd7`}]],Kt=M(`cable`,Gt),qt=[[`circle`,{cx:`12`,cy:`12`,r:`10`,key:`1mglay`}],[`path`,{d:`m15 9-6 6`,key:`1uzhvr`}],[`path`,{d:`m9 9 6 6`,key:`z0biqf`}]],Jt=M(`circle-x`,qt),Yt=[[`rect`,{width:`8`,height:`4`,x:`8`,y:`2`,rx:`1`,key:`1oijnt`}],[`path`,{d:`M8 4H6a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-.5`,key:`1but9f`}],[`path`,{d:`M16 4h2a2 2 0 0 1 1.73 1`,key:`1p8n7l`}],[`path`,{d:`M8 18h1`,key:`13wk12`}],[`path`,{d:`M21.378 12.626a1 1 0 0 0-3.004-3.004l-4.01 4.012a2 2 0 0 0-.506.854l-.837 2.87a.5.5 0 0 0 .62.62l2.87-.837a2 2 0 0 0 .854-.506z`,key:`2t3380`}]],Xt=M(`clipboard-pen-line`,Yt),Zt=[[`path`,{d:`M15 21v-8a1 1 0 0 0-1-1h-4a1 1 0 0 0-1 1v8`,key:`5wwlr5`}],[`path`,{d:`M3 10a2 2 0 0 1 .709-1.528l7-5.999a2 2 0 0 1 2.582 0l7 5.999A2 2 0 0 1 21 10v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z`,key:`1d0kgt`}]],Qt=M(`house`,Zt),$t=[[`rect`,{width:`18`,height:`18`,x:`3`,y:`3`,rx:`2`,ry:`2`,key:`1m3agn`}],[`circle`,{cx:`9`,cy:`9`,r:`2`,key:`af1f0g`}],[`path`,{d:`m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21`,key:`1xmnt7`}]],en=M(`image`,$t),tn=[[`rect`,{width:`16`,height:`13`,x:`6`,y:`4`,rx:`2`,key:`1drq3f`}],[`path`,{d:`m22 7-7.1 3.78c-.57.3-1.23.3-1.8 0L6 7`,key:`xn252p`}],[`path`,{d:`M2 8v11c0 1.1.9 2 2 2h14`,key:`n13cji`}]],nn=M(`mails`,tn),rn=[[`path`,{d:`M13 2a9 9 0 0 1 9 9`,key:`1itnx2`}],[`path`,{d:`M13 6a5 5 0 0 1 5 5`,key:`11nki7`}],[`path`,{d:`M13.832 16.568a1 1 0 0 0 1.213-.303l.355-.465A2 2 0 0 1 17 15h3a2 2 0 0 1 2 2v3a2 2 0 0 1-2 2A18 18 0 0 1 2 4a2 2 0 0 1 2-2h3a2 2 0 0 1 2 2v3a2 2 0 0 1-.8 1.6l-.468.351a1 1 0 0 0-.292 1.233 14 14 0 0 0 6.392 6.384`,key:`9njp5v`}]],an=M(`phone-call`,rn),on=[[`path`,{d:`M21 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h6`,key:`y09zxi`}],[`path`,{d:`m21 3-9 9`,key:`mpx6sq`}],[`path`,{d:`M15 3h6v6`,key:`1q9fwt`}]],sn=M(`square-arrow-out-up-right`,on),cn=[[`path`,{d:`M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7`,key:`1m0v6g`}],[`path`,{d:`M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z`,key:`ohrbg2`}]],ln=M(`square-pen`,cn),un=[[`path`,{d:`M12 3v12`,key:`1x0j5s`}],[`path`,{d:`m17 8-5-5-5 5`,key:`7q97r8`}],[`path`,{d:`M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4`,key:`ih7n3h`}]],dn=M(`upload`,un);var K=ze(ot());function fn(e){let t=L(),n=(0,K.useRef)(null);(0,K.useEffect)(()=>{if(e)return n.current=Rt.subscriptions.create({channel:`RequestChannel`,request_id:e},{connected(){console.log(`Connected to RequestChannel_${e}`)},disconnected(){console.log(`Disconnected from RequestChannel_${e}`)},received(n){console.log(`RequestChannel_${e} received`,n),t(ct(n)),t(it.util.invalidateTags([{type:`Request`,id:Number(e)}]))},ensureActiveConnection(){console.log(`ensureActiveConnection_${e}`)}}),()=>{n.current&&(n.current.unsubscribe(),Rt.disconnect()),console.log(`Disconnected from RequestChannel_${e}`)}},[e])}function pn(e,t,n,r){function i(e){return e instanceof n?e:new n(function(t){t(e)})}return new(n||=Promise)(function(n,a){function o(e){try{c(r.next(e))}catch(e){a(e)}}function s(e){try{c(r.throw(e))}catch(e){a(e)}}function c(e){e.done?n(e.value):i(e.value).then(o,s)}c((r=r.apply(e,t||[])).next())})}function mn(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,`default`)?e.default:e}var hn=function e(t,n){if(t===n)return!0;if(t&&n&&typeof t==`object`&&typeof n==`object`){if(t.constructor!==n.constructor)return!1;var r,i,a;if(Array.isArray(t)){if(r=t.length,r!=n.length)return!1;for(i=r;i--!==0;)if(!e(t[i],n[i]))return!1;return!0}if(t.constructor===RegExp)return t.source===n.source&&t.flags===n.flags;if(t.valueOf!==Object.prototype.valueOf)return t.valueOf()===n.valueOf();if(t.toString!==Object.prototype.toString)return t.toString()===n.toString();if(a=Object.keys(t),r=a.length,r!==Object.keys(n).length)return!1;for(i=r;i--!==0;)if(!Object.prototype.hasOwnProperty.call(n,a[i]))return!1;for(i=r;i--!==0;){var o=a[i];if(!e(t[o],n[o]))return!1}return!0}return t!==t&&n!==n},gn=mn(hn);const _n=`__googleMapsScriptId`;var vn;(function(e){e[e.INITIALIZED=0]=`INITIALIZED`,e[e.LOADING=1]=`LOADING`,e[e.SUCCESS=2]=`SUCCESS`,e[e.FAILURE=3]=`FAILURE`})(vn||={});var yn=class e{constructor({apiKey:t,authReferrerPolicy:n,channel:r,client:i,id:a=_n,language:o,libraries:s=[],mapIds:c,nonce:l,region:u,retries:d=3,url:f=`https://maps.googleapis.com/maps/api/js`,version:p}){if(this.callbacks=[],this.done=!1,this.loading=!1,this.errors=[],this.apiKey=t,this.authReferrerPolicy=n,this.channel=r,this.client=i,this.id=a||_n,this.language=o,this.libraries=s,this.mapIds=c,this.nonce=l,this.region=u,this.retries=d,this.url=f,this.version=p,e.instance){if(!gn(this.options,e.instance.options))throw Error(`Loader must not be called again with different options. ${JSON.stringify(this.options)} !== ${JSON.stringify(e.instance.options)}`);return e.instance}e.instance=this}get options(){return{version:this.version,apiKey:this.apiKey,channel:this.channel,client:this.client,id:this.id,libraries:this.libraries,language:this.language,region:this.region,mapIds:this.mapIds,nonce:this.nonce,url:this.url,authReferrerPolicy:this.authReferrerPolicy}}get status(){return this.errors.length?vn.FAILURE:this.done?vn.SUCCESS:this.loading?vn.LOADING:vn.INITIALIZED}get failed(){return this.done&&!this.loading&&this.errors.length>=this.retries+1}createUrl(){let e=this.url;return e+=`?callback=__googleMapsCallback&loading=async`,this.apiKey&&(e+=`&key=${this.apiKey}`),this.channel&&(e+=`&channel=${this.channel}`),this.client&&(e+=`&client=${this.client}`),this.libraries.length>0&&(e+=`&libraries=${this.libraries.join(`,`)}`),this.language&&(e+=`&language=${this.language}`),this.region&&(e+=`&region=${this.region}`),this.version&&(e+=`&v=${this.version}`),this.mapIds&&(e+=`&map_ids=${this.mapIds.join(`,`)}`),this.authReferrerPolicy&&(e+=`&auth_referrer_policy=${this.authReferrerPolicy}`),e}deleteScript(){let e=document.getElementById(this.id);e&&e.remove()}load(){return this.loadPromise()}loadPromise(){return new Promise((e,t)=>{this.loadCallback(n=>{n?t(n.error):e(window.google)})})}importLibrary(e){return this.execute(),google.maps.importLibrary(e)}loadCallback(e){this.callbacks.push(e),this.execute()}setScript(){var e,t;if(document.getElementById(this.id)){this.callback();return}let n={key:this.apiKey,channel:this.channel,client:this.client,libraries:this.libraries.length&&this.libraries,v:this.version,mapIds:this.mapIds,language:this.language,region:this.region,authReferrerPolicy:this.authReferrerPolicy};Object.keys(n).forEach(e=>!n[e]&&delete n[e]),(t=(e=window==null?void 0:window.google)?.maps)?.importLibrary||(e=>{let t,n,r,i=`The Google Maps JavaScript API`,a=`google`,o=`importLibrary`,s=`__ib__`,c=document,l=window;l=l[a]||(l[a]={});let u=l.maps||={},d=new Set,f=new URLSearchParams,p=()=>t||=new Promise((o,l)=>pn(this,void 0,void 0,function*(){var p;for(r in yield n=c.createElement(`script`),n.id=this.id,f.set(`libraries`,[...d]+``),e)f.set(r.replace(/[A-Z]/g,e=>`_`+e[0].toLowerCase()),e[r]);f.set(`callback`,a+`.maps.`+s),n.src=this.url+`?`+f,u[s]=o,n.onerror=()=>t=l(Error(i+` could not load.`)),n.nonce=this.nonce||(p=c.querySelector(`script[nonce]`))?.nonce||``,c.head.append(n)}));u[o]?console.warn(i+` only loads once. Ignoring:`,e):u[o]=(e,...t)=>d.add(e)&&p().then(()=>u[o](e,...t))})(n);let r=this.libraries.map(e=>this.importLibrary(e));r.length||r.push(this.importLibrary(`core`)),Promise.all(r).then(()=>this.callback(),e=>{let t=new ErrorEvent(`error`,{error:e});this.loadErrorCallback(t)})}reset(){this.deleteScript(),this.done=!1,this.loading=!1,this.errors=[],this.onerrorEvent=null}resetIfRetryingFailed(){this.failed&&this.reset()}loadErrorCallback(e){if(this.errors.push(e),this.errors.length<=this.retries){let e=this.errors.length*2**this.errors.length;console.error(`Failed to load Google Maps script, retrying in ${e} ms.`),setTimeout(()=>{this.deleteScript(),this.setScript()},e)}else this.onerrorEvent=e,this.callback()}callback(){this.done=!0,this.loading=!1,this.callbacks.forEach(e=>{e(this.onerrorEvent)}),this.callbacks=[]}execute(){if(this.resetIfRetryingFailed(),!this.loading)if(this.done)this.callback();else{if(window.google&&window.google.maps&&window.google.maps.version){console.warn(`Google Maps already loaded outside @googlemaps/js-api-loader. This may result in undesirable behavior as options and script parameters may not match.`),this.callback();return}this.loading=!0,this.setScript()}}};const bn=new yn({apiKey:`AIzaSyADEDKabHN5FBcOroOU1W7BzUam0Az8gGQ`,version:`weekly`,libraries:[`places`]});var q=ze(at());const xn=({onAddressSelect:e,...t})=>{let n=(0,K.useRef)(null),r=(0,K.useRef)(null);return(0,K.useEffect)(()=>{let t,i=async()=>{await bn.importLibrary(`places`),n.current&&window.google&&(t=new google.maps.places.Autocomplete(n.current,{types:[`address`],componentRestrictions:{country:`us`},fields:[`address_components`,`geometry`]}),r.current=t,t.addListener(`place_changed`,()=>{var n;let r=t.getPlace(),i=r.address_components,a=``,o=``,s=``,c=``;for(let e of i){let t=e.types[0];switch(t){case`premise`:a=e.long_name;break;case`street_number`:a=e.long_name;break;case`route`:a+=` `+e.long_name;break;case`locality`:o=e.long_name;break;case`administrative_area_level_1`:s=e.short_name;break;case`postal_code`:c=e.long_name;break}}let l=(n=r.geometry)?.location,u={street:a,city:o,state:s,zip:c,location:{lat:l?.lat(),lng:l?.lng()}};e(u)}))};return i().catch(e=>console.error(`Error loading Google Maps:`,e)),()=>{let e=document.querySelectorAll(`.pac-container`);for(let t of e)t.remove()}},[]),(0,q.jsx)(T,{ref:n,...t})};function Sn({addressType:e,data:t,stopIdx:n}){let r=L(),{data:i}=yt();function a(i){r(n===void 0?I({[e]:{...t,...i}}):dt({index:n,value:{...t,...i}}))}function o(i){let a=i.target.name,o=i.target.value;a===`zip`&&(o=o.replace(/\D/g,``)),r(n===void 0?I({[e]:{...t,[a]:o}}):dt({index:n,field:a,value:o}))}function s(i){let a={...t,floor:i};r(n===void 0?I({[e]:a}):dt({index:n,field:`floor`,value:i}))}return(0,q.jsxs)(`div`,{className:`grid grid-cols-12 gap-2`,children:[(0,q.jsx)(`div`,{className:`col-span-8`,children:(0,q.jsx)(xn,{name:`street`,value:t.street,onAddressSelect:a,placeholder:`Full Address`,title:`Please enter your Full Address`,onChange:o})}),(0,q.jsx)(`div`,{className:`col-span-4`,children:(0,q.jsx)(T,{name:`apt`,value:t.apt,placeholder:`Apt.`,title:`Please enter your Apartment`,onChange:o})}),(0,q.jsx)(`div`,{className:`col-span-6`,children:(0,q.jsx)(T,{name:`city`,value:t.city,placeholder:`City`,title:`Please enter your City`,onChange:o})}),(0,q.jsx)(`div`,{className:`col-span-3`,children:(0,q.jsx)(T,{name:`state`,value:t.state,placeholder:`State`,title:`Please enter your State`,onChange:o})}),(0,q.jsx)(`div`,{className:`col-span-3`,children:(0,q.jsx)(T,{name:`zip`,value:t.zip,placeholder:`ZIP`,title:`Please enter your Zip`,pattern:`[0-9]{5}`,inputMode:`numeric`,maxLength:5,onChange:o})}),(0,q.jsx)(`div`,{className:`col-span-12`,children:(0,q.jsxs)(Ae,{value:t.floor?t.floor.toString():``,onValueChange:e=>s(parseInt(e)),children:[(0,q.jsx)(Ne,{className:`w-full`,children:(0,q.jsx)(Pe,{placeholder:`Select floor`})}),(0,q.jsx)(je,{children:i?.map((e,t)=>(0,q.jsx)(Me,{value:e.id.toString(),className:`hover:cursor-pointer`,children:e.name},t))})]})})]})}function Cn({children:e}){return(0,q.jsx)(`div`,{className:`flex flex-col gap-2`,children:e})}function wn(e){if(!e)return;let t=`https://www.google.com/maps?q=${e.lat},${e.lng}`;window.open(t,`_blank`)}function Tn({addressType:e,addressAction:t,addressLocation:n}){let r=n?.lat===0&&n?.lng===0;return(0,q.jsxs)(`div`,{className:`flex items-center gap-4`,children:[(0,q.jsx)(v,{size:`icon`,variant:`outline`,className:`rounded-full text-green-600 shadow-md hover:text-green-600`,onClick:()=>wn(n),disabled:r,children:(0,q.jsx)(o,{})}),(0,q.jsxs)(`div`,{className:`flex flex-1 items-center justify-between`,children:[(0,q.jsx)(`p`,{className:`capitalize text-sm font-medium text-muted-foreground`,children:e.split(`_`).join(` `)}),t]})]})}const En=nt({pairedRequestId:P().min(1)});function Dn(){let e=R(e=>e.request.request),t=R(st),[n,{isLoading:r}]=Ot(),i=vt({resolver:Be(En),mode:`onSubmit`,reValidateMode:`onSubmit`,defaultValues:{pairedRequestId:``}});async function a(t){e&&await n({id:e?.id,pairedRequestId:Number(t.pairedRequestId)}).unwrap().catch(e=>{F.error(`Error`,{description:e.data.error})})}return(0,q.jsx)(ge,{...i,children:(0,q.jsxs)(`form`,{autoComplete:`off`,onSubmit:i.handleSubmit(a),className:`space-y-2`,children:[(0,q.jsx)(S,{control:i.control,name:`pairedRequestId`,render:({field:e})=>(0,q.jsxs)(C,{children:[(0,q.jsx)(w,{children:`Request ID`}),(0,q.jsx)(x,{children:(0,q.jsx)(T,{...e,title:`Please enter Request ID`})}),(0,q.jsx)(_e,{children:`Enter the ID of the request you want to connect to this request.`})]})}),(0,q.jsx)(D,{disabled:r||t,loading:r,variant:`outline`,type:`submit`,className:`w-full`,children:(0,q.jsxs)(`span`,{className:`flex items-center`,children:[(0,q.jsx)(Kt,{className:`mr-2 size-4`}),`Connect delivery request`]})})]})})}const On={"Moving & Storage":`/svg-icons/warehouse.svg`,"Overnight Truck Storage":`/svg-icons/truck.svg`};function kn({currentRequestId:e,serviceName:t,pairedRequestId:n,movingDate:r,type:i}){let[a,{isLoading:o}]=At();async function s(){if(!n){F.error(`Paired request ID is missing.`);return}await a({requestId:e,pairedRequestId:n}).unwrap().then(()=>{F.success(`Requests disconnected successfully!`)}).catch(e=>{F.error(`Error`,{description:e.data.error})})}return(0,q.jsxs)(`div`,{className:`flex justify-between gap-2 md:pl-6`,children:[(0,q.jsxs)(`div`,{className:`relative flex-1 space-y-2 text-sm`,children:[(0,q.jsx)(`p`,{className:`font-semibold`,children:`Company storage`}),(0,q.jsx)(`div`,{className:`text-primary`,children:(0,q.jsxs)(ye,{to:`/crm/requests/${n}`,children:[`Request #`,n]})}),(0,q.jsxs)(`p`,{className:`text-muted-foreground`,children:[`Move `,i,` date: `,r&&Qe(r)]}),(0,q.jsx)(`img`,{src:On[t],className:`absolute right-0 top-0 size-10`})]}),(0,q.jsx)(`div`,{children:(0,q.jsx)(D,{size:`icon`,variant:`ghost`,disabled:o,loading:o,onClick:s,children:(0,q.jsx)(re,{})})})]})}function An(){var e,t;let n=L(),[r,{isLoading:i}]=gt(),[a]=Mt(),o=R(e=>e.request.request),s=R(e=>e.request.originalRequest),c=R(st),{data:l}=Ct();if(!s||!o)return null;let{service_id:u,is_moving_from_storage:d,paired_request_id:f}=s,{id:p,stops:ee}=o,m=l?.find(e=>e.id===u),te=m?.name!==`Unloading help`,ne=m?.name!==`Loading help`&&m?.name!==`Packing only`&&m?.name!==`Inside move`,h=m?.name===`Moving & Storage`||m?.name===`Overnight Truck Storage`,g=d,_=!!f,ie=h?!g:te,y=h?g:ne,b=h&&g&&_,ae=h&&!g&&_,oe=h&&!_;async function se(){if(!o)return;let e=await r({...o,status:`pending`,paired_request_id:o.id,is_moving_from_storage:!0}).unwrap();e?await a({id:o?.id,data:{paired_request_id:e.id,is_moving_from_storage:!1}}):F.error(`Error`,{description:`Failed to create delivery request.`})}function ce(e){let t={type:e,street:``,city:``,state:``,zip:``,floor:0,apt:``,location:{lat:0,lng:0}};n(I({stops:[...ee,t]}))}function le(e){let t=ee.filter((t,n)=>n!==e);n(I({stops:t}))}return(0,q.jsxs)(`div`,{className:`grid grid-cols-1 gap-6 lg:grid-cols-2`,children:[(0,q.jsxs)(Cn,{children:[te&&(0,q.jsx)(Tn,{addressType:`origin`,addressLocation:o.origin.location}),ie&&(0,q.jsx)(Sn,{addressType:`origin`,data:o.origin}),b&&(0,q.jsx)(kn,{currentRequestId:p,serviceName:m.name,movingDate:(e=o.paired_request)?.moving_date,pairedRequestId:o.paired_request_id,type:`in`})]}),(0,q.jsxs)(Cn,{children:[ne&&(0,q.jsx)(Tn,{addressType:`destination`,addressLocation:o.destination.location,addressAction:(0,q.jsx)(v,{variant:`outline`,className:`rounded-full text-green-600 hover:text-green-600 shadow-md`,children:`Total distance 2.7 miles`})}),oe&&(0,q.jsxs)(`div`,{className:`space-y-2 md:pl-6`,children:[(0,q.jsx)(D,{disabled:i||c,loading:i,onClick:se,className:`w-full`,variant:`outline`,children:(0,q.jsxs)(`span`,{className:`flex items-center`,children:[(0,q.jsx)(xe,{className:`mr-2 size-4`}),`Create delivery request`]})}),(0,q.jsx)(Dn,{})]}),y&&(0,q.jsx)(Sn,{addressType:`destination`,data:o.destination}),ae&&(0,q.jsx)(kn,{currentRequestId:p,serviceName:m.name,movingDate:(t=o.paired_request)?.moving_date,pairedRequestId:o.paired_request_id,type:`out`})]}),ee.map((e,t)=>(0,q.jsxs)(Cn,{children:[(0,q.jsx)(Tn,{addressType:e.type,addressLocation:e.location,addressAction:(0,q.jsx)(v,{size:`icon`,variant:`ghost`,onClick:()=>le(t),children:(0,q.jsx)(re,{})})}),(0,q.jsx)(Sn,{addressType:e.type,data:e,stopIdx:t})]},t)),(0,q.jsxs)(`div`,{className:`lg:col-span-2 grid grid-cols-2 gap-6`,children:[(0,q.jsxs)(v,{className:`w-full`,variant:`outline`,onClick:()=>ce(`pick_up`),children:[(0,q.jsx)(xe,{}),`Add pickup`]}),(0,q.jsxs)(v,{className:`w-full`,variant:`outline`,onClick:()=>ce(`drop_off`),children:[(0,q.jsx)(xe,{}),`Add drop off`]})]})]})}var jn=`Popover`,[Mn,Nn]=Ke(jn,[qe]),Pn=qe(),[Fn,J]=Mn(jn),In=e=>{let{__scopePopover:t,children:n,open:r,defaultOpen:i,onOpenChange:a,modal:o=!1}=e,s=Pn(t),c=K.useRef(null),[l,u]=K.useState(!1),[d,f]=mt({prop:r,defaultProp:i??!1,onChange:a,caller:jn});return(0,q.jsx)(De,{...s,children:(0,q.jsx)(Fn,{scope:t,contentId:Tt(),triggerRef:c,open:d,onOpenChange:f,onOpenToggle:K.useCallback(()=>f(e=>!e),[f]),hasCustomAnchor:l,onCustomAnchorAdd:K.useCallback(()=>u(!0),[]),onCustomAnchorRemove:K.useCallback(()=>u(!1),[]),modal:o,children:n})})};In.displayName=jn;var Ln=`PopoverAnchor`,Rn=K.forwardRef((e,t)=>{let{__scopePopover:n,...r}=e,i=J(Ln,n),a=Pn(n),{onCustomAnchorAdd:o,onCustomAnchorRemove:s}=i;return K.useEffect(()=>(o(),()=>s()),[o,s]),(0,q.jsx)(_,{...a,...r,ref:t})});Rn.displayName=Ln;var zn=`PopoverTrigger`,Bn=K.forwardRef((e,t)=>{let{__scopePopover:n,...r}=e,i=J(zn,n),a=Pn(n),o=pt(t,i.triggerRef),s=(0,q.jsx)(we.button,{type:`button`,"aria-haspopup":`dialog`,"aria-expanded":i.open,"aria-controls":i.contentId,"data-state":er(i.open),...r,ref:o,onClick:We(e.onClick,i.onOpenToggle)});return i.hasCustomAnchor?s:(0,q.jsx)(_,{asChild:!0,...a,children:s})});Bn.displayName=zn;var Vn=`PopoverPortal`,[Hn,Un]=Mn(Vn,{forceMount:void 0}),Wn=e=>{let{__scopePopover:t,forceMount:n,children:r,container:i}=e,a=J(Vn,t);return(0,q.jsx)(Hn,{scope:t,forceMount:n,children:(0,q.jsx)(Ce,{present:n||a.open,children:(0,q.jsx)(Se,{asChild:!0,container:i,children:r})})})};Wn.displayName=Vn;var Y=`PopoverContent`,Gn=K.forwardRef((e,t)=>{let n=Un(Y,e.__scopePopover),{forceMount:r=n.forceMount,...i}=e,a=J(Y,e.__scopePopover);return(0,q.jsx)(Ce,{present:r||a.open,children:a.modal?(0,q.jsx)(qn,{...i,ref:t}):(0,q.jsx)(Jn,{...i,ref:t})})});Gn.displayName=Y;var Kn=Je(`PopoverContent.RemoveScroll`),qn=K.forwardRef((e,t)=>{let n=J(Y,e.__scopePopover),r=K.useRef(null),i=pt(t,r),a=K.useRef(!1);return K.useEffect(()=>{let e=r.current;if(e)return tt(e)},[]),(0,q.jsx)(oe,{as:Kn,allowPinchZoom:!0,children:(0,q.jsx)(Yn,{...e,ref:i,trapFocus:n.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:We(e.onCloseAutoFocus,e=>{var t;e.preventDefault(),a.current||(t=n.triggerRef.current)?.focus()}),onPointerDownOutside:We(e.onPointerDownOutside,e=>{let t=e.detail.originalEvent,n=t.button===0&&t.ctrlKey===!0,r=t.button===2||n;a.current=r},{checkForDefaultPrevented:!1}),onFocusOutside:We(e.onFocusOutside,e=>e.preventDefault(),{checkForDefaultPrevented:!1})})})}),Jn=K.forwardRef((e,t)=>{let n=J(Y,e.__scopePopover),r=K.useRef(!1),i=K.useRef(!1);return(0,q.jsx)(Yn,{...e,ref:t,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:t=>{var a;if((a=e.onCloseAutoFocus)?.call(e,t),!t.defaultPrevented){var o;r.current||(o=n.triggerRef.current)?.focus(),t.preventDefault()}r.current=!1,i.current=!1},onInteractOutside:t=>{var a,o;(a=e.onInteractOutside)?.call(e,t),t.defaultPrevented||(r.current=!0,t.detail.originalEvent.type===`pointerdown`&&(i.current=!0));let s=t.target,c=(o=n.triggerRef.current)?.contains(s);c&&t.preventDefault(),t.detail.originalEvent.type===`focusin`&&i.current&&t.preventDefault()}})}),Yn=K.forwardRef((e,t)=>{let{__scopePopover:n,trapFocus:r,onOpenAutoFocus:i,onCloseAutoFocus:a,disableOutsidePointerEvents:o,onEscapeKeyDown:s,onPointerDownOutside:c,onFocusOutside:l,onInteractOutside:u,...d}=e,f=J(Y,n),p=Pn(n);return _t(),(0,q.jsx)(he,{asChild:!0,loop:!0,trapped:r,onMountAutoFocus:i,onUnmountAutoFocus:a,children:(0,q.jsx)(me,{asChild:!0,disableOutsidePointerEvents:o,onInteractOutside:u,onEscapeKeyDown:s,onPointerDownOutside:c,onFocusOutside:l,onDismiss:()=>f.onOpenChange(!1),children:(0,q.jsx)(pe,{"data-state":er(f.open),role:`dialog`,id:f.contentId,...p,...d,ref:t,style:{...d.style,"--radix-popover-content-transform-origin":`var(--radix-popper-transform-origin)`,"--radix-popover-content-available-width":`var(--radix-popper-available-width)`,"--radix-popover-content-available-height":`var(--radix-popper-available-height)`,"--radix-popover-trigger-width":`var(--radix-popper-anchor-width)`,"--radix-popover-trigger-height":`var(--radix-popper-anchor-height)`}})})})}),Xn=`PopoverClose`,Zn=K.forwardRef((e,t)=>{let{__scopePopover:n,...r}=e,i=J(Xn,n);return(0,q.jsx)(we.button,{type:`button`,...r,ref:t,onClick:We(e.onClick,()=>i.onOpenChange(!1))})});Zn.displayName=Xn;var Qn=`PopoverArrow`,$n=K.forwardRef((e,t)=>{let{__scopePopover:n,...r}=e,i=Pn(n);return(0,q.jsx)(ie,{...i,...r,ref:t})});$n.displayName=Qn;function er(e){return e?`open`:`closed`}var tr=In,nr=Bn,rr=Wn,ir=Gn;function X({...e}){return(0,q.jsx)(tr,{"data-slot":`popover`,...e})}function Z({...e}){return(0,q.jsx)(nr,{"data-slot":`popover-trigger`,...e})}function Q({className:e,align:t=`center`,sideOffset:n=4,...r}){return(0,q.jsx)(rr,{children:(0,q.jsx)(ir,{"data-slot":`popover-content`,align:t,sideOffset:n,className:j(`bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 z-50 w-72 origin-(--radix-popover-content-transform-origin) rounded-md border p-4 shadow-md outline-hidden`,e),...r})})}function ar({dateRange:e,id:t,onChange:r}){let[i,a]=(0,K.useState)(!1),[o,s]=(0,K.useState)(e);return(0,q.jsxs)(X,{open:i,onOpenChange:a,children:[(0,q.jsx)(Z,{asChild:!0,children:(0,q.jsxs)(`div`,{className:`flex h-9`,children:[(0,q.jsxs)(`div`,{className:`relative`,children:[(0,q.jsxs)(v,{variant:`outline`,id:t,className:`justify-between font-normal rounded-r-none border-r-0 !pr-5`,children:[o?.from?Qe(o.from):`Select date`,(0,q.jsx)(b,{})]}),o?.from&&(0,q.jsx)(Re,{className:`size-4 absolute hover:text-muted-foreground right-1 top-1/2 -translate-y-1/2 cursor-pointer`,onClick:e=>{e.stopPropagation(),s({from:void 0,to:o?.to}),r({from:void 0,to:o?.to})}})]}),(0,q.jsx)(O,{orientation:`vertical`,className:`h-full`}),(0,q.jsxs)(`div`,{className:`relative`,children:[(0,q.jsxs)(v,{variant:`outline`,id:t,className:`justify-between font-normal rounded-l-none border-l-0 !pr-5`,children:[o?.to?Qe(o.to):`Select date`,(0,q.jsx)(b,{})]}),o?.to&&(0,q.jsx)(Re,{className:`size-4 absolute hover:text-muted-foreground right-1 top-1/2 -translate-y-1/2 cursor-pointer`,onClick:e=>{e.stopPropagation(),s({from:o?.from,to:void 0}),r({from:o?.from,to:void 0})}})]})]})}),(0,q.jsx)(Q,{className:`w-auto overflow-hidden p-0`,align:`start`,children:(0,q.jsx)(n,{mode:`range`,defaultMonth:o?.from,selected:o,onSelect:e=>{s(e),r(e)},numberOfMonths:1,showOutsideDays:!1})})]})}function $({options:e,value:t,handleSelect:n,id:r,className:i}){var a;let[o,s]=(0,K.useState)(!1),c=(a=e.find(e=>e.value===t))?.label;function l(t){var r;let i=(r=e.find(e=>e.label===t))?.value;i&&n(i),s(!1)}return(0,q.jsxs)(X,{open:o,onOpenChange:s,children:[(0,q.jsx)(Z,{asChild:!0,id:r,children:(0,q.jsxs)(v,{variant:`outline`,role:`combobox`,"aria-expanded":o,className:j(`justify-between min-w-22.5`,i),children:[(0,q.jsx)(`span`,{className:``,children:c}),(0,q.jsx)(ae,{})]})}),(0,q.jsx)(Q,{className:`w-[200px] p-0`,children:(0,q.jsxs)(se,{children:[(0,q.jsx)(ue,{}),(0,q.jsxs)(fe,{children:[(0,q.jsx)(ce,{children:`Not found.`}),(0,q.jsx)(le,{children:e.map(e=>(0,q.jsxs)(de,{value:e.label,onSelect:l,children:[e.label,(0,q.jsx)(y,{className:j(`ml-auto size-4`,c===e.label?`opacity-100`:`opacity-0`)})]},e.value))})]})]})})]})}function or(){let e=L(),t=R(e=>e.request.request);return t?(0,q.jsxs)(`div`,{className:`flex flex-wrap justify-start gap-4 p-4`,children:[(0,q.jsxs)(`div`,{className:`space-y-2`,children:[(0,q.jsx)(E,{htmlFor:`delivery-date-window`,children:`Delivery window`}),(0,q.jsx)(ar,{dateRange:{from:t.delivery_date_window_start?new Date(t.delivery_date_window_start):void 0,to:t.delivery_date_window_end?new Date(t.delivery_date_window_end):void 0},onChange:t=>{t?.from&&t?.to&&e(I({delivery_date_window_start:t.from.toISOString(),delivery_date_window_end:t.to.toISOString()}))},id:`delivery-date-window`})]}),(0,q.jsxs)(`div`,{className:`space-y-2`,children:[(0,q.jsx)(E,{htmlFor:`delivery-time-window`,children:`Delivery time window`}),(0,q.jsxs)(`div`,{className:`flex h-9`,children:[(0,q.jsx)($,{options:G,value:t.start_time_window_delivery??``,handleSelect:t=>e(I({start_time_window_delivery:t})),className:`rounded-r-none border-r-0 min-w-28`,id:`delivery-time-window`}),(0,q.jsx)(O,{orientation:`vertical`,className:`h-full`}),(0,q.jsx)($,{options:G,value:t.end_time_window_delivery??``,handleSelect:t=>e(I({end_time_window_delivery:t})),className:`rounded-l-none border-l-0 min-w-28`})]})]}),(0,q.jsxs)(`div`,{className:`space-y-2`,children:[(0,q.jsx)(E,{htmlFor:`crew-size-delivery`,children:`Crew size`}),(0,q.jsx)(T,{id:`crew-size-delivery`,pattern:`[0-9]+`,inputMode:`numeric`,value:t.crew_size_delivery||``,onChange:t=>{let n=t.target.value;/^\d*$/.test(n)&&e(I({crew_size_delivery:parseInt(n)}))},className:`w-16`})]}),(0,q.jsxs)(`div`,{className:`space-y-2`,children:[(0,q.jsx)(E,{htmlFor:`is_delivery_now`,children:`Is delivery now`}),(0,q.jsx)(`div`,{className:`flex items-center justify-center h-9`,children:(0,q.jsx)(Vt,{id:`is_delivery_now`,checked:t.is_delivery_now,onCheckedChange:t=>e(I({is_delivery_now:t}))})})]})]}):null}function sr({value:e,id:t,onChange:n}){let[i,a]=(0,K.useState)(!1);return(0,q.jsxs)(X,{open:i,onOpenChange:a,children:[(0,q.jsx)(Z,{asChild:!0,children:(0,q.jsxs)(v,{variant:`outline`,id:t,className:`justify-between font-normal`,children:[e?Qe(e):`Select date`,(0,q.jsx)(b,{})]})}),(0,q.jsx)(Q,{className:`w-auto overflow-hidden p-0`,align:`start`,children:(0,q.jsx)(r,{calendarProps:{showOutsideDays:!1,mode:`single`,selected:e},onSelectDate:e=>{n(e),a(!1)},showFooter:!0})})]})}function cr(){var e,t;let[n,r]=(0,K.useState)(!1),[i,a]=(0,K.useState)(!1),[o,s]=(0,K.useState)(``),[c,l]=(0,K.useState)(``),u=L(),d=R(e=>e.request.request);if(!d)return null;let f=d.start_time_window,p=d.end_time_window;return(0,q.jsxs)(`div`,{className:`flex h-9`,children:[(0,q.jsxs)(X,{open:n,onOpenChange:r,children:[(0,q.jsx)(Z,{asChild:!0,id:`start-time-window`,children:(0,q.jsxs)(v,{variant:`outline`,role:`combobox`,"aria-expanded":n,className:`justify-between rounded-r-none border-r-0 min-w-22.5`,children:[(0,q.jsx)(`span`,{className:`min-w-16`,children:f?(e=G.find(e=>e.value===f))?.label:``}),(0,q.jsx)(ae,{})]})}),(0,q.jsx)(Q,{className:`w-[200px] p-0`,children:(0,q.jsxs)(se,{children:[(0,q.jsx)(ue,{}),(0,q.jsxs)(fe,{children:[(0,q.jsx)(ce,{children:`No time found.`}),(0,q.jsx)(le,{children:G.map(e=>(0,q.jsxs)(de,{itemType:`tel`,value:e.label,onSelect:e=>{var t;let n=(t=G.find(t=>t.label===e))?.value;u(I({start_time_window:n})),s(e===o?``:e),r(!1)},children:[e.label,(0,q.jsx)(y,{className:j(`ml-auto`,o===e.label?`opacity-100`:`opacity-0`)})]},e.value))})]})]})})]}),(0,q.jsx)(O,{orientation:`vertical`,className:`h-full`}),(0,q.jsxs)(X,{open:i,onOpenChange:a,children:[(0,q.jsxs)(`div`,{className:`relative flex items-center`,children:[(0,q.jsx)(Z,{asChild:!0,children:(0,q.jsxs)(v,{variant:`outline`,role:`combobox`,"aria-expanded":i,className:`justify-between flex-1 rounded-l-none border-l-0 min-w-22.5 !pr-5`,children:[(0,q.jsx)(`span`,{className:`min-w-16`,children:p?(t=G.find(e=>e.value===p))?.label:``}),(0,q.jsx)(ae,{})]})}),p&&(0,q.jsx)(Re,{className:`size-4 absolute hover:text-muted-foreground right-1 top-1/2 -translate-y-1/2 cursor-pointer`,onClick:e=>{e.stopPropagation(),l(``),u(I({end_time_window:null}))}})]}),(0,q.jsx)(Q,{className:`w-[200px] p-0`,children:(0,q.jsxs)(se,{children:[(0,q.jsx)(ue,{}),(0,q.jsxs)(fe,{children:[(0,q.jsx)(ce,{children:`No time found.`}),(0,q.jsx)(le,{children:G.map(e=>(0,q.jsxs)(de,{value:e.label,onSelect:e=>{var t;let n=(t=G.find(t=>t.label===e))?.value;u(I({end_time_window:n})),l(e===c?``:e),a(!1)},children:[e.label,(0,q.jsx)(y,{className:j(`ml-auto`,c===e.label?`opacity-100`:`opacity-0`)})]},e.value))})]})]})})]})]})}function lr(){var e;let t=L(),n=R(e=>e.request.request),{data:r}=Ct(),i=r==null||(e=r.find(e=>e.name===`Flat Rate`))==null?void 0:e.id;if(!n)return null;let a=n.service_id===i,o=n.travel_time,s=n.crew_size,c=n.min_total_time,l=n.rate;return(0,q.jsxs)(`div`,{className:`flex flex-wrap justify-start gap-4 p-4`,children:[(0,q.jsxs)(`div`,{className:`space-y-2`,children:[(0,q.jsx)(E,{htmlFor:`moving-date`,children:`Move Date`}),(0,q.jsx)(sr,{value:n.moving_date?new Date(n.moving_date):void 0,onChange:e=>{t(I({moving_date:e?.toISOString()??null}))},id:`moving-date`})]}),(0,q.jsxs)(`div`,{className:`space-y-2`,children:[(0,q.jsx)(E,{htmlFor:`start-time-window`,children:`Start time window`}),(0,q.jsx)(cr,{})]}),(0,q.jsxs)(`div`,{className:`space-y-2`,children:[(0,q.jsx)(E,{htmlFor:`work-time`,children:`Work time`}),(0,q.jsxs)(`div`,{className:`flex h-9`,children:[(0,q.jsx)($,{options:Lt,value:n.work_time.min,handleSelect:e=>t(I({work_time:{...n.work_time,min:e}})),id:`work-time`,className:`rounded-r-none border-r-0`}),(0,q.jsx)(O,{orientation:`vertical`}),(0,q.jsx)($,{options:Lt,value:n.work_time.max,handleSelect:e=>t(I({work_time:{...n.work_time,max:e}})),className:`rounded-l-none border-l-0`})]})]}),(0,q.jsxs)(`div`,{className:`space-y-2`,children:[(0,q.jsx)(E,{htmlFor:`travel-time`,children:`Travel time`}),(0,q.jsx)($,{options:Lt,value:o,handleSelect:e=>t(I({travel_time:e})),id:`travel-time`})]}),(0,q.jsxs)(`div`,{className:`space-y-2`,children:[(0,q.jsx)(E,{htmlFor:`crew-size`,children:`Crew size`}),(0,q.jsx)(T,{id:`crew-size`,pattern:`[0-9]+`,inputMode:`numeric`,value:s||``,onChange:e=>{let n=e.target.value;/^\d*$/.test(n)&&t(I({crew_size:parseInt(n)}))},className:`w-16`})]}),(0,q.jsxs)(`div`,{className:`space-y-2`,children:[(0,q.jsx)(E,{htmlFor:`rate`,children:`${a?`Flat `:``}Rate`}),(0,q.jsx)(T,{id:`rate`,pattern:`[0-9]+`,inputMode:`numeric`,value:Xe(l)||``,onChange:e=>{let n=e.target.value;/^\d*$/.test(n)&&t(I({rate:Math.round(parseFloat(n)*100)}))},className:`w-24`})]}),(0,q.jsxs)(`div`,{className:`space-y-2`,children:[(0,q.jsx)(E,{htmlFor:`min-total-time`,children:`Min. hours`}),(0,q.jsx)($,{options:Lt,value:c,handleSelect:e=>t(I({min_total_time:e})),id:`min-total-time`})]}),(0,q.jsxs)(`div`,{className:`space-y-2`,children:[(0,q.jsx)(E,{htmlFor:`is_same_day_delivery`,children:`Is one day delivery`}),(0,q.jsx)(`div`,{className:`flex items-center justify-center h-9`,children:(0,q.jsx)(Vt,{id:`is_same_day_delivery`,checked:n.is_same_day_delivery,onCheckedChange:e=>t(I({is_same_day_delivery:e}))})})]})]})}function ur(){let e=L(),t=R(e=>e.request.request);return t?(0,q.jsxs)(`div`,{className:`flex flex-wrap justify-start gap-4 p-4 bg-muted`,children:[(0,q.jsxs)(`div`,{className:`text-muted-foreground w-full md:w-auto`,children:[(0,q.jsx)(`p`,{className:`text-xl uppercase font-semibold`,children:`In Transit:`}),(0,q.jsx)(`p`,{className:`text-sm`,children:`Visible only in schedule`})]}),(0,q.jsxs)(`div`,{className:`space-y-2 w-full md:w-auto`,children:[(0,q.jsx)(E,{htmlFor:`schedule-date-window`,children:`Trucks delivery dates`}),(0,q.jsx)(ar,{dateRange:{from:t.schedule_date_window_start?new Date(t.schedule_date_window_start):void 0,to:t.schedule_date_window_end?new Date(t.schedule_date_window_end):void 0},onChange:t=>{t?.from&&t?.to&&e(I({schedule_date_window_start:t.from.toISOString(),schedule_date_window_end:t.to.toISOString()}))},id:`schedule-date-window`})]}),(0,q.jsxs)(`div`,{className:`space-y-2`,children:[(0,q.jsx)(E,{htmlFor:`start_time_window_schedule`,children:`Delivery truck start`}),(0,q.jsx)($,{options:G,value:t.start_time_window_schedule??``,handleSelect:t=>e(I({start_time_window_schedule:t})),id:`start_time_window_schedule`})]}),(0,q.jsxs)(`div`,{className:`space-y-2`,children:[(0,q.jsx)(E,{htmlFor:`end_time_window_schedule`,children:`Delivery truck end`}),(0,q.jsx)($,{options:G,value:t.end_time_window_schedule??``,handleSelect:t=>e(I({end_time_window_schedule:t})),id:`end_time_window_schedule`})]})]}):null}function dr(){let e=R(e=>e.request.originalRequest),{data:t}=xt();if(!e)return null;let{id:n,moving_date:r,customer:i,origin:a,destination:o,stops:s,start_time_window:c,end_time_window:l,crew_size:d,travel_time:f,rate:p,work_time:ee,total_time:m,total_price:te,details:ne,packing_id:h}=e,re=t?.find(e=>e.id===h);return(0,q.jsxs)(`div`,{className:`space-y-4`,children:[(0,q.jsx)(`div`,{className:`grid grid-cols-1 md:grid-cols-2`,children:(0,q.jsxs)(`div`,{className:`text-sm md:col-span-1 [&>*]:flex [&>*]:justify-between [&>*]:items-start`,children:[(0,q.jsxs)(`div`,{children:[(0,q.jsx)(`p`,{children:`Request`}),(0,q.jsxs)(`b`,{children:[`#`,n]})]}),(0,q.jsxs)(`div`,{children:[(0,q.jsx)(`p`,{children:`Client`}),(0,q.jsxs)(`div`,{className:`text-right flex flex-col`,children:[(0,q.jsxs)(`b`,{children:[i?.first_name,` `,i?.last_name]}),(0,q.jsx)(`b`,{children:$e(i?.phone)}),(0,q.jsx)(`b`,{children:i?.email_address})]})]}),(0,q.jsxs)(`div`,{children:[(0,q.jsx)(`p`,{children:`Date`}),(0,q.jsx)(`b`,{children:Qe(r)})]}),(0,q.jsxs)(`div`,{children:[(0,q.jsx)(`p`,{children:`Start time`}),(0,q.jsx)(`b`,{children:ut(c,l)})]}),(0,q.jsxs)(`div`,{children:[(0,q.jsx)(`p`,{children:`Hourly rate`}),(0,q.jsx)(`b`,{children:Ze(p||0)})]}),(0,q.jsxs)(`div`,{children:[(0,q.jsx)(`p`,{children:`Crew size`}),(0,q.jsxs)(`b`,{children:[d,` movers`]})]}),(0,q.jsxs)(`div`,{children:[(0,q.jsx)(`p`,{children:`Travel time`}),(0,q.jsx)(`b`,{children:Ge(f||0)})]}),(0,q.jsxs)(`div`,{children:[(0,q.jsx)(`p`,{children:`Estimated labor time`}),(0,q.jsx)(`b`,{children:lt(ee)})]}),(0,q.jsxs)(`div`,{children:[(0,q.jsx)(`p`,{children:`Estimated total time`}),(0,q.jsx)(`b`,{children:lt(m)})]}),(0,q.jsxs)(`div`,{children:[(0,q.jsx)(`p`,{children:`Estimated quote`}),(0,q.jsx)(`b`,{children:rt(te)})]}),(0,q.jsxs)(`div`,{children:[(0,q.jsx)(`p`,{children:`Paid deposit`}),(0,q.jsx)(`b`,{children:`0`})]})]})}),(0,q.jsx)(O,{}),(0,q.jsxs)(`div`,{className:`grid gap-6 text-sm md:grid-cols-2`,children:[(0,q.jsx)(u,{type:`Origin`,address:a}),(0,q.jsx)(u,{type:`Destination`,address:o}),s?.map((e,t)=>(0,q.jsx)(u,{type:e.type===`pick_up`?`Extra pickup`:`Extra dropoff`,address:e},t))]}),(0,q.jsx)(O,{}),(0,q.jsxs)(`div`,{children:[(0,q.jsx)(`p`,{className:`font-bold uppercase`,children:`Additional Details`}),(0,q.jsx)(`p`,{className:`whitespace-pre-line text-sm`,children:ne.comments||`N/A`})]}),(0,q.jsx)(O,{}),(0,q.jsxs)(`div`,{className:`flex justify-between text-sm`,children:[(0,q.jsx)(`p`,{className:`font-bold uppercase`,children:`Packing`}),(0,q.jsx)(`p`,{children:re?.name})]}),(0,q.jsx)(O,{})]})}const fr={1:``,2:`ðŸ‘œ`,3:`ðŸ“¦`};function pr(){let{open:e}=Et(),t=R(e=>e.request.request);if(!t)return null;let{data:n}=xt(),{data:r}=bt(),{total_price:i,deposit:a,move_size_id:o,packing_id:s,extra_services_total:c}=t,l=n?.find(e=>e.id===s),u=r?.find(e=>e.id===o);return(0,q.jsxs)(z,{className:`overflow-hidden py-0`,children:[(0,q.jsxs)(V,{className:`flex flex-row items-center justify-between pt-6`,children:[(0,q.jsxs)(`div`,{className:`flex items-center gap-4`,children:[(0,q.jsx)(`div`,{className:`flex size-10 items-center justify-center rounded-full bg-muted p-2`,children:(0,q.jsx)(Qt,{className:`size-5`})}),(0,q.jsxs)(`div`,{className:`flex flex-col gap-1`,children:[(0,q.jsx)(H,{className:`text-base`,children:u?.name}),(0,q.jsx)(Nt,{children:u?.description})]})]}),(0,q.jsxs)(v,{size:`sm`,className:`right-4 top-4 mt-0`,variant:`outline`,onClick:()=>e(`editMoveSize`),children:[(0,q.jsx)(ln,{className:`size-3`}),`Edit`]})]}),(0,q.jsx)(B,{className:`p-0`,children:(0,q.jsxs)(`div`,{className:`text-sm font-medium [&>*:nth-child(odd)]:bg-muted`,children:[(0,q.jsxs)(`div`,{className:`group flex items-center justify-between px-8 py-3 hover:cursor-pointer hover:bg-muted`,onClick:()=>e(`editDeposit`),children:[(0,q.jsx)(`p`,{className:`text-muted-foreground group-hover:text-accent-foreground`,children:`Reservation price`}),(0,q.jsx)(`p`,{className:`group-hover:text-primary`,children:Ze(a)})]}),(0,q.jsxs)(`div`,{className:`group flex items-center justify-between px-8 py-3 hover:cursor-pointer hover:bg-muted`,onClick:()=>e(`editPacking`),children:[(0,q.jsx)(`p`,{className:`text-muted-foreground group-hover:text-accent-foreground`,children:`Packing`}),(0,q.jsxs)(`p`,{className:`group-hover:text-primary`,children:[(0,q.jsx)(`span`,{className:`mr-2`,children:fr[s]}),l?.name]})]}),(0,q.jsxs)(`div`,{className:`group flex items-center justify-between px-8 py-3 hover:cursor-pointer hover:bg-muted`,onClick:()=>e(`editExtraServices`),children:[(0,q.jsx)(`p`,{className:`text-muted-foreground group-hover:text-accent-foreground`,children:`Extra services`}),(0,q.jsx)(`p`,{className:`group-hover:text-primary`,children:Ze(c)})]})]})}),(0,q.jsxs)(Pt,{className:`flex items-center justify-between bg-foreground px-8 py-3 text-sm font-bold text-muted`,children:[(0,q.jsx)(`p`,{children:`Total price`}),(0,q.jsx)(`p`,{children:rt(i)})]})]})}const mr=nt({sales_notes:P().optional(),driver_notes:P().optional(),customer_notes:P().optional(),dispatch_notes:P().optional()});function hr(){let e=R(e=>e.request.request),[t,{isLoading:n}]=Mt(),r=vt({resolver:Be(mr),values:{sales_notes:e?.sales_notes??``,driver_notes:e?.driver_notes??``,customer_notes:e?.customer_notes??``,dispatch_notes:e?.dispatch_notes??``},defaultValues:{sales_notes:``,driver_notes:``,customer_notes:``,dispatch_notes:``}});function i(n){if(console.log(n),!e)return null;t({id:e.id,data:{...n}}).unwrap().then(()=>{F.success(`Notes saved`)}).catch(e=>{et(e)})}return(0,q.jsx)(`form`,{onSubmit:r.handleSubmit(i),children:(0,q.jsxs)(`div`,{className:`space-y-4`,children:[(0,q.jsxs)(Ft,{defaultValue:`sales_notes`,children:[(0,q.jsxs)(Oe,{className:`w-full whitespace-nowrap pb-2`,children:[(0,q.jsxs)(It,{className:`justify-start gap-1`,children:[(0,q.jsx)(W,{value:`sales_notes`,children:(0,q.jsxs)(`div`,{className:`relative px-1`,children:[`Sales notes`,` `,r.watch(`sales_notes`)&&(0,q.jsx)(`span`,{className:`absolute -right-1 top-0 size-1.5 rounded-full bg-green-600`})]})}),(0,q.jsx)(W,{value:`driver_notes`,children:(0,q.jsxs)(`div`,{className:`relative px-1`,children:[`Driver notes`,` `,r.watch(`driver_notes`)&&(0,q.jsx)(`span`,{className:`absolute -right-1 top-0 size-1.5 rounded-full bg-green-600`})]})}),(0,q.jsx)(W,{value:`customer_notes`,children:(0,q.jsxs)(`div`,{className:`relative px-1`,children:[`Customer notes`,` `,r.watch(`customer_notes`)&&(0,q.jsx)(`span`,{className:`absolute -right-1 top-0 size-1.5 rounded-full bg-green-600`})]})}),(0,q.jsx)(W,{value:`dispatch_notes`,children:(0,q.jsxs)(`div`,{className:`relative px-1`,children:[`Dispatch notes`,` `,r.watch(`dispatch_notes`)&&(0,q.jsx)(`span`,{className:`absolute -right-1 top-0 size-1.5 rounded-full bg-green-600`})]})})]}),(0,q.jsx)(ke,{orientation:`horizontal`,className:`mt-2`})]}),(0,q.jsx)(U,{value:`sales_notes`,children:(0,q.jsx)(Ht,{rows:8,...r.register(`sales_notes`)})}),(0,q.jsx)(U,{value:`driver_notes`,children:(0,q.jsx)(Ht,{rows:8,...r.register(`driver_notes`)})}),(0,q.jsx)(U,{value:`customer_notes`,children:(0,q.jsx)(Ht,{rows:8,...r.register(`customer_notes`)})}),(0,q.jsx)(U,{value:`dispatch_notes`,children:(0,q.jsx)(Ht,{rows:8,...r.register(`dispatch_notes`)})})]}),(0,q.jsx)(`div`,{className:`flex justify-end`,children:(0,q.jsx)(D,{loading:n,disabled:!r.formState.isDirty||n,type:`submit`,children:`Save notes`})})]})})}function gr(){let e=R(e=>e.request.request);return(0,q.jsxs)(`div`,{className:`mt-6 grid grid-cols-12 gap-4 divide-y bg-background p-4 md:divide-y-0 md:p-6`,children:[(0,q.jsxs)(`div`,{className:j(He({variant:`ghost`}),`col-span-12 flex h-full flex-col gap-2 p-4 hover:cursor-pointer md:col-span-3`),children:[(0,q.jsxs)(`div`,{className:`flex items-center gap-4 text-muted-foreground`,children:[(0,q.jsx)(sn,{className:`size-4`}),(0,q.jsx)(`p`,{children:`Source`})]}),(0,q.jsx)(`p`,{children:`--`})]}),(0,q.jsxs)(`div`,{className:`col-span-12 flex flex-col items-center justify-center gap-2 p-4 text-sm md:col-span-3`,children:[(0,q.jsxs)(`div`,{className:`flex items-center gap-4 text-muted-foreground`,children:[(0,q.jsx)(i,{className:`size-4`}),(0,q.jsx)(`p`,{children:`Created at`})]}),(0,q.jsx)(`p`,{children:N(e?.created_at||new Date,`Pp`)})]}),(0,q.jsxs)(`div`,{className:`col-span-12 flex flex-col items-center justify-center gap-2 p-4 text-sm md:col-span-3`,children:[(0,q.jsxs)(`div`,{className:`flex items-center gap-4 text-muted-foreground`,children:[(0,q.jsx)(i,{className:`size-4`}),(0,q.jsx)(`p`,{children:`Updated at`})]}),(0,q.jsx)(`p`,{children:N(e?.updated_at||new Date,`Pp`)})]})]})}function _r(){let e=R(e=>e.request.request),t=R(st),[n,{isLoading:r}]=Mt();function i(){e&&n({id:e.id,data:{...e}}).unwrap().then(()=>{F.success(`Request updated`)}).catch(e=>{et(e)})}return(0,q.jsxs)(q.Fragment,{children:[(0,q.jsx)(`div`,{className:j(`hidden transition-opacity duration-500 lg:block`,{"invisible opacity-0":!t,"visible opacity-100":r||t}),children:(0,q.jsx)(D,{loading:r,disabled:r,size:`lg`,onClick:i,children:`Update request`})}),(0,q.jsx)(`div`,{className:j(`absolute bottom-0 left-0 z-50 w-full lg:hidden`,{"invisible opacity-0":!t,"visible opacity-100":r||t}),children:(0,q.jsx)(D,{loading:r,disabled:r,size:`lg`,className:`w-full rounded-none rounded-t-xl py-8 text-base`,onClick:i,children:`Update request`})})]})}function vr(){let e=Dt(),{id:t,status:n}=R(e=>e.request.originalRequest),[r,{isLoading:i}]=ft();function a(e){yr(`${e}/contract`,`_blank`,600,850)}function o(e){yr(`${e}/pdf`,`_blank`,900,900)}function s(t){r({id:t}).unwrap().then(t=>{e(`/crm/requests/${t.id}`)})}return(0,q.jsxs)(`div`,{className:`flex w-full justify-around gap-x-4 md:w-auto`,children:[(0,q.jsx)(Ie,{children:(0,q.jsxs)(k,{delayDuration:100,children:[(0,q.jsx)(Le,{asChild:!0,children:(0,q.jsx)(v,{size:`icon`,variant:`ghost`,className:`size-11 rounded-full bg-background text-muted-foreground shadow-md [&_svg]:size-5`,children:(0,q.jsx)(nn,{})})}),(0,q.jsx)(A,{children:`Emails`})]})}),(0,q.jsx)(Ie,{children:(0,q.jsxs)(k,{delayDuration:100,children:[(0,q.jsx)(Le,{asChild:!0,children:(0,q.jsx)(v,{asChild:!0,size:`icon`,variant:`ghost`,className:`size-11 rounded-full bg-background text-muted-foreground shadow-md [&_svg]:size-5`,children:(0,q.jsx)(`a`,{href:`/account/requests/${t}`,target:`_blank`,children:(0,q.jsx)(g,{})})})}),(0,q.jsx)(A,{children:`Client page`})]})}),(0,q.jsx)(Ie,{children:(0,q.jsxs)(k,{delayDuration:100,children:[(0,q.jsx)(Le,{asChild:!0,children:(0,q.jsx)(D,{disabled:i,loading:i,size:`icon`,variant:`ghost`,className:`size-11 rounded-full bg-background text-muted-foreground shadow-md [&_svg]:size-5`,onClick:()=>{t&&s(t)},children:(0,q.jsx)(Wt,{})})}),(0,q.jsx)(A,{children:`Clone request`})]})}),(0,q.jsx)(Ie,{children:(0,q.jsxs)(k,{delayDuration:100,children:[(0,q.jsx)(Le,{asChild:!0,children:(0,q.jsx)(v,{size:`icon`,variant:`ghost`,className:`size-11 rounded-full bg-background text-muted-foreground shadow-md [&_svg]:size-5`,onClick:()=>{t&&o(t)},children:(0,q.jsx)(d,{})})}),(0,q.jsx)(A,{children:`View PDF`})]})}),n===`confirmed`&&(0,q.jsx)(Ie,{children:(0,q.jsxs)(k,{delayDuration:100,children:[(0,q.jsx)(Le,{asChild:!0,children:(0,q.jsx)(v,{size:`icon`,variant:`ghost`,className:`size-11 rounded-full bg-background text-muted-foreground shadow-md [&_svg]:size-5`,onClick:()=>{t&&a(t)},children:(0,q.jsx)(Xt,{})})}),(0,q.jsx)(A,{children:`Contract`})]})})]})}function yr(e,t,n,r){let i=window.screenLeft??window.screenX,a=window.screenTop??window.screenY,o=window.innerWidth||document.documentElement.clientWidth||screen.width,s=window.innerHeight||document.documentElement.clientHeight||screen.height,c=i+(o-n)/2,l=a+(s-r)/2,u=`width=${n},height=${r},top=${l},left=${c},noopener,noreferrer`;window.open(e,t,u)}function br(){let e=L(),{status:t,service_id:n}=R(e=>e.request.request);return(0,q.jsx)(`div`,{className:`z-0 px-4 py-8`,children:(0,q.jsxs)(`div`,{className:`flex flex-col justify-between gap-4 md:flex-row`,children:[(0,q.jsxs)(`div`,{className:`flex flex-col items-center gap-4 md:flex-row`,children:[(0,q.jsx)(xr,{status:t,dispatch:e}),(0,q.jsx)(Sr,{serviceId:n,dispatch:e}),(0,q.jsx)(vr,{})]}),(0,q.jsx)(_r,{})]})})}function xr({status:e,dispatch:t}){return(0,q.jsxs)(Ae,{value:e,onValueChange:e=>{t(I({status:e}))},children:[(0,q.jsx)(Ne,{className:j(`data-[size=default]:h-10 data-[size=sm]:h-10 w-full px-4 text-sm font-medium text-white md:w-[14rem]`,zt[e]),children:(0,q.jsx)(Pe,{placeholder:`select status`})}),(0,q.jsx)(je,{children:Bt.map((e,t)=>(0,q.jsx)(Me,{value:e.value,children:e.label},t))})]})}function Sr({serviceId:e,dispatch:t}){let{data:n}=Ct();return(0,q.jsxs)(Ae,{value:e?.toString(),onValueChange:e=>{t(I({service_id:parseInt(e)}))},children:[(0,q.jsx)(Ne,{className:`data-[size=default]:h-10 data-[size=sm]:h-10 w-full bg-background px-4 text-sm font-medium md:w-[14rem]`,children:(0,q.jsx)(Pe,{placeholder:`select status`})}),(0,q.jsx)(je,{children:n?.map((e,t)=>(0,q.jsx)(Me,{value:e.id.toString(),children:e.name},t))})]})}const Cr=new Date;Cr.setHours(7,0);const wr=new Date;wr.setHours(21,0);const Tr=60,Er=Or(Cr,wr,Tr);function Dr(){let e=R(e=>e.request.request),{data:t}=wt(),r=t?.filter(e=>e.is_active),[a,o]=(0,K.useState)(!1);return(0,q.jsxs)(q.Fragment,{children:[(0,q.jsx)(`div`,{className:`border-b bg-background py-2`,children:(0,q.jsxs)(`div`,{className:`flex flex-col lg:flex-row gap-2 lg:items-center lg:justify-center lg:relative`,children:[(0,q.jsx)(Ft,{defaultValue:`account`,className:`mb-2 lg:mb-0 px-4 lg:absolute lg:left-0`,children:(0,q.jsxs)(It,{className:`h-auto`,children:[(0,q.jsxs)(W,{value:`account`,className:`data-[state=active]:bg-primary data-[state=active]:text-primary-foreground flex flex-col gap-0 px-6`,children:[(0,q.jsx)(`span`,{className:`text-[12px] font-semibold`,children:`Pickup`}),(0,q.jsx)(`span`,{className:`text-[10px]`,children:N(e?.moving_date??new Date,`LLL dd, yyyy`)})]}),(0,q.jsxs)(W,{value:`password`,className:`data-[state=active]:bg-primary data-[state=active]:text-primary-foreground flex flex-col gap-0 px-6`,children:[(0,q.jsx)(`span`,{className:`text-[12px] font-semibold`,children:`Delivery`}),(0,q.jsx)(`span`,{className:`text-[10px]`,children:N(e?.delivery_date_window_start??new Date,`LLL dd, yyyy`)})]})]})}),(0,q.jsxs)(`div`,{className:`lg:mx-auto flex flex-1 lg:max-w-lg items-center justify-between bg-background px-4`,children:[(0,q.jsx)(v,{size:`icon`,variant:`ghost`,children:(0,q.jsx)(s,{})}),(0,q.jsxs)(`div`,{className:`flex items-center gap-4`,children:[(0,q.jsxs)(`p`,{className:`text-sm font-medium sm:space-x-1`,children:[(0,q.jsx)(`span`,{className:`block sm:inline-block`,children:N(new Date,`eeee,`)}),(0,q.jsx)(`span`,{className:`block sm:inline-block`,children:N(new Date,`MMMM do, yyyy`)})]}),(0,q.jsxs)(X,{open:a,onOpenChange:o,children:[(0,q.jsx)(Z,{asChild:!0,children:(0,q.jsx)(v,{size:`icon`,variant:`ghost`,children:(0,q.jsx)(i,{})})}),(0,q.jsx)(Q,{className:`w-auto p-0`,align:`start`,children:(0,q.jsx)(n,{mode:`single`,selected:new Date,defaultMonth:new Date,showOutsideDays:!1})})]})]}),(0,q.jsx)(v,{size:`icon`,variant:`ghost`,children:(0,q.jsx)(c,{})})]})]})}),(0,q.jsxs)(Oe,{className:`relative h-fit w-full bg-background`,children:[(0,q.jsxs)(`div`,{className:`grid grid-cols-[100px_auto] grid-rows-[45px_auto] lg:grid-cols-[140px_auto]`,children:[(0,q.jsx)(`div`,{className:`flex items-center justify-center border-b`}),(0,q.jsxs)(`div`,{className:`row-span-2 grid grid-rows-[45px_auto]`,children:[(0,q.jsx)(`div`,{className:`grid grid-cols-[repeat(15,70px)] border-b`,children:Er.map((e,t)=>(0,q.jsxs)(`div`,{className:`relative`,children:[(0,q.jsxs)(`div`,{className:`absolute -left-[8px] bottom-0 flex items-center gap-1 pb-2`,children:[(0,q.jsx)(`div`,{className:`text-xs font-semibold`,children:e.digit}),(0,q.jsx)(`div`,{className:`text-xs text-muted-foreground`,children:e.suffix})]}),(0,q.jsx)(`div`,{className:`absolute -left-[1px] bottom-0 h-1 border-l`})]},t))}),(0,q.jsx)(`div`,{className:``,children:r?.map((e,t)=>(0,q.jsxs)(`div`,{className:`relative grid grid-cols-[repeat(15,70px)]`,children:[Array(15).fill(``).map((e,t)=>(0,q.jsx)(`div`,{className:`h-14 w-full border-b border-r`},t)),` `]},t))})]}),(0,q.jsx)(`div`,{className:`sticky left-0 z-20 grid border-r [&_*]:h-14 [&_*]:border-b`,children:r?.map((e,t)=>(0,q.jsx)(`div`,{className:j(`flex h-14 cursor-pointer items-center justify-center bg-muted text-sm font-semibold`),children:e.name},t))})]}),(0,q.jsx)(ke,{orientation:`horizontal`})]})]})}function Or(e,t,n){let r=[],i=e;for(;i<=t;){let e=i.toLocaleString(`en-US`,{hour:`2-digit`,hour12:!0}),[t,a]=e.split(` `);r.push({digit:t,suffix:a}),i.setMinutes(i.getMinutes()+n)}return r}function kr(){return(0,q.jsxs)(`div`,{className:`bg-muted`,children:[(0,q.jsx)(Dr,{}),(0,q.jsxs)(`div`,{className:`divide-y shadow-md bg-background`,children:[(0,q.jsx)(lr,{}),(0,q.jsx)(or,{}),(0,q.jsx)(ur,{})]}),(0,q.jsx)(`div`,{children:(0,q.jsx)(br,{})}),(0,q.jsxs)(`div`,{className:`grid grid-cols-1 gap-4 px-4 xl:grid-cols-3`,children:[(0,q.jsxs)(`div`,{className:`md:col-span-2`,children:[(0,q.jsxs)(z,{children:[(0,q.jsx)(V,{children:(0,q.jsx)(H,{children:`Addresses`})}),(0,q.jsx)(B,{children:(0,q.jsx)(An,{})})]}),(0,q.jsxs)(z,{children:[(0,q.jsx)(V,{children:(0,q.jsx)(H,{children:`Notes`})}),(0,q.jsx)(B,{children:(0,q.jsx)(hr,{})})]}),(0,q.jsxs)(z,{children:[(0,q.jsx)(V,{children:(0,q.jsx)(H,{children:`Overview`})}),(0,q.jsx)(B,{children:(0,q.jsx)(dr,{})})]})]}),(0,q.jsx)(`div`,{children:(0,q.jsx)(pr,{})})]}),(0,q.jsx)(gr,{})]})}const Ar=[{id:1,name:`delicate_items_question_answer`,question:`Do you have items that easily break and need extra love (lamps, mirrors, electronics, artwork)?`},{id:2,name:`bulky_items_question_answer`,question:`Do you have bulky items that require added handling? (e.g armoires, ellipticals, treadmills, appliances)`},{id:3,name:`disassemble_items_question_answer`,question:`Do you have items that we'll need to disassemble for you?`}],jr=nt({delicate_items_question_answer:P(),bulky_items_question_answer:P(),disassemble_items_question_answer:P(),comments:P()});function Mr(){let{id:e,details:t}=R(e=>e.request.request),[n,{isLoading:r}]=Mt(),i=vt({resolver:Be(jr),reValidateMode:`onChange`,values:t,defaultValues:t});function a(t){e&&n({id:e,data:{details:t}}).unwrap().then(()=>{F.success(`Changes saved`),i.reset(t)}).catch(e=>{et(e)})}return(0,q.jsx)(`div`,{className:`p-4 bg-muted h-full dark:bg-background`,children:(0,q.jsxs)(z,{className:`max-w-2xl`,children:[(0,q.jsx)(V,{children:(0,q.jsx)(H,{children:`Additional details`})}),(0,q.jsx)(B,{children:(0,q.jsx)(ge,{...i,children:(0,q.jsxs)(`div`,{className:`space-y-6`,children:[Ar.map(e=>(0,q.jsxs)(`div`,{className:`flex flex-col justify-between gap-4 md:flex-row`,children:[(0,q.jsx)(`p`,{className:`text-sm text-muted-foreground`,children:e.question}),(0,q.jsx)(S,{control:i.control,name:e.name,render:({field:t})=>(0,q.jsxs)(Te,{value:t.value,onValueChange:e=>{t.onChange(e)},className:`flex justify-start gap-4 lg:justify-end`,children:[(0,q.jsxs)(`div`,{className:`flex items-center gap-2`,children:[(0,q.jsx)(Ee,{value:`yes`,id:`q${e.id}1`}),(0,q.jsx)(E,{htmlFor:`q${e.id}1`,children:`Yes`})]}),(0,q.jsxs)(`div`,{className:`flex items-center gap-2`,children:[(0,q.jsx)(Ee,{value:`no`,id:`q${e.id}2`}),(0,q.jsx)(E,{htmlFor:`q${e.id}2`,children:`No`})]})]})})]},e.id)),(0,q.jsx)(S,{control:i.control,name:`comments`,render:({field:e})=>(0,q.jsxs)(C,{children:[(0,q.jsx)(w,{children:`Additional details`}),(0,q.jsx)(x,{children:(0,q.jsx)(Ht,{...e,rows:8,placeholder:`Enter your comments...`})})]})})]})})}),(0,q.jsxs)(Pt,{className:`justify-end border-t gap-3`,children:[(0,q.jsx)(v,{variant:`outline`,onClick:()=>i.reset(),children:`Cancel`}),(0,q.jsx)(D,{disabled:r||!i.formState.isDirty,loading:r,onClick:i.handleSubmit(a),children:`Save changes`})]})]})})}const Nr=nt({first_name:P().min(1),last_name:P().min(1),email_address:P().min(1,`required`).email(`Invalid email address`),additional_email:P().optional().refine(e=>!e||e===``||P().email().safeParse(e).success,{message:`Invalid email address`}),phone:P().refine(e=>t(e,`US`),{message:`Invalid phone number`}),additional_phone:P().optional().refine(e=>!e||e===``||t(e,`US`),{message:`Invalid phone number`}),password:P().optional()});function Pr(){let t=L(),n=R(e=>e.request.request),[r,{isLoading:i}]=Mt(),[a,{isLoading:o}]=jt(),[s,{isLoading:c}]=ht();if(!n)return null;let{customer:u,id:d}=n,[re,g]=(0,K.useState)(null),[_,ie]=(0,K.useState)(!1),y=vt({resolver:Be(Nr),mode:`onChange`,reValidateMode:`onChange`,values:{first_name:u?.first_name??``,last_name:u?.last_name??``,email_address:u?.email_address??``,additional_email:u?.additional_email??``,phone:u?.phone??``,additional_phone:u?.additional_phone??``},defaultValues:{first_name:``,last_name:``,email_address:``,additional_email:``,phone:``,additional_phone:``,password:``}});function b(e){u?.id?se(e):oe(e)}let ae=Ye(async e=>{let t=!y.getFieldState(`email_address`).error;if(!t||!e)return null;console.log(`value`,e);try{let t=await Ve.get(`/users/check_email?email_address=${e}`),n=t.data;return console.log(`User`,n),n?(g(n),ie(!0),n):null}catch(e){e instanceof Error&&F.error(e.message)}},1e3);async function oe(e){let n=await s(e).unwrap();await r({id:d,data:{customer_id:n.id}}),t(it.util.invalidateTags([{type:`Request`,id:d}])),F.success(`Customer created successfully`),y.reset(n)}async function se(e){var r,i;!(n==null||(r=n.customer)==null)&&r.id&&(await a({id:n==null||(i=n.customer)==null?void 0:i.id,data:e}).unwrap(),t(it.util.invalidateTags([{type:`Request`,id:d}])),F.success(`Customer updated successfully`),y.reset(e))}return(0,q.jsxs)(q.Fragment,{children:[(0,q.jsxs)(z,{className:`max-w-4xl`,children:[(0,q.jsx)(V,{children:(0,q.jsx)(H,{children:`Customer Information`})}),(0,q.jsx)(B,{children:(0,q.jsx)(ge,{...y,children:(0,q.jsxs)(`form`,{autoComplete:`off`,className:`grid grid-cols-1 md:grid-cols-2 gap-6`,children:[(0,q.jsx)(S,{control:y.control,name:`first_name`,render:({field:e})=>(0,q.jsxs)(C,{children:[(0,q.jsx)(w,{children:`First name`}),(0,q.jsx)(x,{children:(0,q.jsx)(T,{title:`Please enter your First Name`,autoComplete:`off`,...e})})]})}),(0,q.jsx)(S,{control:y.control,name:`last_name`,render:({field:e})=>(0,q.jsxs)(C,{children:[(0,q.jsx)(w,{children:`Last name`}),(0,q.jsx)(x,{children:(0,q.jsx)(T,{...e,title:`Please enter your Last Name`,autoComplete:`off`})})]})}),(0,q.jsx)(S,{control:y.control,name:`email_address`,render:({field:e})=>(0,q.jsxs)(C,{children:[(0,q.jsx)(w,{children:`Email`}),(0,q.jsx)(x,{children:(0,q.jsx)(T,{...e,onChange:t=>{e.onChange(t.target.value),ae(t.target.value)},title:`Please enter your Email`,autoComplete:`off`})})]})}),(0,q.jsx)(S,{control:y.control,name:`additional_email`,render:({field:e})=>(0,q.jsxs)(C,{children:[(0,q.jsx)(w,{children:`Additional email (optional)`}),(0,q.jsx)(x,{children:(0,q.jsx)(T,{...e,value:e.value??``,title:`Please enter Additional email`,autoComplete:`off`})})]})}),(0,q.jsx)(S,{control:y.control,name:`phone`,render:({field:t})=>(0,q.jsxs)(C,{children:[(0,q.jsx)(w,{children:`Phone`}),(0,q.jsx)(x,{children:(0,q.jsx)(e,{...t,value:$e(t.value??``),handleValueChange:t.onChange})})]})}),(0,q.jsx)(S,{control:y.control,name:`additional_phone`,render:({field:t})=>(0,q.jsxs)(C,{children:[(0,q.jsx)(w,{children:`Additional phone (optional)`}),(0,q.jsx)(x,{children:(0,q.jsx)(e,{...t,value:$e(t.value??``),handleValueChange:t.onChange})})]})}),(0,q.jsx)(S,{control:y.control,name:`password`,render:({field:e})=>(0,q.jsxs)(C,{children:[(0,q.jsx)(w,{children:`Password`}),(0,q.jsx)(x,{children:(0,q.jsx)(l,{...e,autoComplete:`off`,className:`col-span-4`})}),(0,q.jsx)(ve,{})]})})]})})}),(0,q.jsxs)(Pt,{className:`justify-end border-t gap-3`,children:[(0,q.jsx)(v,{type:`button`,onClick:()=>{y.reset()},variant:`outline`,children:`Cancel`}),(0,q.jsx)(D,{disabled:o||c||!y.formState.isDirty,loading:o||c,onClick:y.handleSubmit(b),children:`Save changes`})]})]}),(0,q.jsx)(f,{open:_,onOpenChange:ie,children:(0,q.jsxs)(ee,{children:[(0,q.jsxs)(ne,{children:[(0,q.jsx)(h,{children:`User with this email already exists`}),(0,q.jsx)(m,{children:`Do you want to merge this request with the existing profile?`})]}),(0,q.jsxs)(te,{children:[(0,q.jsx)(p,{children:`No, cancel`}),(0,q.jsx)(D,{loading:i,disabled:i,onClick:()=>{r({id:d,data:{customer_id:re?.id}}).unwrap().then(()=>{y.reset(re),ie(!1)}).catch(e=>{et(e)})},children:`Yes`})]})]})})]})}function Fr(){return(0,q.jsx)(`div`,{className:`p-4 bg-muted h-full dark:bg-background`,children:(0,q.jsx)(Pr,{})})}const Ir=({requestId:e})=>{let[t,n]=(0,K.useState)([]),[r,i]=(0,K.useState)(!1),[a,o]=(0,K.useState)(!1),s=e=>{if(e.target.files){let t=Array.from(e.target.files);n(e=>[...e,...t])}},c=(0,K.useCallback)(e=>{e.preventDefault(),o(!0)},[]),l=(0,K.useCallback)(e=>{e.preventDefault(),o(!1)},[]),u=(0,K.useCallback)(e=>{e.preventDefault(),o(!1);let t=Array.from(e.dataTransfer.files),r=t.filter(e=>e.type.startsWith(`image/`));r.length>0&&n(e=>[...e,...r])},[]),d=e=>{n(t=>t.filter((t,n)=>n!==e))},f=async()=>{if(t.length<1)return;let r=new FormData;Array.from(t).forEach(e=>{r.append(`images[]`,e)}),i(!0);try{await Ve.post(`requests/${e}/images`,r,{headers:{"Content-Type":`multipart/form-data`}}),n([])}catch(e){console.error(`Error uploading images:`,e),alert(`Failed to upload images.`)}finally{i(!1)}};return(0,q.jsxs)(`div`,{className:`space-y-6`,children:[(0,q.jsxs)(`div`,{className:`relative border-2 border-dashed rounded-md p-6 text-center transition-all duration-200 ${a?`border-blue-400 bg-blue-50`:`hover:border-muted-foreground/50 bg-muted/40`}`,onDragOver:c,onDragLeave:l,onDrop:u,children:[(0,q.jsx)(`input`,{type:`file`,multiple:!0,accept:`image/*`,onChange:s,className:`absolute inset-0 w-full h-full opacity-0 cursor-pointer`}),(0,q.jsxs)(`div`,{className:`space-y-4`,children:[(0,q.jsx)(`div`,{className:`mx-auto w-16 h-16 bg-muted rounded-full flex items-center justify-center`,children:(0,q.jsx)(dn,{className:`w-8 h-8 text-muted-foreground`})}),(0,q.jsxs)(`div`,{children:[(0,q.jsx)(`h3`,{className:`text-lg font-semibold text-foreground mb-2`,children:`Drop images here or click to browse`}),(0,q.jsx)(`p`,{className:`text-foreground text-sm`,children:`Supports JPG, PNG, GIF up to 10MB each`})]})]})]}),t.length>0&&(0,q.jsxs)(`div`,{className:`space-y-4`,children:[(0,q.jsxs)(`div`,{className:`flex items-center justify-between`,children:[(0,q.jsxs)(`h4`,{className:`text-sm font-medium text-muted-foreground`,children:[t.length,` `,t.length===1?`file`:`files`,` selected`]}),(0,q.jsx)(v,{variant:`outline`,size:`sm`,onClick:()=>n([]),children:`Clear all`})]}),(0,q.jsx)(`div`,{className:`grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 gap-4`,children:t.map((e,t)=>(0,q.jsx)(Rr,{url:URL.createObjectURL(e),onRemove:()=>d(t)},t))}),(0,q.jsx)(`div`,{className:`flex justify-end`,children:(0,q.jsxs)(D,{loading:r,disabled:r,onClick:f,children:[`Upload `,t.length,` `,t.length===1?`image`:`images`]})})]})]})};var Lr=Ir;const Rr=({url:e,onRemove:t,onClick:n,className:r})=>(0,q.jsxs)(`div`,{className:j(`relative bg-background aspect-3/2 border rounded-md`,r),onClick:n,children:[(0,q.jsx)(`button`,{className:`absolute top-0 right-0 translate-x-1/2 -translate-y-1/2`,onClick:e=>{e.stopPropagation(),t()},children:(0,q.jsx)(Jt,{className:`h-5 w-5 fill-primary text-primary-foreground`})}),(0,q.jsx)(`img`,{src:e,height:200,width:200,alt:``,className:`h-full w-full object-contain rounded-md`})]});function zr(){let e=R(e=>e.request.request);if(!e)return null;let[t,n]=(0,K.useState)(null),r=e.image_urls??[],i=t?r.findIndex(e=>e.url===t):-1,a=()=>{i<r.length-1&&n(r[i+1].url)},o=()=>{i>0&&n(r[i-1].url)};(0,K.useEffect)(()=>{let e=e=>{t&&(e.key===`ArrowRight`?a():e.key===`ArrowLeft`?o():e.key===`Escape`&&n(null))};return window.addEventListener(`keydown`,e),()=>window.removeEventListener(`keydown`,e)},[t,i]);let l=async t=>{await Ve.delete(`/requests/${e.id}/images/${t}`)};return(0,q.jsxs)(`div`,{className:`p-4 bg-muted h-full dark:bg-background`,children:[(0,q.jsxs)(`div`,{className:`mb-8`,children:[(0,q.jsxs)(`div`,{className:`mb-4`,children:[(0,q.jsx)(`h2`,{className:`text-2xl font-bold mb-2`,children:`Photo Gallery`}),(0,q.jsxs)(`p`,{className:`text-muted-foreground`,children:[r.length,` `,r.length===1?`photo`:`photos`,` uploaded`]})]}),(0,q.jsx)(z,{children:(0,q.jsx)(B,{children:(0,q.jsx)(Lr,{requestId:e.id})})})]}),t&&(0,q.jsx)(`div`,{className:`fixed inset-0 z-50 flex items-center justify-center bg-black/90 backdrop-blur-sm animate-in fade-in duration-200`,onClick:()=>n(null),children:(0,q.jsxs)(`div`,{className:`relative max-h-[95vh] max-w-[95vw] group`,children:[(0,q.jsx)(v,{onClick:()=>n(null),size:`icon`,variant:`secondary`,className:`absolute -right-4 -top-4 rounded-full bg-background/90 hover:bg-background shadow-lg z-10 opacity-0 group-hover:opacity-100 transition-opacity duration-200`,children:(0,q.jsx)(Re,{className:`w-4 h-4`})}),i>0&&(0,q.jsx)(v,{onClick:e=>{e.stopPropagation(),o()},size:`icon`,variant:`secondary`,className:`absolute left-4 top-1/2 -translate-y-1/2 rounded-full bg-white/90 hover:bg-white shadow-lg opacity-0 group-hover:opacity-100 transition-opacity duration-200`,children:(0,q.jsx)(s,{className:`w-5 h-5`})}),i<r.length-1&&(0,q.jsx)(v,{onClick:e=>{e.stopPropagation(),a()},size:`icon`,variant:`secondary`,className:`absolute right-4 top-1/2 -translate-y-1/2 rounded-full bg-white/90 hover:bg-white shadow-lg opacity-0 group-hover:opacity-100 transition-opacity duration-200`,children:(0,q.jsx)(c,{className:`w-5 h-5`})}),(0,q.jsxs)(`div`,{className:`absolute top-4 left-4 bg-black/50 text-white px-3 py-1 rounded-full text-sm font-medium`,children:[i+1,` of `,r.length]}),(0,q.jsx)(`img`,{className:`max-h-[95vh] max-w-[95vw] rounded-lg object-contain shadow-2xl`,src:t,alt:``,onClick:e=>e.stopPropagation()})]})}),r.length>0?(0,q.jsx)(`div`,{className:`grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 gap-4`,children:r.map(e=>(0,q.jsx)(Rr,{url:e.thumb,onRemove:()=>{l(e.id)},onClick:()=>n(e.url)},e.id))}):(0,q.jsxs)(`div`,{className:`text-center py-16`,children:[(0,q.jsx)(`div`,{className:`mx-auto w-24 h-24 bg-background dark:bg-muted rounded-full flex items-center justify-center mb-4`,children:(0,q.jsx)(en,{className:`w-12 h-12 text-muted-foreground`})}),(0,q.jsx)(`h3`,{className:`text-lg font-medium text-muted-foreground mb-2`,children:`No photos yet`}),(0,q.jsx)(`p`,{className:`text-muted-foreground`,children:`Upload your first photo to get started`})]})]})}function Br(){var e,t;let n=L(),r=R(e=>e.request.request),[i,a]=(0,K.useState)(`request`),o=(r==null||(e=r.details)==null?void 0:e.is_touched)??!1,s=r?.image_urls?(r==null||(t=r.image_urls)==null?void 0:t.length)>0:!1;return(0,q.jsx)(`div`,{children:(0,q.jsxs)(Ft,{value:i,onValueChange:e=>{a(e)},className:`gap-0 flex-1 bg-background`,children:[(0,q.jsxs)(`div`,{className:`flex flex-col-reverse border-b lg:flex-row items-center justify-between`,children:[(0,q.jsxs)(Oe,{className:` p-4 w-full`,children:[(0,q.jsxs)(It,{className:`justify-start gap-1`,children:[(0,q.jsxs)(W,{value:`request`,children:[`Request #`,r?.id]}),(0,q.jsx)(W,{value:`customer`,children:`Customer`}),(0,q.jsx)(W,{value:`messages`,children:`Messages`}),(0,q.jsx)(W,{value:`logs`,children:`Logs`}),(0,q.jsx)(W,{value:`details`,children:(0,q.jsxs)(`div`,{className:`relative`,children:[`Details`,` `,o&&(0,q.jsx)(`span`,{className:`absolute -right-1.5 top-0 size-1.5 rounded-full bg-green-600`})]})}),(0,q.jsx)(W,{value:`photos`,children:(0,q.jsxs)(`div`,{className:`relative`,children:[`Photos`,` `,s&&(0,q.jsx)(`span`,{className:`absolute -right-1.5 top-0 size-1.5 rounded-full bg-green-600`})]})}),(0,q.jsx)(W,{value:`inventory`,children:`Inventory`})]}),(0,q.jsx)(ke,{orientation:`horizontal`})]}),(0,q.jsxs)(`div`,{className:`flex flex-1 w-full px-4 justify-end items-center gap-3`,children:[(0,q.jsx)(E,{htmlFor:`is_calculator_disabled`,children:`Calculator`}),(0,q.jsx)(Vt,{id:`is_calculator_disabled`,checked:r?.is_calculator_disabled,onCheckedChange:e=>n(I({is_calculator_disabled:e}))})]})]}),(0,q.jsx)(U,{value:`request`,children:(0,q.jsx)(kr,{})}),(0,q.jsx)(U,{value:`customer`,children:(0,q.jsx)(Fr,{})}),(0,q.jsx)(U,{value:`messages`,className:`mt-0 w-screen`,children:(0,q.jsx)(`div`,{className:`w-full`})}),(0,q.jsx)(U,{value:`logs`,children:`logs`}),(0,q.jsx)(U,{value:`details`,children:(0,q.jsx)(Mr,{})}),(0,q.jsx)(U,{value:`photos`,children:(0,q.jsx)(zr,{})}),(0,q.jsx)(U,{value:`inventory`,children:`inventory`})]})})}function Vr(){let e=Dt(),t=R(e=>e.request.request),n=R(st);if(!t)return null;function r(t){console.log(`minimizeRequest`,t),e(-1)}function i(t){console.log(`closeRequest`,t),e(-1)}return(0,q.jsxs)(`div`,{className:`flex justify-between p-4 md:items-center bg-background`,children:[(0,q.jsx)(Hr,{customer:t.customer||{}}),(0,q.jsxs)(`div`,{className:`flex gap-2`,children:[(0,q.jsx)(v,{variant:`outline`,size:`icon`,onClick:()=>r(t),children:(0,q.jsx)(b,{})}),(0,q.jsx)(v,{variant:`outline`,size:`icon`,onClick:()=>{i(t.id)},children:(0,q.jsx)(Re,{})})]})]})}function Hr({customer:e}){let t=e.first_name&&e.last_name?`${e?.first_name} ${e?.last_name}`:`No customer`,n=e?.email_address??`No email`,r=e?.phone?$e(e.phone):`No phone number`;return(0,q.jsxs)(`div`,{className:`flex flex-col flex-wrap gap-2 md:flex-row md:items-center md:gap-8`,children:[(0,q.jsx)(`h1`,{children:t}),(0,q.jsxs)(`a`,{href:e.phone?`tel:${e?.phone}`:void 0,className:`flex items-center gap-4`,children:[(0,q.jsx)(an,{className:`size-4`}),r]}),(0,q.jsxs)(`p`,{className:`flex items-center gap-4`,children:[(0,q.jsx)(a,{className:`size-4`}),n]})]})}function Ur(){let{id:e}=kt(),t=L(),{data:n,isLoading:r,isError:i,error:a}=St({id:Number(e)},{skip:!e,refetchOnMountOrArgChange:!0}),o=R(e=>e.request.request);return fn(e?parseInt(e):void 0),(0,K.useEffect)(()=>(n&&t(ct(n)),()=>{t(Ue())}),[n]),r?(0,q.jsx)(`div`,{className:`flex h-screen w-full items-center justify-center md:h-[calc(100vh-40px)]`,children:(0,q.jsx)(Fe,{})}):i?(0,q.jsx)(`div`,{className:`flex items-center justify-center py-80 md:py-96`,children:(0,q.jsx)(`p`,{children:`data`in a?a.data.error:`something went wrong`})}):o?(0,q.jsx)(be,{className:`h-full`,children:(0,q.jsxs)(`div`,{className:`flex border-l border-r flex-col mx-auto max-w-7xl bg-muted dark:bg-background h-full`,children:[(0,q.jsx)(Vr,{}),(0,q.jsx)(Br,{})]})}):null}const Wr=Ur;export{Wr as Component};