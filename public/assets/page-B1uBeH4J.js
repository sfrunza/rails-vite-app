import{C as E,D as L,r as g,j as e,S as _,k as M,B as u,l as O,m as U,n as z,o as G,p as q,q as B,L as b,t as v,E as H,h as A,g as F,F as K,G as V}from"./index-BrQi1v-c.js";import{C as R,a as $,b as Q,f as W,d as J,e as X}from"./card-Cim6kUnN.js";import{S as Y}from"./skeleton-CQuYJPyZ.js";import{S as Z}from"./setting-page-wrapper-lwIfDS-L.js";import{u as ee,F as se,a as p,b as j,c as f,d as y,e as C,f as D,s as ae,o as ne,h as re,g as P}from"./zod-CKf-_hsS.js";import{I as te}from"./input-B52D2lzl.js";import{N as ie}from"./numeric-input-CE3LjWwX.js";import{T as oe}from"./textarea-Co9YEACg.js";import{P as ce}from"./pen-line-OgDnHBxE.js";import{P as le}from"./plus-DlXTtDVQ.js";import{A as de,a as he,T as ue,b as xe,c as me,d as ge,e as pe,f as je,g as fe,u as Ce,C as be,G as ve,h as Se,i as N,D as ke,r as ye,j as De,S as Pe,s as Ne,K as Ae,P as Fe,k as Ie}from"./alert-dialog-DDQSTuhp.js";import"./label-CbHfFtVG.js";const Te=ne({name:P().min(1,{message:"Name is required."}),description:P().optional(),labor_increase:re.number().min(0).max(100)});function I({data:s}){const[t,{isLoading:c}]=E(),[d,{isLoading:o}]=L(),[i,l]=g.useState(!1),n=!!s,r=ee({mode:"onChange",reValidateMode:"onChange",resolver:ae(Te),values:s??void 0,defaultValues:{name:"",description:"",labor_increase:0}});async function h(a){const x=n?await d({id:s.id,...a}):await t(a);if("error"in x){const S=x.error;if(S.status===422){const T=S.data;for(const[w,k]of Object.entries(T))Array.isArray(k)&&r.setError(w,{type:"server",message:k.join(", ")})}return}v.success(`Packing ${n?"updated":"added"}`),l(!1)}function m(){r.reset(),l(a=>!a)}return e.jsxs(_,{open:i,onOpenChange:m,children:[e.jsx(M,{asChild:!0,children:n?e.jsx(u,{variant:"outline",size:"icon",children:e.jsx(ce,{})}):e.jsxs(u,{children:[e.jsx(le,{}),"Create packing"]})}),e.jsxs(O,{children:[e.jsxs(U,{children:[e.jsxs(z,{children:[n?"Update":"Add"," packing service"]}),e.jsx(G,{className:"sr-only"})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4",children:e.jsx(se,{...r,children:e.jsxs("form",{onSubmit:r.handleSubmit(h),className:"space-y-6",children:[e.jsx(p,{control:r.control,name:"name",render:({field:a})=>e.jsxs(j,{children:[e.jsx(f,{children:"Name (required)"}),e.jsx(y,{children:"Name of the packing service, visible to customers."}),e.jsx(C,{children:e.jsx(te,{...a,autoComplete:"off"})}),e.jsx(D,{})]})}),e.jsx(p,{control:r.control,name:"description",render:({field:a})=>e.jsxs(j,{children:[e.jsx(f,{children:"Description"}),e.jsx(y,{children:"Appears on the customer portal, and in quotes."}),e.jsx(C,{children:e.jsx(oe,{...a,rows:3})})]})}),e.jsx(p,{control:r.control,name:"labor_increase",render:({field:a})=>e.jsxs(j,{children:[e.jsx(f,{children:"Labor increse (%)"}),e.jsx(C,{children:e.jsx(ie,{value:a.value.toString(),min:0,max:100,onChange:x=>{a.onChange(x)}})}),e.jsx(D,{})]})})]})})}),e.jsxs(q,{children:[e.jsx(B,{asChild:!0,children:e.jsx(u,{type:"button",variant:"outline",children:"Cancel"})}),e.jsx(b,{type:"button",loading:c||o,disabled:c||o,onClick:r.handleSubmit(h),children:`${n?"Update":"Add"} packing`})]})]})]})}function we({packing:s}){const[t,c]=g.useState(!1),[d,{isLoading:o}]=H();return e.jsxs(de,{open:t,onOpenChange:c,children:[e.jsx(he,{asChild:!0,children:e.jsx(u,{variant:"outline",size:"icon",className:"hover:text-destructive",children:e.jsx(ue,{})})}),e.jsxs(xe,{children:[e.jsxs(me,{children:[e.jsx(ge,{children:"Delete packing?"}),e.jsxs(pe,{children:["This will delete ",e.jsxs("b",{children:[s.name,"."]}),e.jsx("br",{}),"Packing services that have already been used cannot be deleted."]})]}),e.jsxs(je,{children:[e.jsx(fe,{children:"Cancel"}),e.jsx(b,{type:"button",loading:o,disabled:o,variant:"destructive",onClick:()=>{d({id:s.id}).unwrap().then(()=>{v.success("Packing deleted"),c(!1)}).catch(i=>{A(i)})},children:"Delete"})]})]})]})}function Ee({item:s}){const t=s.is_default,{attributes:c,listeners:d,setNodeRef:o,transform:i,transition:l,isDragging:n}=Ce({id:s.id}),r={transform:be.Transform.toString(i),transition:l,zIndex:n?1e3:"auto",position:n?"relative":"static"};return e.jsxs("div",{ref:t?null:o,style:r,className:F("grid grid-cols-[max-content_1fr_auto_auto] border rounded-md items-center gap-2 p-4",{"bg-background shadow-lg":n}),children:[e.jsx(u,{size:"icon",variant:"ghost",className:"flex min-w-6 cursor-grab",disabled:t,...t?{}:c,...t?{}:d,children:e.jsx(ve,{})}),e.jsx("div",{className:"overflow-hidden",children:e.jsx("p",{className:"truncate text-sm font-medium",children:s.name})}),e.jsx(I,{data:s}),t?e.jsx(u,{variant:"ghost",disabled:!0,size:"icon",children:e.jsx("span",{className:"sr-only",children:"Default"})}):null,!t&&e.jsx(we,{packing:s})]})}function Le({items:s,setItems:t,setOrderChanged:c}){const d=Se(N(Fe),N(Ae,{coordinateGetter:Ne}));function o(i){const{active:l,over:n}=i;if(n&&l.id!==n.id){const r=s.findIndex(a=>a.id===l.id),h=s.findIndex(a=>a.id===n.id),m=Ie(s,r,h).map((a,x)=>({...a,index:x}));t(m),c(!0)}}return e.jsx(ke,{sensors:d,collisionDetection:De,onDragEnd:o,modifiers:[ye],children:e.jsx(Pe,{items:s,children:e.jsx("div",{className:"space-y-2",children:s.map(i=>e.jsx(Ee,{item:i},i.id))})})})}function _e(){const{data:s,isLoading:t,isError:c}=K(),[d,{isLoading:o}]=V(),[i,l]=g.useState([]),[n,r]=g.useState(!1);return g.useEffect(()=>{s&&l(s)},[s]),e.jsx(Z,{children:e.jsxs(R,{className:"max-w-2xl",children:[e.jsxs($,{children:[e.jsx(Q,{children:"Packing Services"}),e.jsx(W,{children:e.jsx(I,{})})]}),e.jsxs(J,{children:[c&&e.jsx("div",{children:e.jsx("p",{className:"text-muted-foreground text-center",children:"Failed to fetch packings"})}),t&&e.jsx("div",{className:"space-y-2",children:Array.from({length:3}).map((h,m)=>e.jsx(Y,{className:"h-17.5 w-full"},m))}),s&&e.jsx(Le,{items:i,setItems:l,setOrderChanged:r})]}),e.jsx(X,{className:"justify-end border-t",children:e.jsxs("div",{className:F("flex transition-opacity duration-500 gap-3",{"invisible opacity-0":!n,"visible opacity-100":n}),children:[e.jsx(u,{type:"button",variant:"outline",onClick:()=>{l(s??[]),r(!1)},children:"Cancel"}),e.jsx(b,{type:"button",disabled:o,loading:o,onClick:()=>{d({packings:i}).unwrap().then(()=>{r(!1),v.success("Changes saved")}).catch(h=>{A(h)})},children:"Save changes"})]})})]})})}const Qe=_e;export{Qe as Component};
