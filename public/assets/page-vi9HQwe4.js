import{CSS as e,DndContext as t,GripVertical as n,KeyboardSensor as r,PointerSensor as i,SortableContext as a,arrayMove as o,closestCenter as s,restrictToParentElement as c,sortableKeyboardCoordinates as l,useSensor as u,useSensors as d,useSortable as f}from"./sortable.esm-DD4nrChD.js";import{AlertDialog as p,AlertDialogCancel as m,AlertDialogContent as h,AlertDialogDescription as ee,AlertDialogFooter as g,AlertDialogHeader as te,AlertDialogTitle as _,AlertDialogTrigger as v,Button as y,Card as ne,CardAction as re,CardContent as ie,CardFooter as b,CardHeader as x,CardTitle as S,Form as C,FormControl as w,FormDescription as T,FormField as E,FormItem as D,FormLabel as O,FormMessage as k,Input as A,LoadingButton as j,Plus as M,Sheet as N,SheetClose as P,SheetContent as F,SheetDescription as I,SheetFooter as L,SheetHeader as R,SheetTitle as z,SheetTrigger as B,Skeleton as V,Switch as H,Trash2 as U,__toESM as W,a as G,cn as K,handleApiError as q,objectType as J,require_jsx_runtime as Y,require_react as ae,stringType as oe,toast as X,useBulkUpdateServicesMutation as se,useCreateServiceMutation as ce,useDeleteServiceMutation as le,useForm as ue,useGetServicesQuery as de}from"./index-OmLcTgDE.js";import{SettingPageWrapper as fe}from"./setting-page-wrapper-DsxRRjvs.js";var Z=W(ae()),Q=W(Y());function pe({service:e}){let[t,n]=(0,Z.useState)(!1),[r,{isLoading:i}]=le();return(0,Q.jsxs)(p,{open:t,onOpenChange:n,children:[(0,Q.jsx)(v,{asChild:!0,children:(0,Q.jsx)(y,{variant:`ghost`,size:`icon`,className:`hover:text-destructive`,children:(0,Q.jsx)(U,{})})}),(0,Q.jsxs)(h,{children:[(0,Q.jsxs)(te,{children:[(0,Q.jsx)(_,{children:`Delete moving service?`}),(0,Q.jsxs)(ee,{children:[`This will delete `,(0,Q.jsxs)(`b`,{children:[e.name,`.`]}),` Services that have already been used cannot be deleted.`]})]}),(0,Q.jsxs)(g,{children:[(0,Q.jsx)(m,{children:`Cancel`}),(0,Q.jsx)(j,{type:`button`,loading:i,disabled:i,variant:`destructive`,onClick:()=>{r({id:e.id}).unwrap().then(()=>{X.success(`Moving service deleted`),n(!1)}).catch(e=>{q(e)})},children:`Delete`})]})]})]})}function $({id:t,item:r,onEnabledChange:i}){let{attributes:a,listeners:o,setNodeRef:s,transform:c,transition:l,isDragging:u}=f({id:t}),d={transform:e.Transform.toString(c),transition:l,zIndex:u?1e3:`auto`,position:u?`relative`:`static`};return(0,Q.jsxs)(`div`,{ref:s,style:d,className:K(`grid grid-cols-[max-content_1fr_max-content_max-content] border rounded-md items-center gap-2 p-2`,{"bg-background shadow-lg":u}),children:[(0,Q.jsx)(y,{size:`icon`,variant:`ghost`,className:`cursor-grab`,...a,...o,children:(0,Q.jsx)(n,{})}),(0,Q.jsx)(`div`,{className:`overflow-hidden`,children:(0,Q.jsx)(`p`,{className:`truncate text-sm font-medium`,children:r.name})}),(0,Q.jsx)(H,{checked:r.enabled,onCheckedChange:e=>{i(r.id,e)}}),r.is_default?(0,Q.jsx)(`div`,{className:`size-9`}):(0,Q.jsx)(pe,{service:r})]})}function me({items:e,setItems:n,setOrderChanged:f}){let p=d(u(i),u(r,{coordinateGetter:l}));function m(t){let{active:r,over:i}=t;if(i&&r.id!==i.id){let t=e.findIndex(e=>e.id===r.id),a=e.findIndex(e=>e.id===i.id),s=o(e,t,a),c=s.map((e,t)=>({...e,index:t}));n(c),f(!0)}}function h(t,r){n(e.map(e=>e.id===t?{...e,enabled:r}:e)),f(!0)}return(0,Q.jsx)(t,{sensors:p,collisionDetection:s,onDragEnd:m,modifiers:[c],children:(0,Q.jsx)(a,{items:e,children:(0,Q.jsx)(`div`,{className:`space-y-2`,children:e.map(e=>(0,Q.jsx)($,{id:e.id,item:e,onEnabledChange:h},e.id))})})})}const he=J({name:oe({required_error:`Name is required.`}).min(5,{message:`Name must be at least 5 characters long.`})});function ge(){let[e,{isLoading:t}]=ce(),[n,r]=(0,Z.useState)(!1),i=ue({mode:`onChange`,reValidateMode:`onChange`,resolver:G(he),defaultValues:{name:``}});function a(t){e(t).unwrap().then(()=>{X.success(`Service created`),r(!1),i.reset()}).catch(e=>{q(e)})}function o(){i.reset(),r(e=>!e)}return(0,Q.jsxs)(N,{open:n,onOpenChange:o,children:[(0,Q.jsx)(B,{asChild:!0,children:(0,Q.jsxs)(y,{children:[(0,Q.jsx)(M,{}),`Create service`]})}),(0,Q.jsxs)(F,{children:[(0,Q.jsxs)(R,{children:[(0,Q.jsx)(z,{children:`Add moving service`}),(0,Q.jsx)(I,{className:`sr-only`})]}),(0,Q.jsx)(`div`,{className:`flex-1 overflow-y-auto p-4`,children:(0,Q.jsx)(C,{...i,children:(0,Q.jsx)(`form`,{onSubmit:i.handleSubmit(a),className:`space-y-6`,children:(0,Q.jsx)(E,{control:i.control,name:`name`,render:({field:e})=>(0,Q.jsxs)(D,{children:[(0,Q.jsx)(O,{children:`Name (required)`}),(0,Q.jsx)(T,{children:`Name of the moving service, visible to customers.`}),(0,Q.jsx)(w,{children:(0,Q.jsx)(A,{...e,autoComplete:`off`})}),(0,Q.jsx)(k,{})]})})})})}),(0,Q.jsxs)(L,{children:[(0,Q.jsx)(P,{asChild:!0,children:(0,Q.jsx)(y,{type:`button`,variant:`outline`,className:`w-full`,children:`Cancel`})}),(0,Q.jsx)(j,{type:`button`,loading:t,disabled:t,onClick:i.handleSubmit(a),className:`w-full`,children:`Add service`})]})]})]})}function _e(){let{data:e,isLoading:t,isError:n}=de(),[r,{isLoading:i}]=se(),[a,o]=(0,Z.useState)([]),[s,c]=(0,Z.useState)(!1);return(0,Z.useEffect)(()=>{e&&o(e)},[e]),(0,Q.jsx)(fe,{children:(0,Q.jsxs)(ne,{className:`max-w-xl`,children:[(0,Q.jsxs)(x,{children:[(0,Q.jsx)(S,{children:`Moving Services`}),(0,Q.jsx)(re,{children:(0,Q.jsx)(ge,{})})]}),(0,Q.jsxs)(ie,{children:[n&&(0,Q.jsx)(`div`,{children:(0,Q.jsx)(`p`,{className:`text-muted-foreground text-center`,children:`Failed to fetch services`})}),t&&(0,Q.jsx)(`div`,{className:`space-y-2`,children:Array.from({length:5}).map((e,t)=>(0,Q.jsx)(V,{className:`h-13.5 w-full`},t))}),e&&(0,Q.jsx)(me,{items:a,setItems:o,setOrderChanged:c})]}),(0,Q.jsx)(b,{className:`justify-end border-t`,children:(0,Q.jsxs)(`div`,{className:K(`flex transition-opacity gap-3 duration-500`,{"invisible opacity-0":!s,"visible opacity-100":s}),children:[(0,Q.jsx)(y,{type:`button`,variant:`outline`,onClick:()=>{o(e??[]),c(!1)},children:`Cancel`}),(0,Q.jsx)(j,{type:`button`,disabled:i,loading:i,onClick:()=>{r({services:a}).unwrap().then(()=>{X.success(`Changes saved`),c(!1)}).catch(e=>{q(e)})},children:`Save changes`})]})})]})})}const ve=_e;export{ve as Component};