import{CSS as e,DndContext as t,GripVertical as n,KeyboardSensor as r,PointerSensor as i,SortableContext as a,arrayMove as o,closestCenter as s,restrictToParentElement as c,sortableKeyboardCoordinates as l,useSensor as u,useSensors as d,useSortable as f}from"./sortable.esm-DD4nrChD.js";import{AlertDialog as p,AlertDialogCancel as m,AlertDialogContent as h,AlertDialogDescription as g,AlertDialogFooter as ee,AlertDialogHeader as _,AlertDialogTitle as v,AlertDialogTrigger as y,Button as b,Card as x,CardAction as S,CardContent as C,CardFooter as te,CardHeader as ne,CardTitle as re,Form as ie,FormControl as w,FormDescription as ae,FormField as T,FormItem as E,FormLabel as D,FormMessage as O,Input as k,LoadingButton as A,NumericInput as j,Plus as M,ScrollArea as N,ScrollBar as P,Separator as F,Sheet as I,SheetClose as L,SheetContent as R,SheetDescription as z,SheetFooter as B,SheetHeader as V,SheetTitle as H,SheetTrigger as U,Skeleton as W,Switch as oe,Trash2 as G,__toESM as K,a as q,cn as J,coerce as se,handleApiError as Y,objectType as ce,require_jsx_runtime as le,require_react as ue,stringType as de,toast as X,useBulkUpdateExtraServicesMutation as fe,useCreateExtraServiceMutation as pe,useDeleteExtraServiceMutation as me,useForm as he,useGetExtraServicesQuery as Z}from"./index-OmLcTgDE.js";import{SettingPageWrapper as ge}from"./setting-page-wrapper-DsxRRjvs.js";var Q=K(ue()),$=K(le());const _e=ce({name:de({required_error:`Name is required.`}).min(1,{message:`Name must be at least 1 character long.`}),price:se.number().min(0)});function ve(){let[e,{isLoading:t}]=pe(),[n,r]=(0,Q.useState)(!1),i=he({mode:`onChange`,reValidateMode:`onChange`,resolver:q(_e),defaultValues:{name:``,price:0}});function a(t){e(t).unwrap().then(()=>{X.success(`Service created`),r(!1),i.reset()}).catch(e=>{Y(e)})}function o(){i.reset(),r(e=>!e)}return(0,$.jsxs)(I,{open:n,onOpenChange:o,children:[(0,$.jsx)(U,{asChild:!0,children:(0,$.jsxs)(b,{children:[(0,$.jsx)(M,{}),`Create service`]})}),(0,$.jsxs)(R,{children:[(0,$.jsxs)(V,{children:[(0,$.jsx)(H,{children:`Add extra service`}),(0,$.jsx)(z,{className:`sr-only`})]}),(0,$.jsx)(`div`,{className:`flex-1 overflow-y-auto p-4`,children:(0,$.jsx)(ie,{...i,children:(0,$.jsxs)(`form`,{onSubmit:i.handleSubmit(a),className:`space-y-6`,children:[(0,$.jsx)(T,{control:i.control,name:`name`,render:({field:e})=>(0,$.jsxs)(E,{children:[(0,$.jsx)(D,{children:`Name (required)`}),(0,$.jsx)(ae,{children:`Name of the extra service, visible to customers.`}),(0,$.jsx)(w,{children:(0,$.jsx)(k,{...e,autoComplete:`off`})}),(0,$.jsx)(O,{})]})}),(0,$.jsx)(T,{control:i.control,name:`price`,render:({field:e})=>(0,$.jsxs)(E,{children:[(0,$.jsx)(D,{children:`Price`}),(0,$.jsx)(w,{children:(0,$.jsx)(j,{value:(e.value/100).toString(),min:0,max:1e4,step:.01,allowDecimals:!0,onChange:t=>{e.onChange(Number(t)*100)}})})]})})]})})}),(0,$.jsxs)(B,{children:[(0,$.jsx)(L,{asChild:!0,children:(0,$.jsx)(b,{type:`button`,variant:`outline`,children:`Cancel`})}),(0,$.jsx)(A,{type:`button`,loading:t,disabled:t,onClick:i.handleSubmit(a),children:`Add service`})]})]})]})}function ye({extraService:e}){let[t,n]=(0,Q.useState)(!1),[r,{isLoading:i}]=me();return(0,$.jsxs)(p,{open:t,onOpenChange:n,children:[(0,$.jsx)(y,{asChild:!0,children:(0,$.jsx)(b,{variant:`ghost`,size:`icon`,className:`hover:text-destructive`,children:(0,$.jsx)(G,{})})}),(0,$.jsxs)(h,{children:[(0,$.jsxs)(_,{children:[(0,$.jsx)(v,{children:`Delete extra service?`}),(0,$.jsxs)(g,{children:[`This will delete `,(0,$.jsxs)(`b`,{children:[e.name,`.`]})]})]}),(0,$.jsxs)(ee,{children:[(0,$.jsx)(m,{children:`Cancel`}),(0,$.jsx)(A,{type:`button`,loading:i,disabled:i,variant:`destructive`,onClick:()=>{r({id:e.id}).unwrap().then(()=>{X.success(`Extra service deleted`),n(!1)}).catch(e=>{Y(e)})},children:`Delete`})]})]})]})}function be({id:t,item:r,onChange:i}){let{attributes:a,listeners:o,setNodeRef:s,transform:c,transition:l,isDragging:u}=f({id:t}),d={transform:e.Transform.toString(c),transition:l,zIndex:u?1e3:`auto`,position:u?`relative`:`static`};return(0,$.jsxs)(`div`,{ref:s,style:d,className:J(`grid grid-cols-[max-content_2fr_1fr_1fr_1fr] items-center gap-2 p-2`,{"bg-background":u}),children:[(0,$.jsx)(b,{size:`icon`,variant:`ghost`,className:`cursor-grab`,...a,...o,children:(0,$.jsx)(n,{})}),(0,$.jsx)(k,{name:r.name,value:r.name,onChange:e=>{let t=e.target.value;i(r.id,{name:t})}}),(0,$.jsx)(j,{name:`extra-service-price-${t}`,value:(r.price/100).toString(),min:0,max:1e4,step:.01,allowDecimals:!0,onChange:e=>{i(r.id,{price:Number(e)*100})}}),(0,$.jsx)(oe,{checked:r.enabled,onCheckedChange:e=>{i(r.id,{enabled:e})}}),(0,$.jsx)(`div`,{className:`flex justify-end`,children:(0,$.jsx)(ye,{extraService:r})})]})}function xe({items:e,setItems:n,setOrderChanged:f}){let p=d(u(i),u(r,{coordinateGetter:l}));function m(t){let{active:r,over:i}=t;if(i&&r.id!==i.id){let t=e.findIndex(e=>e.id===r.id),a=e.findIndex(e=>e.id===i.id),s=o(e,t,a),c=s.map((e,t)=>({...e,index:t}));n(c),f(!0)}}function h(t,r){n(e.map(e=>e.id===t?{...e,...r}:e)),f(!0)}return(0,$.jsx)(t,{sensors:p,collisionDetection:s,onDragEnd:m,modifiers:[c],children:(0,$.jsx)(a,{items:e,children:(0,$.jsx)(`div`,{className:`pt-4 min-w-[556px] space-y-2`,children:e.map(e=>(0,$.jsx)(be,{id:e.id,item:e,onChange:h},e.id))})})})}function Se(){let{data:e,isLoading:t,isError:n}=Z(),[r,{isLoading:i}]=fe(),[a,o]=(0,Q.useState)([]),[s,c]=(0,Q.useState)(!1);return(0,Q.useEffect)(()=>{e&&o(e)},[e]),(0,$.jsx)(ge,{children:(0,$.jsxs)(x,{className:`max-w-4xl`,children:[(0,$.jsxs)(ne,{children:[(0,$.jsx)(re,{children:`Extra Services`}),(0,$.jsx)(S,{children:(0,$.jsx)(ve,{})})]}),(0,$.jsx)(C,{children:(0,$.jsxs)(N,{children:[(0,$.jsxs)(`div`,{className:`mb-4 grid grid-cols-[max-content_2fr_1fr_1fr_1fr] items-center gap-4 text-sm font-medium text-muted-foreground`,children:[(0,$.jsx)(`p`,{}),(0,$.jsx)(`p`,{className:`ml-9`,children:`Service name`}),(0,$.jsx)(`p`,{children:`Service cost, $`}),(0,$.jsx)(`p`,{className:`w-full`,children:`Enable`}),(0,$.jsx)(`p`,{})]}),(0,$.jsx)(F,{}),n&&(0,$.jsx)(`div`,{children:(0,$.jsx)(`p`,{className:`text-muted-foreground text-center`,children:`Failed to fetch packings`})}),t&&(0,$.jsx)(`div`,{className:`space-y-2 pt-4`,children:Array.from({length:5}).map((e,t)=>(0,$.jsx)(W,{className:`h-13 w-full`},t))}),e&&(0,$.jsx)(xe,{items:a,setItems:o,setOrderChanged:c}),(0,$.jsx)(P,{orientation:`horizontal`})]})}),(0,$.jsx)(te,{className:`justify-end border-t`,children:(0,$.jsxs)(`div`,{className:J(`flex transition-opacity duration-500 gap-3`,{"invisible opacity-0":!s,"visible opacity-100":s}),children:[(0,$.jsx)(b,{type:`button`,variant:`outline`,onClick:()=>{o(e??[]),c(!1)},children:`Cancel`}),(0,$.jsx)(A,{type:`button`,disabled:i,loading:i,onClick:()=>{r({extra_services:a}).unwrap().then(()=>{c(!1),X.success(`Changes saved`)}).catch(e=>{Y(e)})},children:`Save changes`})]})})]})})}const Ce=Se;export{Ce as Component};