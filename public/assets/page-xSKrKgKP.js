import"./chevron-left-zJdJqyR0.js";import{Button as e,Form as t,FormControl as n,FormDescription as r,FormField as i,FormItem as a,FormLabel as o,FormMessage as s,Input as c,LoadingButton as l,Plus as u,Sheet as d,SheetClose as f,SheetContent as p,SheetDescription as m,SheetFooter as h,SheetHeader as g,SheetTitle as _,SheetTrigger as v,Skeleton as y,Truck as b,__toESM as x,a as S,cn as C,handleApiError as w,objectType as T,require_jsx_runtime as E,require_react as D,stringType as O,toast as k,useBulkUpdateTrucksMutation as A,useCreateTruckMutation as j,useForm as M,useGetTrucksQuery as N}from"./index-BpPvn16n.js";import{Card as P,CardAction as F,CardContent as I,CardFooter as L,CardHeader as R,CardTitle as z}from"./card-D6e0mOnd.js";import{Switch as B}from"./switch-TnSuzTX_.js";import{SettingPageWrapper as V}from"./setting-page-wrapper-B7I8Q1ot.js";var H=x(D()),U=x(E());const W=T({name:O({required_error:`Name is required.`}).min(1,{message:`Name must be at least 1 character long.`})});function G(){let[y,{isLoading:b}]=j(),[x,C]=(0,H.useState)(!1),T=M({mode:`onChange`,reValidateMode:`onChange`,resolver:S(W),defaultValues:{name:``}});function E(e){y(e).unwrap().then(()=>{k.success(`Truck created`),T.reset(),C(!1)}).catch(e=>{w(e)})}function D(){T.reset(),C(e=>!e)}return(0,U.jsxs)(d,{open:x,onOpenChange:D,children:[(0,U.jsx)(v,{asChild:!0,children:(0,U.jsxs)(e,{children:[(0,U.jsx)(u,{}),`Create truck`]})}),(0,U.jsxs)(p,{children:[(0,U.jsxs)(g,{children:[(0,U.jsx)(_,{children:`Add truck`}),(0,U.jsx)(m,{className:`sr-only`})]}),(0,U.jsx)(`div`,{className:`flex-1 overflow-y-auto p-4`,children:(0,U.jsx)(t,{...T,children:(0,U.jsx)(`form`,{onSubmit:T.handleSubmit(E),className:`space-y-6`,children:(0,U.jsx)(i,{control:T.control,name:`name`,render:({field:e})=>(0,U.jsxs)(a,{children:[(0,U.jsx)(o,{children:`Name (required)`}),(0,U.jsx)(r,{children:`Name of the truck for internal use.`}),(0,U.jsx)(n,{children:(0,U.jsx)(c,{...e,autoComplete:`off`})}),(0,U.jsx)(s,{})]})})})})}),(0,U.jsxs)(h,{children:[(0,U.jsx)(f,{asChild:!0,children:(0,U.jsx)(e,{type:`button`,variant:`outline`,className:`w-full`,children:`Cancel`})}),(0,U.jsx)(l,{type:`button`,loading:b,disabled:b,onClick:T.handleSubmit(E),className:`w-full`,children:`Add truck`})]})]})]})}function K({items:e,setItems:t,setIsTouched:n}){function r(r,i,a){let o=e.map(e=>e.id===r.id?{...e,[i]:a}:e);t(o),n(!0)}return(0,U.jsx)(`div`,{className:`space-y-4`,children:e?.map((e,t)=>(0,U.jsxs)(`div`,{className:`grid grid-cols-[6rem_3rem_1fr] gap-6 items-center`,children:[(0,U.jsxs)(`div`,{className:`flex items-center gap-4 text-sm text-muted-foreground`,children:[(0,U.jsx)(b,{className:`size-5`}),(0,U.jsxs)(`span`,{children:[`Truck `,t+1]})]}),(0,U.jsx)(B,{checked:e.is_active,onCheckedChange:t=>{let n=t;r(e,`is_active`,n)}}),(0,U.jsx)(c,{value:e.name,onChange:t=>{let n=t.target.value;r(e,`name`,n)}})]},e.id))})}function q(){let{data:t,isLoading:n,isError:r}=N(),[i,{isLoading:a}]=A(),[o,s]=(0,H.useState)([]),[c,u]=(0,H.useState)(!1);return(0,H.useEffect)(()=>{t&&s(t)},[t]),(0,U.jsx)(V,{children:(0,U.jsxs)(P,{className:`max-w-xl`,children:[(0,U.jsxs)(R,{children:[(0,U.jsx)(z,{children:`Trucks`}),(0,U.jsx)(F,{children:(0,U.jsx)(G,{})})]}),(0,U.jsxs)(I,{children:[r&&(0,U.jsx)(`div`,{children:(0,U.jsx)(`p`,{className:`text-muted-foreground text-center`,children:`Failed to fetch trucks`})}),n&&(0,U.jsx)(`div`,{className:`space-y-4`,children:Array.from({length:3}).map((e,t)=>(0,U.jsx)(y,{className:`h-9 w-full`},t))}),t&&(0,U.jsx)(K,{items:o,setItems:s,setIsTouched:u})]}),(0,U.jsx)(L,{className:`justify-end border-t`,children:(0,U.jsxs)(`div`,{className:C(`flex transition-opacity duration-500 gap-3`,{"invisible opacity-0":!c,"visible opacity-100":c}),children:[(0,U.jsx)(e,{type:`button`,variant:`outline`,onClick:()=>{s(t??[]),u(!1)},children:`Cancel`}),(0,U.jsx)(l,{type:`button`,disabled:a,loading:a,onClick:()=>{i({trucks:o}).unwrap().then(()=>{u(!1),k.success(`Changes saved`)}).catch(e=>{w(e)})},children:`Save changes`})]})})]})})}const J=q;export{J as Component};