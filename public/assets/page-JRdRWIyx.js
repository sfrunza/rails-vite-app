import"./chevron-left-zJdJqyR0.js";import{CSS as e,DndContext as t,GripVertical as n,KeyboardSensor as r,PointerSensor as i,SortableContext as a,arrayMove as o,closestCenter as s,restrictToParentElement as c,sortableKeyboardCoordinates as l,useSensor as u,useSensors as d,useSortable as f}from"./sortable.esm-hJ0lGxBr.js";import{AlertDialog as p,AlertDialogCancel as m,AlertDialogContent as h,AlertDialogDescription as g,AlertDialogFooter as _,AlertDialogHeader as v,AlertDialogTitle as y,AlertDialogTrigger as b,Trash2 as x}from"./alert-dialog-BMKsEFef.js";import{Button as S,Form as C,FormControl as w,FormDescription as ee,FormField as T,FormItem as E,FormLabel as D,FormMessage as O,Input as k,LoadingButton as A,Plus as j,ScrollArea as te,ScrollBar as ne,Separator as M,Sheet as re,SheetClose as ie,SheetContent as N,SheetDescription as P,SheetFooter as F,SheetHeader as I,SheetTitle as L,SheetTrigger as R,Skeleton as z,__toESM as B,a as V,cn as H,coerce as U,handleApiError as W,objectType as G,require_jsx_runtime as K,require_react as q,stringType as J,toast as Y,useBulkUpdateExtraServicesMutation as ae,useCreateExtraServiceMutation as oe,useDeleteExtraServiceMutation as se,useForm as ce,useGetExtraServicesQuery as le}from"./index-BpPvn16n.js";import{Card as ue,CardAction as de,CardContent as fe,CardHeader as pe,CardTitle as me}from"./card-D6e0mOnd.js";import{Switch as he}from"./switch-TnSuzTX_.js";import{SettingPageWrapper as ge}from"./setting-page-wrapper-B7I8Q1ot.js";import{NumericInput as X}from"./numeric-input-pQ8PfA2f.js";var Z=B(q()),Q=B(K());const $=G({name:J({required_error:`Name is required.`}).min(1,{message:`Name must be at least 1 character long.`}),price:U.number().min(0)});function _e(){let[e,{isLoading:t}]=oe(),[n,r]=(0,Z.useState)(!1),i=ce({mode:`onChange`,reValidateMode:`onChange`,resolver:V($),defaultValues:{name:``,price:0}});function a(t){e(t).unwrap().then(()=>{Y.success(`Service created`),r(!1),i.reset()}).catch(e=>{W(e)})}function o(){i.reset(),r(e=>!e)}return(0,Q.jsxs)(re,{open:n,onOpenChange:o,children:[(0,Q.jsx)(R,{asChild:!0,children:(0,Q.jsxs)(S,{children:[(0,Q.jsx)(j,{}),`Create service`]})}),(0,Q.jsxs)(N,{children:[(0,Q.jsxs)(I,{children:[(0,Q.jsx)(L,{children:`Add extra service`}),(0,Q.jsx)(P,{className:`sr-only`})]}),(0,Q.jsx)(`div`,{className:`flex-1 overflow-y-auto p-4`,children:(0,Q.jsx)(C,{...i,children:(0,Q.jsxs)(`form`,{onSubmit:i.handleSubmit(a),className:`space-y-6`,children:[(0,Q.jsx)(T,{control:i.control,name:`name`,render:({field:e})=>(0,Q.jsxs)(E,{children:[(0,Q.jsx)(D,{children:`Name (required)`}),(0,Q.jsx)(ee,{children:`Name of the extra service, visible to customers.`}),(0,Q.jsx)(w,{children:(0,Q.jsx)(k,{...e,autoComplete:`off`})}),(0,Q.jsx)(O,{})]})}),(0,Q.jsx)(T,{control:i.control,name:`price`,render:({field:e})=>(0,Q.jsxs)(E,{children:[(0,Q.jsx)(D,{children:`Price`}),(0,Q.jsx)(w,{children:(0,Q.jsx)(X,{value:(e.value/100).toString(),min:0,max:1e4,step:.01,allowDecimals:!0,onChange:t=>{e.onChange(Number(t)*100)}})})]})})]})})}),(0,Q.jsxs)(F,{children:[(0,Q.jsx)(ie,{asChild:!0,children:(0,Q.jsx)(S,{type:`button`,variant:`outline`,children:`Cancel`})}),(0,Q.jsx)(A,{type:`button`,loading:t,disabled:t,onClick:i.handleSubmit(a),children:`Add service`})]})]})]})}function ve({extraService:e}){let[t,n]=(0,Z.useState)(!1),[r,{isLoading:i}]=se();return(0,Q.jsxs)(p,{open:t,onOpenChange:n,children:[(0,Q.jsx)(b,{asChild:!0,children:(0,Q.jsx)(S,{variant:`outline`,size:`icon`,className:`hover:text-destructive`,children:(0,Q.jsx)(x,{})})}),(0,Q.jsxs)(h,{children:[(0,Q.jsxs)(v,{children:[(0,Q.jsx)(y,{children:`Delete extra service?`}),(0,Q.jsxs)(g,{children:[`This will delete `,(0,Q.jsxs)(`b`,{children:[e.name,`.`]})]})]}),(0,Q.jsxs)(_,{children:[(0,Q.jsx)(m,{children:`Cancel`}),(0,Q.jsx)(A,{type:`button`,loading:i,disabled:i,variant:`destructive`,onClick:()=>{r({id:e.id}).unwrap().then(()=>{Y.success(`Extra service deleted`),n(!1)}).catch(e=>{W(e)})},children:`Delete`})]})]})]})}function ye({id:t,item:r,onChange:i}){let{attributes:a,listeners:o,setNodeRef:s,transform:c,transition:l,isDragging:u}=f({id:t}),d={transform:e.Transform.toString(c),transition:l,zIndex:u?1e3:`auto`,position:u?`relative`:`static`};return(0,Q.jsxs)(`div`,{ref:s,style:d,className:H(`grid grid-cols-[max-content_3fr_1fr_1fr_1fr] items-center gap-4 p-2`,{"bg-background shadow-lg":u}),children:[(0,Q.jsx)(S,{size:`icon`,variant:`ghost`,className:`flex min-w-6 cursor-grab`,...a,...o,children:(0,Q.jsx)(n,{})}),(0,Q.jsx)(k,{name:r.name,value:r.name,onChange:e=>{let t=e.target.value;i(r.id,{name:t})}}),(0,Q.jsx)(X,{value:(r.price/100).toString(),min:0,max:1e4,step:.01,allowDecimals:!0,onChange:e=>{i(r.id,{price:Number(e)*100})}}),(0,Q.jsx)(he,{checked:r.enabled,onCheckedChange:e=>{i(r.id,{enabled:e})}}),(0,Q.jsx)(`div`,{className:`flex justify-end`,children:(0,Q.jsx)(ve,{extraService:r})})]})}function be({extraServices:e,isLoading:n}){let[f,{isLoading:p}]=ae(),[m,h]=(0,Z.useState)([]),[g,_]=(0,Z.useState)(!1),v=d(u(i),u(r,{coordinateGetter:l}));(0,Z.useEffect)(()=>{e&&h(e)},[e]);function y(e){let{active:t,over:n}=e;if(n&&t.id!==n.id){let e=m.findIndex(e=>e.id===t.id),r=m.findIndex(e=>e.id===n.id),i=o(m,e,r),a=i.map((e,t)=>({...e,index:t}));h(a),_(!0)}}function b(e,t){h(n=>n.map(n=>n.id===e?{...n,...t}:n)),_(!0)}return(0,Q.jsxs)(`div`,{className:`flex flex-col gap-6`,children:[(0,Q.jsxs)(te,{className:`w-full`,children:[(0,Q.jsxs)(`div`,{className:`mb-4 grid grid-cols-[max-content_3fr_1fr_1fr_1fr] items-center gap-4 text-sm font-medium text-muted-foreground`,children:[(0,Q.jsx)(`p`,{className:`size-9`}),(0,Q.jsx)(`p`,{children:`Service name`}),(0,Q.jsx)(`p`,{children:`Service cost, $`}),(0,Q.jsx)(`p`,{children:`Enable`}),(0,Q.jsx)(`p`,{})]}),(0,Q.jsx)(M,{}),n&&(0,Q.jsx)(`div`,{className:`space-y-2 pt-4`,children:Array.from({length:5}).map((e,t)=>(0,Q.jsx)(z,{className:`h-13 w-full`},t))}),(0,Q.jsx)(t,{sensors:v,collisionDetection:s,onDragEnd:y,modifiers:[c],children:(0,Q.jsx)(a,{items:m,children:(0,Q.jsx)(`div`,{className:`pt-4 min-w-[700px] space-y-2`,children:m.map(e=>(0,Q.jsx)(ye,{id:e.id,item:e,onChange:b},e.id))})})}),(0,Q.jsx)(ne,{orientation:`horizontal`})]}),(0,Q.jsx)(M,{}),(0,Q.jsxs)(`div`,{className:H(`flex transition-opacity gap-3 duration-500 justify-end`,{"invisible opacity-0":!g,"visible opacity-100":g}),children:[(0,Q.jsx)(S,{type:`button`,variant:`outline`,onClick:()=>{h(e),_(!1)},children:`Cancel`}),(0,Q.jsx)(A,{type:`button`,disabled:p,loading:p,onClick:()=>{f({extra_services:m}).unwrap().then(()=>{Y.success(`Changes saved`),_(!1)}).catch(e=>{W(e)})},children:`Save changes`})]})]})}function xe(){let{data:e,isLoading:t,isError:n}=le();return(0,Q.jsx)(ge,{children:(0,Q.jsxs)(ue,{className:`max-w-4xl`,children:[(0,Q.jsxs)(pe,{children:[(0,Q.jsx)(me,{children:`Extra Services`}),(0,Q.jsx)(de,{children:(0,Q.jsx)(_e,{})})]}),(0,Q.jsxs)(fe,{children:[n&&(0,Q.jsx)(`div`,{children:(0,Q.jsx)(`p`,{className:`text-muted-foreground text-center`,children:`Failed to fetch services`})}),(0,Q.jsx)(be,{extraServices:e??[],isLoading:t})]})]})})}const Se=xe;export{Se as Component};